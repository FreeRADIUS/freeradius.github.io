<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>/home/runner/work/freeradius-server/freeradius-server/src/lib/eap/tls.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="freeradius.png"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_c85d3e3c5052e9ad9ce18c6863244a25.html">lib</a></li><li class="navelem"><a class="el" href="dir_d14787c6953e6f59b1408f4bc89aa4da.html">eap</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">tls.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implements the EAP part of EAP-TLS.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="tls_8h_source.html">tls.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="lib_2eap_2attrs_8h_source.html">attrs.h</a>&quot;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for tls.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="tls_8c__incl.svg" width="100%" height="473"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</div>
<p><a href="tls_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4764c0a5e21d9574bdb7bcef9d143e68"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8c.html#a4764c0a5e21d9574bdb7bcef9d143e68">eap_tls_ack</a> (<a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, <a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *eap_session)</td></tr>
<tr class="memdesc:a4764c0a5e21d9574bdb7bcef9d143e68"><td class="mdescLeft">&#160;</td><td class="mdescRight">ACK a fragment of the TLS record from the peer.  <a href="#a4764c0a5e21d9574bdb7bcef9d143e68">More...</a><br /></td></tr>
<tr class="separator:a4764c0a5e21d9574bdb7bcef9d143e68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6249e352898859663be29f75b1e829a7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8c.html#a6249e352898859663be29f75b1e829a7">eap_tls_compose</a> (<a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, <a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *eap_session, <a class="el" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12e">eap_tls_status_t</a> status, uint8_t flags, fr_tls_record_t *record, size_t record_len, size_t frag_len)</td></tr>
<tr class="memdesc:a6249e352898859663be29f75b1e829a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert the EAP-TLS reply packet into an EAP packet.  <a href="#a6249e352898859663be29f75b1e829a7">More...</a><br /></td></tr>
<tr class="separator:a6249e352898859663be29f75b1e829a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac42b34aa8af0ab5b37bdd05cf82e8848"><td class="memItemLeft" align="right" valign="top">fr_tls_conf_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8c.html#ac42b34aa8af0ab5b37bdd05cf82e8848">eap_tls_conf_parse</a> (<a class="el" href="cf__util_8h.html#a0f39d8043920472ea4c687c97f7173b3">CONF_SECTION</a> *cs, char const *attr)</td></tr>
<tr class="memdesc:ac42b34aa8af0ab5b37bdd05cf82e8848"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse TLS configuration.  <a href="#ac42b34aa8af0ab5b37bdd05cf82e8848">More...</a><br /></td></tr>
<tr class="separator:ac42b34aa8af0ab5b37bdd05cf82e8848"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97b48775a94a972992a883fd82947290"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8c.html#a97b48775a94a972992a883fd82947290">eap_tls_fail</a> (<a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, <a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *eap_session)</td></tr>
<tr class="memdesc:a97b48775a94a972992a883fd82947290"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send an EAP-TLS failure.  <a href="#a97b48775a94a972992a883fd82947290">More...</a><br /></td></tr>
<tr class="separator:a97b48775a94a972992a883fd82947290"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabc2d25a51b1065cffe410eb578fbbe2"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12e">eap_tls_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8c.html#aabc2d25a51b1065cffe410eb578fbbe2">eap_tls_handshake</a> (<a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, <a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *eap_session)</td></tr>
<tr class="memdesc:aabc2d25a51b1065cffe410eb578fbbe2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Continue with the handshake.  <a href="#aabc2d25a51b1065cffe410eb578fbbe2">More...</a><br /></td></tr>
<tr class="separator:aabc2d25a51b1065cffe410eb578fbbe2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27e244d3f33734be5a788ab610528e06"><td class="memItemLeft" align="right" valign="top"><a class="el" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12e">eap_tls_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8c.html#a27e244d3f33734be5a788ab610528e06">eap_tls_process</a> (<a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, <a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *eap_session)</td></tr>
<tr class="memdesc:a27e244d3f33734be5a788ab610528e06"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process an EAP TLS request.  <a href="#a27e244d3f33734be5a788ab610528e06">More...</a><br /></td></tr>
<tr class="separator:a27e244d3f33734be5a788ab610528e06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94d9f18de6fa10711657a0f9d4d103cb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8c.html#a94d9f18de6fa10711657a0f9d4d103cb">eap_tls_request</a> (<a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, <a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *eap_session)</td></tr>
<tr class="memdesc:a94d9f18de6fa10711657a0f9d4d103cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frames the OpenSSL data that needs to be sent to the client in an EAP-Request.  <a href="#a94d9f18de6fa10711657a0f9d4d103cb">More...</a><br /></td></tr>
<tr class="separator:a94d9f18de6fa10711657a0f9d4d103cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8d9a6b0edd299041c70c2f0574b15b4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="tls_8h.html#structeap__tls__session__t">eap_tls_session_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8c.html#ad8d9a6b0edd299041c70c2f0574b15b4">eap_tls_session_init</a> (<a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, <a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *eap_session, fr_tls_conf_t *tls_conf, bool client_cert)</td></tr>
<tr class="memdesc:ad8d9a6b0edd299041c70c2f0574b15b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new fr_tls_session_t associated with an <a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a>.  <a href="#ad8d9a6b0edd299041c70c2f0574b15b4">More...</a><br /></td></tr>
<tr class="separator:ad8d9a6b0edd299041c70c2f0574b15b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad75a160b2afa66bbae46e5b6c4572e54"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12e">eap_tls_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8c.html#ad75a160b2afa66bbae46e5b6c4572e54">eap_tls_session_status</a> (<a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, <a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *eap_session)</td></tr>
<tr class="memdesc:ad75a160b2afa66bbae46e5b6c4572e54"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reduce session states down into an easy to use status.  <a href="#ad75a160b2afa66bbae46e5b6c4572e54">More...</a><br /></td></tr>
<tr class="separator:ad75a160b2afa66bbae46e5b6c4572e54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92b2882222297ba5cb85329be7ebb2ea"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8c.html#a92b2882222297ba5cb85329be7ebb2ea">eap_tls_start</a> (<a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, <a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *eap_session)</td></tr>
<tr class="memdesc:a92b2882222297ba5cb85329be7ebb2ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send an initial EAP-TLS request to the peer.  <a href="#a92b2882222297ba5cb85329be7ebb2ea">More...</a><br /></td></tr>
<tr class="separator:a92b2882222297ba5cb85329be7ebb2ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69f1ee5d81795cee7836684a64cd72d2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8c.html#a69f1ee5d81795cee7836684a64cd72d2">eap_tls_success</a> (<a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, <a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *eap_session, char const *keying_prf_label, size_t keying_prf_label_len, char const *sessid_prf_label, size_t sessid_prf_label_len)</td></tr>
<tr class="memdesc:a69f1ee5d81795cee7836684a64cd72d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send an EAP-TLS success.  <a href="#a69f1ee5d81795cee7836684a64cd72d2">More...</a><br /></td></tr>
<tr class="separator:a69f1ee5d81795cee7836684a64cd72d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a123927a2854cc712e18a3c9774acd8e6"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12e">eap_tls_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8c.html#a123927a2854cc712e18a3c9774acd8e6">eap_tls_verify</a> (<a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, <a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *eap_session)</td></tr>
<tr class="memdesc:a123927a2854cc712e18a3c9774acd8e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check that this EAP-TLS packet is correct and the progression of EAP-TLS packets is sane.  <a href="#a123927a2854cc712e18a3c9774acd8e6">More...</a><br /></td></tr>
<tr class="separator:a123927a2854cc712e18a3c9774acd8e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:abf705008d1ff50c8732ca3271e5def56"><td class="memItemLeft" align="right" valign="top"><a class="el" href="build_8h.html#a07ff0f2b21314d8f74a61d89be974f66">USES_APPLE_DEPRECATED_API</a> <a class="el" href="table_8h.html#structfr__table__num__ordered__t">fr_table_num_ordered_t</a> const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8c.html#abf705008d1ff50c8732ca3271e5def56">eap_tls_status_table</a> []</td></tr>
<tr class="separator:abf705008d1ff50c8732ca3271e5def56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76915fb753f22f60c92cf61e9b267bd5"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tls_8c.html#a76915fb753f22f60c92cf61e9b267bd5">eap_tls_status_table_len</a> = <a class="el" href="build_8h.html#ae0bb64e73aeef0ab6772433f210e9d57">NUM_ELEMENTS</a>(<a class="el" href="tls_8h.html#a6d6a114ba908303049edb167870c81a6">eap_tls_status_table</a>)</td></tr>
<tr class="separator:a76915fb753f22f60c92cf61e9b267bd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implements the EAP part of EAP-TLS. </p>
<dl class="section rcs"><dt>Id</dt><dd>4ea8d74df9688866e54120d18c4618727bee968e </dd></dl>
<p>RFC 2716 Section 4.2. PPP EAP TLS Request Packet </p><pre class="fragment">   0               1               2               3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Code      |   Identifier  |        Length           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |     Flags     |      TLS Message Length
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     TLS Message Length     |       TLS Data...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><p>Structure of an EAP-TLS packet</p>
<pre class="fragment">  code    = EAP-code
  id      = EAP-id
  length  = code + id + length + flags + tlsdata
           =  1   +  1 +   2    +  1    +  X
  length  = EAP-length - 1(EAP-Type = 1 octet)
  flags   = EAP-typedata[0] (1 octet)
  data_len    = EAP-typedata[1-4] (4 octets), if L flag set
           = length - 5(code+id+length+flags), otherwise
  data    = EAP-typedata[5-n], if L flag set
           = EAP-typedata[1-n], otherwise
  packet  = EAP-typedata (complete typedata)
</pre><p>The S flag is set only within the EAP-TLS start message sent from the EAP server to the peer.</p>
<p>Similarly, when the EAP server receives an EAP-Response with the M bit set, it MUST respond with an EAP-Request with EAP-Type = EAP-TLS and no data. This serves as a fragment ACK. The EAP peer MUST wait.</p>
<p>The Length field is two octets and indicates the length of the EAP packet including the Code, Identifier, Length, Type, and TLS data fields.</p>
<p>The TLS Message Length field is four octets and indicates the complete reassembled length of the TLS record fragment.</p>
<dl class="section copyright"><dt>Copyright</dt><dd>2001 hereUare Communications, Inc. (<a href="#" onclick="location.href='mai'+'lto:'+'rag'+'hu'+'d@h'+'er'+'eua'+'re'+'.co'+'m'; return false;">raghu<span style="display: none;">.nosp@m.</span>d@he<span style="display: none;">.nosp@m.</span>reuar<span style="display: none;">.nosp@m.</span>e.co<span style="display: none;">.nosp@m.</span>m</a>) </dd>
<dd>
2003 Alan DeKok (<a href="#" onclick="location.href='mai'+'lto:'+'ala'+'nd'+'@fr'+'ee'+'rad'+'iu'+'s.o'+'rg'; return false;">aland<span style="display: none;">.nosp@m.</span>@fre<span style="display: none;">.nosp@m.</span>eradi<span style="display: none;">.nosp@m.</span>us.o<span style="display: none;">.nosp@m.</span>rg</a>) </dd>
<dd>
2006,2015 The FreeRADIUS server project </dd>
<dd>
2015 Arran Cudbard-Bell (<a href="#" onclick="location.href='mai'+'lto:'+'a.c'+'ud'+'bar'+'db'+'@fr'+'ee'+'rad'+'iu'+'s.o'+'rg'; return false;">a.cud<span style="display: none;">.nosp@m.</span>bard<span style="display: none;">.nosp@m.</span>b@fre<span style="display: none;">.nosp@m.</span>erad<span style="display: none;">.nosp@m.</span>ius.o<span style="display: none;">.nosp@m.</span>rg</a>) </dd></dl>

<p class="definition">Definition in file <a class="el" href="tls_8c_source.html">tls.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a4764c0a5e21d9574bdb7bcef9d143e68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4764c0a5e21d9574bdb7bcef9d143e68">&#9670;&nbsp;</a></span>eap_tls_ack()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int eap_tls_ack </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *&#160;</td>
          <td class="paramname"><em>eap_session</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>ACK a fragment of the TLS record from the peer. </p>
<p>EAP server sends an ACK when it determines there are More fragments to receive to make the complete TLS-record.</p>
<p>When the EAP server receives an EAP-Response with the M bit set, it MUST respond with an EAP-Request with EAP-Type = EAP-TLS and no data. This serves as a fragment ACK.</p>
<p>In order to prevent errors in the processing of fragments, the EAP server MUST use increment the Identifier value for each fragment ACK contained within an EAP-Request, and the peer MUST include this Identifier value in the subsequent fragment contained within an EAP-Reponse.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>The current subrequest. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eap_session</td><td>that we're acking the fragment for. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="tls_8c_source.html#l00492">492</a> of file <a class="el" href="tls_8c_source.html">tls.c</a>.</p>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="tls_8c_a4764c0a5e21d9574bdb7bcef9d143e68_cgraph.svg" width="275" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a6249e352898859663be29f75b1e829a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6249e352898859663be29f75b1e829a7">&#9670;&nbsp;</a></span>eap_tls_compose()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int eap_tls_compose </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *&#160;</td>
          <td class="paramname"><em>eap_session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12e">eap_tls_status_t</a>&#160;</td>
          <td class="paramname"><em>status</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fr_tls_record_t *&#160;</td>
          <td class="paramname"><em>record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>record_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>frag_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert the EAP-TLS reply packet into an EAP packet. </p>
<p>The EAP packet will be written to eap_round-&gt;request, with the original reply being untouched.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>The current subrequest. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eap_session</td><td>to continue. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">status</td><td>What type of packet we're sending. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>to set. This is checked to determine if we need to include a length field. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">record</td><td>The record buffer to read from. This most only be set for EAP_TLS_RECORD_SEND packets. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">record_len</td><td>the length of the record we're sending. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">frag_len</td><td>the length of the fragment we're sending. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 on success.</li>
<li>-1 on failure. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="tls_8c_source.html#l00111">111</a> of file <a class="el" href="tls_8c_source.html">tls.c</a>.</p>

</div>
</div>
<a id="ac42b34aa8af0ab5b37bdd05cf82e8848"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac42b34aa8af0ab5b37bdd05cf82e8848">&#9670;&nbsp;</a></span>eap_tls_conf_parse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fr_tls_conf_t* eap_tls_conf_parse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cf__util_8h.html#a0f39d8043920472ea4c687c97f7173b3">CONF_SECTION</a> *&#160;</td>
          <td class="paramname"><em>cs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char const *&#160;</td>
          <td class="paramname"><em>attr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parse TLS configuration. </p>
<p>If the option given by 'attr' is set, we find the config section of that name and use that for the TLS configuration. If not, we fall back to compatibility mode and read the TLS options from the 'tls' section.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cs</td><td>to derive the configuration from. </td></tr>
    <tr><td class="paramname">attr</td><td>identifier for common TLS configuration. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>NULL on error.</li>
<li>A new fr_tls_conf_t on success. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="tls_8c_source.html#l01132">1132</a> of file <a class="el" href="tls_8c_source.html">tls.c</a>.</p>
<div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="tls_8c_ac42b34aa8af0ab5b37bdd05cf82e8848_cgraph.svg" width="100%" height="442"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a97b48775a94a972992a883fd82947290"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97b48775a94a972992a883fd82947290">&#9670;&nbsp;</a></span>eap_tls_fail()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int eap_tls_fail </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *&#160;</td>
          <td class="paramname"><em>eap_session</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send an EAP-TLS failure. </p>
<p>Composes an EAP-TLS-Failure. This is a message with code EAP_TLS_FAILURE. It contains no cryptographic material, and is not protected.</p>
<p>In addition to sending the failure, will destroy any cached session data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>The current subrequest. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eap_session</td><td>that failed. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 on success.</li>
<li>-1 on failure (to compose a valid packet). </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="tls_8c_source.html#l00350">350</a> of file <a class="el" href="tls_8c_source.html">tls.c</a>.</p>
<div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="tls_8c_a97b48775a94a972992a883fd82947290_cgraph.svg" width="271" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aabc2d25a51b1065cffe410eb578fbbe2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabc2d25a51b1065cffe410eb578fbbe2">&#9670;&nbsp;</a></span>eap_tls_handshake()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12e">eap_tls_status_t</a> eap_tls_handshake </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *&#160;</td>
          <td class="paramname"><em>eap_session</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Continue with the handshake. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>the current subrequest. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eap_session</td><td>to continue. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>EAP_TLS_FAIL if the message is invalid.</li>
<li>EAP_TLS_HANDLED if we need to send an additional request to the peer.</li>
<li>EAP_TLS_ESTABLISHED if the handshake completed successfully, and there's no more data to send. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="tls_8c_source.html#l00831">831</a> of file <a class="el" href="tls_8c_source.html">tls.c</a>.</p>
<div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="tls_8c_aabc2d25a51b1065cffe410eb578fbbe2_cgraph.svg" width="480" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a27e244d3f33734be5a788ab610528e06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27e244d3f33734be5a788ab610528e06">&#9670;&nbsp;</a></span>eap_tls_process()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12e">eap_tls_status_t</a> eap_tls_process </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *&#160;</td>
          <td class="paramname"><em>eap_session</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Process an EAP TLS request. </p>
<p>Here we implement a basic state machine. The state machine is implicit and is driven by the state of the TLS session and the flags sent. INCOMING <a class="el" href="snprintf_8h.html#structDATA">DATA</a>:</p><ol type="1">
<li>EAP-TLS should get the compelete TLS data from the peer.</li>
<li>Store that data in a data structure with any other required info</li>
<li>Hand this data structure to the TLS module.</li>
<li>TLS module will perform its operations on the data and hands back to EAP-TLS OUTGOING <a class="el" href="snprintf_8h.html#structDATA">DATA</a>:</li>
</ol>
<ol type="1">
<li>EAP-TLS if necessary will fragment it and send it to the destination.</li>
</ol>
<p>During EAP-TLS initialization, TLS Context object will be initialised and stored. For every new authentication request, TLS will open a new session object and that session object SHOULD be maintained even after the session is completed, for session resumption.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">request</td><td>the request </td></tr>
    <tr><td class="paramname">eap_session</td><td>to continue. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>EAP_TLS_ESTABLISHED</li>
<li>EAP_TLS_HANDLED </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="tls_8c_source.html#l00904">904</a> of file <a class="el" href="tls_8c_source.html">tls.c</a>.</p>
<div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="tls_8c_a27e244d3f33734be5a788ab610528e06_cgraph.svg" width="100%" height="460"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a94d9f18de6fa10711657a0f9d4d103cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94d9f18de6fa10711657a0f9d4d103cb">&#9670;&nbsp;</a></span>eap_tls_request()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int eap_tls_request </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *&#160;</td>
          <td class="paramname"><em>eap_session</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Frames the OpenSSL data that needs to be sent to the client in an EAP-Request. </p>
<p>A single TLS record may be up to 16384 octets in length, but a TLS message may span multiple TLS records, and a TLS certificate message may theoretically, be as big as 16MB.</p>
<p>In EAP-TLS with no inner method, this is used primarily to send our certificate chain to the peer.</p>
<p>In other methods this function is also called to package up application data for the inner tunnel method.</p>
<p>The eap_tls_session-&gt;length_included flag determines whether we include the extra four byte length field in the request and set the L flag.</p>
<p>If present, the tls_length field indicates the total length of the reassembled TLS record.</p>
<p>If eap_tls_session-&gt;length_included this means we include L flag and the tls_length field in EVERY packet we send out.</p>
<p>If !eap_tls_session-&gt;length_included this means we include L flag and tls_length field <b>ONLY</b> in First packet of a fragment series. We do not use it anywhere else.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">request</td><td>the request </td></tr>
    <tr><td class="paramname">eap_session</td><td>that's continuing. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 on success.</li>
<li>-1 on failure. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="tls_8c_source.html#l00400">400</a> of file <a class="el" href="tls_8c_source.html">tls.c</a>.</p>
<div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="tls_8c_a94d9f18de6fa10711657a0f9d4d103cb_cgraph.svg" width="298" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ad8d9a6b0edd299041c70c2f0574b15b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8d9a6b0edd299041c70c2f0574b15b4">&#9670;&nbsp;</a></span>eap_tls_session_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="tls_8h.html#structeap__tls__session__t">eap_tls_session_t</a>* eap_tls_session_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *&#160;</td>
          <td class="paramname"><em>eap_session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fr_tls_conf_t *&#160;</td>
          <td class="paramname"><em>tls_conf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>client_cert</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a new fr_tls_session_t associated with an <a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a>. </p>
<p>Creates a new server fr_tls_session_t and associates it with an <a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> adding EAP specific opaque data to the SSL session created during fr_tls_session_t initialisation.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>The current subrequest. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eap_session</td><td>to use as a context for the <a class="el" href="tls_8h.html#structeap__tls__session__t" title="Tracks the state of an EAP-TLS session. ">eap_tls_session_t</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tls_conf</td><td>to use to configure the fr_tls_session_t. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">client_cert</td><td>Whether we require the peer to prevent a certificate. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>A new eap_tls_session on success.</li>
<li>NULL on error. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="tls_8c_source.html#l01068">1068</a> of file <a class="el" href="tls_8c_source.html">tls.c</a>.</p>

</div>
</div>
<a id="ad75a160b2afa66bbae46e5b6c4572e54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad75a160b2afa66bbae46e5b6c4572e54">&#9670;&nbsp;</a></span>eap_tls_session_status()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12e">eap_tls_status_t</a> eap_tls_session_status </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *&#160;</td>
          <td class="paramname"><em>eap_session</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reduce session states down into an easy to use status. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>The current subrequest. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eap_session</td><td>that we're acking the fragment for. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>EAP_TLS_ESTABLISHED - Handshake completed.</li>
<li>EAP_TLS_FAIL - Fatal alert from the client.</li>
<li>EAP_TLS_RECORD_SEND - Need more data, or previous fragment was acked. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="tls_8c_source.html#l00512">512</a> of file <a class="el" href="tls_8c_source.html">tls.c</a>.</p>

</div>
</div>
<a id="a92b2882222297ba5cb85329be7ebb2ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92b2882222297ba5cb85329be7ebb2ea">&#9670;&nbsp;</a></span>eap_tls_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int eap_tls_start </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *&#160;</td>
          <td class="paramname"><em>eap_session</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send an initial EAP-TLS request to the peer. </p>
<p>Once having received the peer's Identity, the EAP server MUST respond with an EAP-TLS/Start packet, which is an EAP-Request packet with EAP-Type = EAP-TLS, the Start (S) bit set, and no data.</p>
<p>The EAP-TLS conversation will then begin, with the peer sending an EAP-Response packet with EAP-Type = EAP-TLS. The data field of that packet will be the TLS data.</p>
<p>The S flag is set only within the EAP-TLS start message sent from the EAP server to the peer.</p>
<ul>
<li>len = header + type + tls_typedata</li>
<li>tls_typedata = flags(Start (S) bit set, and no data)</li>
</ul>
<p>Fragment length is Framed-MTU - 4.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>The current subrequest. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eap_session</td><td>to initiate. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 on success.</li>
<li>-1 on failure. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="tls_8c_source.html#l00236">236</a> of file <a class="el" href="tls_8c_source.html">tls.c</a>.</p>
<div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="tls_8c_a92b2882222297ba5cb85329be7ebb2ea_cgraph.svg" width="280" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a69f1ee5d81795cee7836684a64cd72d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a69f1ee5d81795cee7836684a64cd72d2">&#9670;&nbsp;</a></span>eap_tls_success()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int eap_tls_success </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *&#160;</td>
          <td class="paramname"><em>eap_session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char const *&#160;</td>
          <td class="paramname"><em>keying_prf_label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>keying_prf_label_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char const *&#160;</td>
          <td class="paramname"><em>sessid_prf_label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>sessid_prf_label_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send an EAP-TLS success. </p>
<p>Composes an EAP-TLS-Success. This is a message with code EAP_TLS_ESTABLISHED. It contains no cryptographic material, and is not protected.</p>
<p>We add the MPPE keys here. These are used by the NAS. The supplicant will derive the same keys separately.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>The current subrequest. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eap_session</td><td>that completed successfully. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">keying_prf_label</td><td>PRF label to use for generating keying material. If NULL, no MPPE keys will be generated. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">keying_prf_label_len</td><td>Length of the keying PRF label. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sessid_prf_label</td><td>PRF label to use when generating the session ID. If NULL, session ID will be based on client/server randoms. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sessid_prf_label_len</td><td>Length of the session ID PRF label. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 on success.</li>
<li>-1 on failure. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="tls_8c_source.html#l00266">266</a> of file <a class="el" href="tls_8c_source.html">tls.c</a>.</p>
<div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="tls_8c_a69f1ee5d81795cee7836684a64cd72d2_cgraph.svg" width="100%" height="466"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a123927a2854cc712e18a3c9774acd8e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a123927a2854cc712e18a3c9774acd8e6">&#9670;&nbsp;</a></span>eap_tls_verify()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12e">eap_tls_status_t</a> eap_tls_verify </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="session_8h.html#a772e0f06abb52a90a255b6b0d9724fe7">eap_session_t</a> *&#160;</td>
          <td class="paramname"><em>eap_session</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check that this EAP-TLS packet is correct and the progression of EAP-TLS packets is sane. </p>
<dl class="section note"><dt>Note</dt><dd>In the received packet, No data will be present incase of ACK or NAK in this case the packet-&gt;data pointer will be NULL.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>the current subrequest. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eap_session</td><td>the current EAP session state. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>EAP_TLS_INVALID if the TLS record or progression is invalid.</li>
<li>EAP_TLS_FAIL handshake failed.</li>
<li>EAP_TLS_RECORD_RECV_FIRST this is the start of a new sequence of record fragments.</li>
<li>EAP_TLS_RECORD_RECV_MORE this is a continuation of a sequence of fragments.</li>
<li>EAP_TLS_RECORD_RECV_COMPLETE we received a completed record.</li>
<li>EAP_TLS_RECORD_SEND send more data to peer.</li>
<li>EAP_TLS_ESTABLISHED handshake is complete, TLS session has been established. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="tls_8c_source.html#l00583">583</a> of file <a class="el" href="tls_8c_source.html">tls.c</a>.</p>
<div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="tls_8c_a123927a2854cc712e18a3c9774acd8e6_cgraph.svg" width="320" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="abf705008d1ff50c8732ca3271e5def56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf705008d1ff50c8732ca3271e5def56">&#9670;&nbsp;</a></span>eap_tls_status_table</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="build_8h.html#a07ff0f2b21314d8f74a61d89be974f66">USES_APPLE_DEPRECATED_API</a> <a class="el" href="table_8h.html#structfr__table__num__ordered__t">fr_table_num_ordered_t</a> const eap_tls_status_table[]</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;invalid&quot;</span>),                 <a class="code" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12ea39784fa8e7305102c83708f3183aa07d">EAP_TLS_INVALID</a>                 },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;established&quot;</span>),             <a class="code" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12eae82dc8452aa75cd26f01eea920f63713">EAP_TLS_ESTABLISHED</a>             },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;fail&quot;</span>),                    <a class="code" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12ead7fbf2f1f7e5b0355565194bdd2f8bcb">EAP_TLS_FAIL</a>                    },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;handled&quot;</span>),                 <a class="code" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12ea3db0f4c21bdc0caec8872d72ebb915d0">EAP_TLS_HANDLED</a>                 },</div><div class="line"></div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;start&quot;</span>),                   <a class="code" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12eab5b3dcd7c3e2188c14971bf262e2eb2b">EAP_TLS_START_SEND</a>              },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;request&quot;</span>),                 <a class="code" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12ea73ca6a0612687dfa380d9b73aa39278c">EAP_TLS_RECORD_SEND</a>             },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;ack&quot;</span>),                     <a class="code" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12ea6794bd6bcbd27745e1b02e55f6f473b5">EAP_TLS_ACK_SEND</a>                },</div><div class="line"></div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;first&quot;</span>),                   <a class="code" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12ea1fc2b015da94cd9af63a9bca668d4d55">EAP_TLS_RECORD_RECV_FIRST</a>       },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;more&quot;</span>),                    <a class="code" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12ea4b55266191e0c623429d533c89f42665">EAP_TLS_RECORD_RECV_MORE</a>        },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;complete&quot;</span>),                        <a class="code" href="tls_8h.html#a2482e2bf7d2331807f586763386cb12ea8c89313b84d28b0a7f369d2e3842a1fc">EAP_TLS_RECORD_RECV_COMPLETE</a>    }</div><div class="line">}</div><div class="ttc" id="tls_8h_html_a2482e2bf7d2331807f586763386cb12ea3db0f4c21bdc0caec8872d72ebb915d0"><div class="ttname"><a href="tls_8h.html#a2482e2bf7d2331807f586763386cb12ea3db0f4c21bdc0caec8872d72ebb915d0">EAP_TLS_HANDLED</a></div><div class="ttdoc">TLS code has handled it. </div><div class="ttdef"><b>Definition:</b> <a href="tls_8h_source.html#l00094">tls.h:94</a></div></div>
<div class="ttc" id="tls_8h_html_a2482e2bf7d2331807f586763386cb12ea6794bd6bcbd27745e1b02e55f6f473b5"><div class="ttname"><a href="tls_8h.html#a2482e2bf7d2331807f586763386cb12ea6794bd6bcbd27745e1b02e55f6f473b5">EAP_TLS_ACK_SEND</a></div><div class="ttdoc">Acknowledge receipt of a record or record fragment. </div><div class="ttdef"><b>Definition:</b> <a href="tls_8h_source.html#l00102">tls.h:102</a></div></div>
<div class="ttc" id="tls_8h_html_a2482e2bf7d2331807f586763386cb12ea4b55266191e0c623429d533c89f42665"><div class="ttname"><a href="tls_8h.html#a2482e2bf7d2331807f586763386cb12ea4b55266191e0c623429d533c89f42665">EAP_TLS_RECORD_RECV_MORE</a></div><div class="ttdoc">Received additional fragment of a record. </div><div class="ttdef"><b>Definition:</b> <a href="tls_8h_source.html#l00110">tls.h:110</a></div></div>
<div class="ttc" id="tls_8h_html_a2482e2bf7d2331807f586763386cb12ea73ca6a0612687dfa380d9b73aa39278c"><div class="ttname"><a href="tls_8h.html#a2482e2bf7d2331807f586763386cb12ea73ca6a0612687dfa380d9b73aa39278c">EAP_TLS_RECORD_SEND</a></div><div class="ttdoc">We&amp;#39;re sending a record. </div><div class="ttdef"><b>Definition:</b> <a href="tls_8h_source.html#l00101">tls.h:101</a></div></div>
<div class="ttc" id="tls_8h_html_a2482e2bf7d2331807f586763386cb12eae82dc8452aa75cd26f01eea920f63713"><div class="ttname"><a href="tls_8h.html#a2482e2bf7d2331807f586763386cb12eae82dc8452aa75cd26f01eea920f63713">EAP_TLS_ESTABLISHED</a></div><div class="ttdoc">Session established, send success (or start phase2). </div><div class="ttdef"><b>Definition:</b> <a href="tls_8h_source.html#l00092">tls.h:92</a></div></div>
<div class="ttc" id="tls_8h_html_a2482e2bf7d2331807f586763386cb12ead7fbf2f1f7e5b0355565194bdd2f8bcb"><div class="ttname"><a href="tls_8h.html#a2482e2bf7d2331807f586763386cb12ead7fbf2f1f7e5b0355565194bdd2f8bcb">EAP_TLS_FAIL</a></div><div class="ttdoc">Fail, send fail. </div><div class="ttdef"><b>Definition:</b> <a href="tls_8h_source.html#l00093">tls.h:93</a></div></div>
<div class="ttc" id="tls_8h_html_a2482e2bf7d2331807f586763386cb12ea39784fa8e7305102c83708f3183aa07d"><div class="ttname"><a href="tls_8h.html#a2482e2bf7d2331807f586763386cb12ea39784fa8e7305102c83708f3183aa07d">EAP_TLS_INVALID</a></div><div class="ttdoc">Invalid, don&amp;#39;t reply. </div><div class="ttdef"><b>Definition:</b> <a href="tls_8h_source.html#l00091">tls.h:91</a></div></div>
<div class="ttc" id="tls_8h_html_a2482e2bf7d2331807f586763386cb12eab5b3dcd7c3e2188c14971bf262e2eb2b"><div class="ttname"><a href="tls_8h.html#a2482e2bf7d2331807f586763386cb12eab5b3dcd7c3e2188c14971bf262e2eb2b">EAP_TLS_START_SEND</a></div><div class="ttdoc">We&amp;#39;re starting a new TLS session. </div><div class="ttdef"><b>Definition:</b> <a href="tls_8h_source.html#l00100">tls.h:100</a></div></div>
<div class="ttc" id="build_8h_html_a2c7b7cca6314b99cc417bde2ce3542a4"><div class="ttname"><a href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a></div><div class="ttdeci">#define L(_str)</div><div class="ttdef"><b>Definition:</b> <a href="build_8h_source.html#l00078">build.h:78</a></div></div>
<div class="ttc" id="tls_8h_html_a2482e2bf7d2331807f586763386cb12ea8c89313b84d28b0a7f369d2e3842a1fc"><div class="ttname"><a href="tls_8h.html#a2482e2bf7d2331807f586763386cb12ea8c89313b84d28b0a7f369d2e3842a1fc">EAP_TLS_RECORD_RECV_COMPLETE</a></div><div class="ttdoc">Received final fragment of a record. </div><div class="ttdef"><b>Definition:</b> <a href="tls_8h_source.html#l00111">tls.h:111</a></div></div>
<div class="ttc" id="tls_8h_html_a2482e2bf7d2331807f586763386cb12ea1fc2b015da94cd9af63a9bca668d4d55"><div class="ttname"><a href="tls_8h.html#a2482e2bf7d2331807f586763386cb12ea1fc2b015da94cd9af63a9bca668d4d55">EAP_TLS_RECORD_RECV_FIRST</a></div><div class="ttdoc">Received first fragment of a record. </div><div class="ttdef"><b>Definition:</b> <a href="tls_8h_source.html#l00109">tls.h:109</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="tls_8c_source.html#l00077">77</a> of file <a class="el" href="tls_8c_source.html">tls.c</a>.</p>

</div>
</div>
<a id="a76915fb753f22f60c92cf61e9b267bd5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76915fb753f22f60c92cf61e9b267bd5">&#9670;&nbsp;</a></span>eap_tls_status_table_len</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t eap_tls_status_table_len = <a class="el" href="build_8h.html#ae0bb64e73aeef0ab6772433f210e9d57">NUM_ELEMENTS</a>(<a class="el" href="tls_8h.html#a6d6a114ba908303049edb167870c81a6">eap_tls_status_table</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tls_8c_source.html#l00091">91</a> of file <a class="el" href="tls_8c_source.html">tls.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 12 2020 23:18:45 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
