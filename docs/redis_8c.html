<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>/home/runner/work/freeradius-server/freeradius-server/src/lib/redis/redis.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="freeradius.png"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_c85d3e3c5052e9ad9ce18c6863244a25.html">lib</a></li><li class="navelem"><a class="el" href="dir_efa02c211b4bb5072e90e61ec8101341.html">redis</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">redis.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>conf functions for interacting with Redis cluster via Hiredis.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;freeradius-devel/redis/base.h&gt;</code><br />
<code>#include &lt;freeradius-devel/util/debug.h&gt;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for redis.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="redis_8c__incl.svg" width="318" height="156"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div>
<p><a href="redis_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8d50cc44bc2c01ee467592f85fa79c5e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feb">fr_redis_rcode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="redis_8c.html#a8d50cc44bc2c01ee467592f85fa79c5e">fr_redis_command_status</a> (<a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> *conn, redisReply *reply)</td></tr>
<tr class="memdesc:a8d50cc44bc2c01ee467592f85fa79c5e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check the reply for errors.  <a href="#a8d50cc44bc2c01ee467592f85fa79c5e">More...</a><br /></td></tr>
<tr class="separator:a8d50cc44bc2c01ee467592f85fa79c5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad12fad323b37b4d154924c8de335ca68"><td class="memItemLeft" align="right" valign="top"><a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feb">fr_redis_rcode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="redis_8c.html#ad12fad323b37b4d154924c8de335ca68">fr_redis_get_version</a> (char *<a class="el" href="value_8h.html#af17d2d4e72bd60de680d3f4a29a1275f">out</a>, size_t out_len, <a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> *conn)</td></tr>
<tr class="memdesc:ad12fad323b37b4d154924c8de335ca68"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the version of Redis running on the remote server.  <a href="#ad12fad323b37b4d154924c8de335ca68">More...</a><br /></td></tr>
<tr class="separator:ad12fad323b37b4d154924c8de335ca68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd79a7ef0257b1f2ffac6f8a128f9bf1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feb">fr_redis_rcode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="redis_8c.html#abd79a7ef0257b1f2ffac6f8a128f9bf1">fr_redis_pipeline_result</a> (unsigned int *pipelined, <a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feb">fr_redis_rcode_t</a> *rcode, redisReply *<a class="el" href="value_8h.html#af17d2d4e72bd60de680d3f4a29a1275f">out</a>[], size_t out_len, <a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> *conn)</td></tr>
<tr class="memdesc:abd79a7ef0257b1f2ffac6f8a128f9bf1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Simplifies handling of pipelined commands with Redis cluster.  <a href="#abd79a7ef0257b1f2ffac6f8a128f9bf1">More...</a><br /></td></tr>
<tr class="separator:abd79a7ef0257b1f2ffac6f8a128f9bf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6724426668143b733c8b8460f2635f41"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="redis_8c.html#a6724426668143b733c8b8460f2635f41">fr_redis_reply_print</a> (<a class="el" href="lib_2util_2log_8h.html#a4710662265e4ac568d781e53d4170eb1">fr_log_lvl_t</a> lvl, redisReply *reply, <a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, int idx)</td></tr>
<tr class="memdesc:a6724426668143b733c8b8460f2635f41"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print the response data in a useful treelike form.  <a href="#a6724426668143b733c8b8460f2635f41">More...</a><br /></td></tr>
<tr class="separator:a6724426668143b733c8b8460f2635f41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8dd8eb64121085c2fa006cfa0e9bbee3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="redis_8c.html#a8dd8eb64121085c2fa006cfa0e9bbee3">fr_redis_reply_to_map</a> (TALLOC_CTX *ctx, <a class="el" href="map_8h.html#ad7780c38e6e1dccdce4b9cf525e3c479">map_t</a> **<a class="el" href="value_8h.html#af17d2d4e72bd60de680d3f4a29a1275f">out</a>, <a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, redisReply *key, redisReply *op, redisReply *value)</td></tr>
<tr class="memdesc:a8dd8eb64121085c2fa006cfa0e9bbee3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert a pair of redis reply objects to a map.  <a href="#a8dd8eb64121085c2fa006cfa0e9bbee3">More...</a><br /></td></tr>
<tr class="separator:a8dd8eb64121085c2fa006cfa0e9bbee3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa13699b4e785d39a92e4af83cf2c1d64"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="redis_8c.html#aa13699b4e785d39a92e4af83cf2c1d64">fr_redis_reply_to_value_box</a> (TALLOC_CTX *ctx, <a class="el" href="value_8h.html#a4a9e69e78ad1a81da0976e8f29a4e444">fr_value_box_t</a> *<a class="el" href="value_8h.html#af17d2d4e72bd60de680d3f4a29a1275f">out</a>, redisReply *reply, <a class="el" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30">fr_type_t</a> dst_type, <a class="el" href="dict_8h.html#aed6e1e08277e8ccb5c51266dc7b8fbb1">fr_dict_attr_t</a> const *dst_enumv)</td></tr>
<tr class="memdesc:aa13699b4e785d39a92e4af83cf2c1d64"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert a string or integer type to <a class="el" href="value_8h.html#a4a9e69e78ad1a81da0976e8f29a4e444">fr_value_box_t</a> of specified type.  <a href="#aa13699b4e785d39a92e4af83cf2c1d64">More...</a><br /></td></tr>
<tr class="separator:aa13699b4e785d39a92e4af83cf2c1d64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e0d2d2158ba30270f03d39f74eef631"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="redis_8c.html#a5e0d2d2158ba30270f03d39f74eef631">fr_redis_tuple_from_map</a> (TALLOC_CTX *pool, char const *<a class="el" href="value_8h.html#af17d2d4e72bd60de680d3f4a29a1275f">out</a>[], size_t out_len[], <a class="el" href="map_8h.html#ad7780c38e6e1dccdce4b9cf525e3c479">map_t</a> *<a class="el" href="rlm__expr_8c.html#a67a61c02f0eccbad6b342dd9adeb7994">map</a>)</td></tr>
<tr class="memdesc:a5e0d2d2158ba30270f03d39f74eef631"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a single map pair to an existing command string as three elements.  <a href="#a5e0d2d2158ba30270f03d39f74eef631">More...</a><br /></td></tr>
<tr class="separator:a5e0d2d2158ba30270f03d39f74eef631"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a663c9e7aa55c5801cab7cc5fdf270b"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="redis_8c.html#a8a663c9e7aa55c5801cab7cc5fdf270b">fr_redis_version_num</a> (char const *version)</td></tr>
<tr class="memdesc:a8a663c9e7aa55c5801cab7cc5fdf270b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert version string into a 32bit unsigned integer for comparisons.  <a href="#a8a663c9e7aa55c5801cab7cc5fdf270b">More...</a><br /></td></tr>
<tr class="separator:a8a663c9e7aa55c5801cab7cc5fdf270b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a849d5c84f88aacb050fb070f059bc86e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="redis_8c.html#a849d5c84f88aacb050fb070f059bc86e">fr_redis_version_print</a> (void)</td></tr>
<tr class="memdesc:a849d5c84f88aacb050fb070f059bc86e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print the version of libhiredis the server was built against.  <a href="#a849d5c84f88aacb050fb070f059bc86e">More...</a><br /></td></tr>
<tr class="separator:a849d5c84f88aacb050fb070f059bc86e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a1bf4726950ce886a19ae544aa30a2c28"><td class="memItemLeft" align="right" valign="top"><a class="el" href="table_8h.html#structfr__table__num__sorted__t">fr_table_num_sorted_t</a> const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="redis_8c.html#a1bf4726950ce886a19ae544aa30a2c28">redis_rcodes</a> []</td></tr>
<tr class="separator:a1bf4726950ce886a19ae544aa30a2c28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0443b0b0468a239818ee9908091e9d9"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="redis_8c.html#aa0443b0b0468a239818ee9908091e9d9">redis_rcodes_len</a> = <a class="el" href="build_8h.html#ae0bb64e73aeef0ab6772433f210e9d57">NUM_ELEMENTS</a>(<a class="el" href="redis_8c.html#a1bf4726950ce886a19ae544aa30a2c28">redis_rcodes</a>)</td></tr>
<tr class="separator:aa0443b0b0468a239818ee9908091e9d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fcb3961ee3b3433776672ecc6a426c9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="table_8h.html#structfr__table__num__sorted__t">fr_table_num_sorted_t</a> const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="redis_8c.html#a9fcb3961ee3b3433776672ecc6a426c9">redis_reply_types</a> []</td></tr>
<tr class="separator:a9fcb3961ee3b3433776672ecc6a426c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f50385ad990f0912b42ab66b1dbabbd"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="redis_8c.html#a6f50385ad990f0912b42ab66b1dbabbd">redis_reply_types_len</a> = <a class="el" href="build_8h.html#ae0bb64e73aeef0ab6772433f210e9d57">NUM_ELEMENTS</a>(<a class="el" href="redis_8c.html#a9fcb3961ee3b3433776672ecc6a426c9">redis_reply_types</a>)</td></tr>
<tr class="separator:a6f50385ad990f0912b42ab66b1dbabbd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>conf functions for interacting with Redis cluster via Hiredis. </p>
<p>Common functions for interacting with Redis via hiredis.</p>
<dl class="section rcs"><dt>Id</dt><dd>5a42061574988eb29b5d066d5edff0bd8902147c </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Arran Cudbard-Bell</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>2015 Arran Cudbard-Bell (<a href="#" onclick="location.href='mai'+'lto:'+'a.c'+'ud'+'bar'+'db'+'@fr'+'ee'+'rad'+'iu'+'s.o'+'rg'; return false;">a.cud<span style="display: none;">.nosp@m.</span>bard<span style="display: none;">.nosp@m.</span>b@fre<span style="display: none;">.nosp@m.</span>erad<span style="display: none;">.nosp@m.</span>ius.o<span style="display: none;">.nosp@m.</span>rg</a>) </dd>
<dd>
2015 Network RADIUS (<a href="#" onclick="location.href='mai'+'lto:'+'leg'+'al'+'@ne'+'tw'+'ork'+'ra'+'diu'+'s.'+'com'; return false;">legal<span style="display: none;">.nosp@m.</span>@net<span style="display: none;">.nosp@m.</span>workr<span style="display: none;">.nosp@m.</span>adiu<span style="display: none;">.nosp@m.</span>s.com</a>) </dd>
<dd>
2015 The FreeRADIUS server project</dd></dl>
<h1><a class="anchor" id="autotoc_md0"></a>
Overview</h1>
<p>Read and understand this <a href="http://redis.io/topics/cluster-spec">http://redis.io/topics/cluster-spec</a> first, else the text below will not be useful.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Using the cluster's public API</h2>
<p>The two functions used at runtime to issue commands are <a class="el" href="cluster_8h.html#ac292207b4d5816986eb8e4457791b491" title="Resolve a key to a pool, and reserve a connection in that pool. ">fr_redis_cluster_state_init</a> and <a class="el" href="cluster_8h.html#a02e48068a3e77ab228e414708b5543ee" title="Get the next connection to attempt a command against. ">fr_redis_cluster_state_next</a>.</p>
<p><a class="el" href="cluster_8h.html#ac292207b4d5816986eb8e4457791b491" title="Resolve a key to a pool, and reserve a connection in that pool. ">fr_redis_cluster_state_init</a> initialises the structure we use to track which node we're communicating with, and uses a key (string) to determine which node we should try and contact first.</p>
<p><a class="el" href="cluster_8h.html#a02e48068a3e77ab228e414708b5543ee" title="Get the next connection to attempt a command against. ">fr_redis_cluster_state_next</a> examines the result of the last command, and either gets a new connection, or errors out.</p>
<p>In both cases the connection should not be released by the caller, only by <a class="el" href="cluster_8h.html#a02e48068a3e77ab228e414708b5543ee" title="Get the next connection to attempt a command against. ">fr_redis_cluster_state_next</a>.</p>
<p>Below is the sequence of calls required to use the cluster: </p><pre class="fragment">1. During initialization allocate a cluster configuration structure with
   #fr_redis_cluster_alloc.  This holds the cluster configuration and state.
2. Declare a #fr_redis_cluster_state_t in the function that needs to issue
   commands against the cluster.
3. Call #fr_redis_cluster_state_init with relevant arguments including a pointer
   to the #fr_redis_cluster_state_t struct, and a key/key_len used for initial
   lookup.  For most commands the key is the value of the second argument.
   #fr_redis_cluster_state_init will then and reserve/pass back a connection for
   the pool associated with the node associated with the key.
4. Use the connection that was passed back, to issue a Redis command against.
5. Use #fr_redis_command_status to translate the result of the command into
   a #fr_redis_rcode_t value.
6. Call #fr_redis_cluster_state_next with relevant arguments including a pointer
   to the #fr_redis_cluster_state_t struct and the #fr_redis_rcode_t value for the
   last command.
7. If #fr_redis_cluster_state_next returns 0, repeat steps 4-7.  Otherwise
   stop and analyse the return value.
</pre><p>See <a class="el" href="cluster_8h.html#ac292207b4d5816986eb8e4457791b491" title="Resolve a key to a pool, and reserve a connection in that pool. ">fr_redis_cluster_state_init</a> for example code.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Structures</h2>
<p>This code maintains a series structures for efficient lookup and lockless operations.</p>
<p>The important ones are:</p><ul>
<li>An array of <a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a>. These are pre-allocated on startup and are never added to, or removed from.</li>
<li>An <a class="el" href="fifo_8h.html#a6f80b6c73f33bb497fb50bfc8392875f">fr_fifo_t</a>. This contains the queue of nodes that may be re-used.</li>
<li>An <a class="el" href="rbtree_8h.html#a8cd95efc535063a7e3189c83294d9056">rbtree_t</a>. This contains a tree of nodes which are active. The tree is built on IP address and port.</li>
</ul>
<p>Each <a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> contains a master ID, and an array of slave IDs. The IDs are array indexes in the <a class="el" href="cluster_8c.html#af484f6e7009b3d77d551a43233e6a8f2" title="Structure containing a node id, its address and a pool of its connections. ">fr_redis_cluster_t.node</a> array. We use 8bit unsigned integers instead of pointers to save space. Using pointers, the node[] array would need 784K, using IDs it uses 112K. Still not light on memory, but a bit more acceptable. Currently the key_slot array is shadowed by key_slot_pending, used to stage new key_slot mappings. This doubles the memory used. We may want to consider allocating key_slot_pending only during remappings and freeing it after.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Mapping/Remapping the cluster</h2>
<p>On startup, and during cluster operation, a remap may be performed. A remap involves the following steps:</p>
<ol type="1">
<li>Executing the Redis 'cluster slots' command.</li>
<li>Validating the result of this command. We need to do extensive validation to avoid SEGV on invalid data, due to the way libhiredis presents the result.</li>
<li>Determining the intersection between nodes described in the result, and those already in our <a class="el" href="rbtree_8h.html#a8cd95efc535063a7e3189c83294d9056">rbtree_t</a>.</li>
<li>Connecting to nodes that were in the result, but not in the tree. Note: If we can't connect to any of the masters, we count the map as invalid, roll back any newly connected nodes, and error out. Slave failure is OK.</li>
<li>Mapping keyslot ranges to nodes in the key_slot_pending array.</li>
<li>Verifying there are no holes in the ranges (if there are, we roll back and error out).</li>
<li>Applying the new keyslot ranges.</li>
<li>Removing nodes no longer used by the key slots, and adding them back to the free nodes queue.</li>
</ol>
<p><a class="el" href="cluster_8c.html#a010b9b97335d882b7becb494a6c9b0cc" title="Learn a new cluster layout by querying the node that issued the -MOVE. ">cluster_map_get</a> and <a class="el" href="cluster_8c.html#ab434868c42486ab9876b2043c26439f2" title="Apply a cluster map received from a cluster node. ">cluster_map_apply</a>, perform the operations described above. The get function, issues the 'cluster slots' command and performs validation, the apply function processes and applys the map.</p>
<p>Failing to apply a map is not a fatal error at runtime, and is only fatal on startup if pool.start &gt; 0.</p>
<p>The cluster client can continue to operate, albeit inefficiently, with a stale cluster map by following '-ASK' and '-MOVE' redirects.</p>
<p>Remaps are limited to one per second. If any operation sets the remap_needed flag, or attempts a remap directly, the remap may be skipped if one occurred recently.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Processing '-ASK' and '-MOVE' redirects</h2>
<p>The code treats '-ASK' (temporary redirect) and '-MOVE' (permanent redirect) responses similarly. If the node is known, then a connection is reserved from its pool, if the node is not known, a new pool is established, and a connection reserved.</p>
<p>The difference between '-ASK' and '-MOVE' is that '-MOVE' attempts a cluster remap before following the redirect.</p>
<p>The data from '-MOVE' responses, is not used to alter the cluster map. That is only done on successful remap.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Processing '-TRYAGAIN'</h2>
<p>If the cluster is in a state of flux, a node may return '-TRYAGAIN' to indicated that we should attempt the operation again. The cluster spec says we should attempt the operation after some time. This time is configurable.</p>
<dl class="section rcs"><dt>Id</dt><dd>4d39565e8dee244fd4467de30cad5e3d2c1a34f3 </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>2015 Arran Cudbard-Bell (<a href="#" onclick="location.href='mai'+'lto:'+'a.c'+'ud'+'bar'+'db'+'@fr'+'ee'+'rad'+'iu'+'s.o'+'rg'; return false;">a.cud<span style="display: none;">.nosp@m.</span>bard<span style="display: none;">.nosp@m.</span>b@fre<span style="display: none;">.nosp@m.</span>erad<span style="display: none;">.nosp@m.</span>ius.o<span style="display: none;">.nosp@m.</span>rg</a>) </dd>
<dd>
2000,2006,2015 The FreeRADIUS server project </dd>
<dd>
2011 TekSavvy Solutions (<a href="#" onclick="location.href='mai'+'lto:'+'gab'+'e@'+'tek'+'sa'+'vvy'+'.c'+'om'; return false;">gabe@<span style="display: none;">.nosp@m.</span>teks<span style="display: none;">.nosp@m.</span>avvy.<span style="display: none;">.nosp@m.</span>com</a>) </dd></dl>

<p class="definition">Definition in file <a class="el" href="redis_8c_source.html">redis.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a8d50cc44bc2c01ee467592f85fa79c5e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d50cc44bc2c01ee467592f85fa79c5e">&#9670;&nbsp;</a></span>fr_redis_command_status()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feb">fr_redis_rcode_t</a> fr_redis_command_status </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">redisReply *&#160;</td>
          <td class="paramname"><em>reply</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check the reply for errors. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conn</td><td>used to issue the command. </td></tr>
    <tr><td class="paramname">reply</td><td>to process. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>REDIS_RCODE_TRY_AGAIN - If the operation should be retries.</li>
<li>REDIS_RCODE_MOVED - If the key has been permanently moved.</li>
<li>REDIS_RCODE_ASK - If the key has been temporarily moved.</li>
<li>REDIS_RCODE_SUCCESS - if no errors.</li>
<li>REDIS_RCODE_ERROR - on command/server error.</li>
<li>REDIS_RCODE_NO_SCRIPT - script specified by evalsha doesn't exist.</li>
<li>REDIS_RCODE_RECONNECT - on connection error (probably needs reconnecting). </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="redis_8c_source.html#l00070">70</a> of file <a class="el" href="redis_8c_source.html">redis.c</a>.</p>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="redis_8c_a8d50cc44bc2c01ee467592f85fa79c5e_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="redis_8c_a8d50cc44bc2c01ee467592f85fa79c5e_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ad12fad323b37b4d154924c8de335ca68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad12fad323b37b4d154924c8de335ca68">&#9670;&nbsp;</a></span>fr_redis_get_version()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feb">fr_redis_rcode_t</a> fr_redis_get_version </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>out_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the version of Redis running on the remote server. </p>
<p>This can be useful for some modules, as it allows adaptive behaviour, or early termination.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">out</td><td>Where to write the version string. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">out_len</td><td>Length of the version string buffer. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">conn</td><td>Used to query the version string. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li><a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feba2eb70a0603aecb095503701aa390b4e9" title="Operation was successfull. ">REDIS_RCODE_SUCCESS</a> on success.</li>
<li><a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387febaf1a348dcc1bddf862657b568939df450" title="Unrecoverable library/server error. ">REDIS_RCODE_ERROR</a> on command/response mismatch or command error.</li>
<li>REDIS_RCODE_* on other errors; </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="redis_8c_source.html#l00532">532</a> of file <a class="el" href="redis_8c_source.html">redis.c</a>.</p>
<div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="redis_8c_ad12fad323b37b4d154924c8de335ca68_cgraph.svg" width="100%" height="594"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="redis_8c_ad12fad323b37b4d154924c8de335ca68_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="abd79a7ef0257b1f2ffac6f8a128f9bf1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd79a7ef0257b1f2ffac6f8a128f9bf1">&#9670;&nbsp;</a></span>fr_redis_pipeline_result()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feb">fr_redis_rcode_t</a> fr_redis_pipeline_result </td>
          <td>(</td>
          <td class="paramtype">unsigned int *&#160;</td>
          <td class="paramname"><em>pipelined</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feb">fr_redis_rcode_t</a> *&#160;</td>
          <td class="paramname"><em>rcode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">redisReply *&#160;</td>
          <td class="paramname"><em>out</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>out_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Simplifies handling of pipelined commands with Redis cluster. </p>
<p>Retrieve all available pipelined responses, and write them to the array.</p>
<p>On encountering an error, all previously retrieved responses are freed, and the reply containing the error is written to the first element of out. All responses after the error are also freed.</p>
<p>If the number of responses != pipelined, that's also an error, a very serious one, in libhiredis or Redis. We can't really do much here apart from error out.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">pipelined</td><td>Number of pipelined commands we sent to the server. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">rcode</td><td>Status of the first errored response, or REDIS_RCODE_SUCCESS if all responses were processed. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out</td><td>Where to write the replies from pipelined commands. Will contain exactly 1 element on error WHICH MUST BE FREED, else the number passed in pipelined. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">out_len</td><td>number of elements in out. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">conn</td><td>the pipelined commands were issued on. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li><a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feba2eb70a0603aecb095503701aa390b4e9" title="Operation was successfull. ">REDIS_RCODE_SUCCESS</a> on success.</li>
<li><a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387febaf1a348dcc1bddf862657b568939df450" title="Unrecoverable library/server error. ">REDIS_RCODE_ERROR</a> on command/response mismatch or command error.</li>
<li>REDIS_RCODE_* on other errors; </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="redis_8c_source.html#l00429">429</a> of file <a class="el" href="redis_8c_source.html">redis.c</a>.</p>
<div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="redis_8c_abd79a7ef0257b1f2ffac6f8a128f9bf1_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="redis_8c_abd79a7ef0257b1f2ffac6f8a128f9bf1_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a6724426668143b733c8b8460f2635f41"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6724426668143b733c8b8460f2635f41">&#9670;&nbsp;</a></span>fr_redis_reply_print()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fr_redis_reply_print </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="lib_2util_2log_8h.html#a4710662265e4ac568d781e53d4170eb1">fr_log_lvl_t</a>&#160;</td>
          <td class="paramname"><em>lvl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">redisReply *&#160;</td>
          <td class="paramname"><em>reply</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>idx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print the response data in a useful treelike form. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lvl</td><td>to print data at. </td></tr>
    <tr><td class="paramname">reply</td><td>to print. </td></tr>
    <tr><td class="paramname">request</td><td>The current request. </td></tr>
    <tr><td class="paramname">idx</td><td>Response number. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="redis_8c_source.html#l00135">135</a> of file <a class="el" href="redis_8c_source.html">redis.c</a>.</p>
<div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="redis_8c_a6724426668143b733c8b8460f2635f41_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a8dd8eb64121085c2fa006cfa0e9bbee3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8dd8eb64121085c2fa006cfa0e9bbee3">&#9670;&nbsp;</a></span>fr_redis_reply_to_map()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fr_redis_reply_to_map </td>
          <td>(</td>
          <td class="paramtype">TALLOC_CTX *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="map_8h.html#ad7780c38e6e1dccdce4b9cf525e3c479">map_t</a> **&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">redisReply *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">redisReply *&#160;</td>
          <td class="paramname"><em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">redisReply *&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert a pair of redis reply objects to a map. </p>
<p>The maps can then be applied using <a class="el" href="map_8h.html#aa009f814e72685cac7c2f42a0dd95453" title="Convert map_t to fr_pair_t (s) and add them to a request_t. ">map_to_request</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>to allocate maps in. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out</td><td>Where to write the head of the new maps list. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>The current request. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">key</td><td>to process. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">op</td><td>to process. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">value</td><td>to process. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 on success.</li>
<li>-1 on failure. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="redis_8c_source.html#l00265">265</a> of file <a class="el" href="redis_8c_source.html">redis.c</a>.</p>
<div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="redis_8c_a8dd8eb64121085c2fa006cfa0e9bbee3_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="redis_8c_a8dd8eb64121085c2fa006cfa0e9bbee3_icgraph.svg" width="331" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aa13699b4e785d39a92e4af83cf2c1d64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa13699b4e785d39a92e4af83cf2c1d64">&#9670;&nbsp;</a></span>fr_redis_reply_to_value_box()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fr_redis_reply_to_value_box </td>
          <td>(</td>
          <td class="paramtype">TALLOC_CTX *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="value_8h.html#a4a9e69e78ad1a81da0976e8f29a4e444">fr_value_box_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">redisReply *&#160;</td>
          <td class="paramname"><em>reply</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30">fr_type_t</a>&#160;</td>
          <td class="paramname"><em>dst_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="dict_8h.html#aed6e1e08277e8ccb5c51266dc7b8fbb1">fr_dict_attr_t</a> const *&#160;</td>
          <td class="paramname"><em>dst_enumv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert a string or integer type to <a class="el" href="value_8h.html#a4a9e69e78ad1a81da0976e8f29a4e444">fr_value_box_t</a> of specified type. </p>
<p>Will work with REDIS_REPLY_STRING (which is converted to <a class="el" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30a3277792336b6d6c1577f0cbb53f74381" title="String of printable characters. ">FR_TYPE_STRING</a> then cast to dst_type), or REDIS_REPLY_INTEGER (which is converted to <a class="el" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30aacc9d809a7a605775fff050eb108ff02" title="64 Bit unsigned integer. ">FR_TYPE_UINT64</a>, then cast to dst_type).</p>
<dl class="section note"><dt>Note</dt><dd>Any unsupported types will trigger an assert. You must check the reply type prior to calling this function.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>to allocate any buffers in. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out</td><td>Where to write the cast type. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">reply</td><td>to process. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dst_type</td><td>to convert to. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dst_enumv</td><td>Used to convert string types to integers for attributes with enumerated values. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>1 if we received a NIL reply. Out will remain uninitialized.</li>
<li>0 on success.</li>
<li>-1 on cast or parse failure. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="redis_8c_source.html#l00193">193</a> of file <a class="el" href="redis_8c_source.html">redis.c</a>.</p>
<div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="redis_8c_aa13699b4e785d39a92e4af83cf2c1d64_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-11" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="redis_8c_aa13699b4e785d39a92e4af83cf2c1d64_icgraph.svg" width="563" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a5e0d2d2158ba30270f03d39f74eef631"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e0d2d2158ba30270f03d39f74eef631">&#9670;&nbsp;</a></span>fr_redis_tuple_from_map()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fr_redis_tuple_from_map </td>
          <td>(</td>
          <td class="paramtype">TALLOC_CTX *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char const *&#160;</td>
          <td class="paramname"><em>out</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>out_len</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="map_8h.html#ad7780c38e6e1dccdce4b9cf525e3c479">map_t</a> *&#160;</td>
          <td class="paramname"><em>map</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a single map pair to an existing command string as three elements. </p>
<ul>
<li>Integer types will be encoded as integers.</li>
<li>Strings and octets will be encoded in their raw form.</li>
<li>Other types will be converted to their printable form and will be encoded as strings.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>lhs must be a <a class="el" href="server_2tmpl_8h.html#a6253c44d928d1abe5d85e2b02365a489a1e7ea842d4b76eab97e3ad6cdcb2bfbc" title="Reference to one or more attributes. ">TMPL_TYPE_ATTR</a>. </dd>
<dd>
rhs must be a <a class="el" href="server_2tmpl_8h.html#a6253c44d928d1abe5d85e2b02365a489a925a409742fda003b63ac53a0a96aaa9" title="Value in native boxed format. ">TMPL_TYPE_DATA</a>.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>to allocate any buffers in. </td></tr>
    <tr><td class="paramname">out</td><td>Where to write pointers to the member of the tuple. Unused elements should be a multiple of three, and it should have at least three unused elements. </td></tr>
    <tr><td class="paramname">out_len</td><td>Where to write the size of the data pointed to by the equivalent index in the out array. </td></tr>
    <tr><td class="paramname">map</td><td>to convert. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success. -1 on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="redis_8c_source.html#l00354">354</a> of file <a class="el" href="redis_8c_source.html">redis.c</a>.</p>
<div id="dynsection-12" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="redis_8c_a5e0d2d2158ba30270f03d39f74eef631_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-13" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="redis_8c_a5e0d2d2158ba30270f03d39f74eef631_icgraph.svg" width="356" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a8a663c9e7aa55c5801cab7cc5fdf270b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a663c9e7aa55c5801cab7cc5fdf270b">&#9670;&nbsp;</a></span>fr_redis_version_num()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t fr_redis_version_num </td>
          <td>(</td>
          <td class="paramtype">char const *&#160;</td>
          <td class="paramname"><em>version</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert version string into a 32bit unsigned integer for comparisons. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">version</td><td>string to parse. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>32bit unsigned integer representing the version string. </dd></dl>

<p class="definition">Definition at line <a class="el" href="redis_8c_source.html#l00582">582</a> of file <a class="el" href="redis_8c_source.html">redis.c</a>.</p>
<div id="dynsection-14" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="redis_8c_a8a663c9e7aa55c5801cab7cc5fdf270b_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-15" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-15-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-15-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-15-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="redis_8c_a8a663c9e7aa55c5801cab7cc5fdf270b_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a849d5c84f88aacb050fb070f059bc86e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a849d5c84f88aacb050fb070f059bc86e">&#9670;&nbsp;</a></span>fr_redis_version_print()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fr_redis_version_print </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print the version of libhiredis the server was built against. </p>

<p class="definition">Definition at line <a class="el" href="redis_8c_source.html#l00052">52</a> of file <a class="el" href="redis_8c_source.html">redis.c</a>.</p>
<div id="dynsection-16" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-16-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-16-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-16-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="redis_8c_a849d5c84f88aacb050fb070f059bc86e_icgraph.svg" width="284" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a1bf4726950ce886a19ae544aa30a2c28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bf4726950ce886a19ae544aa30a2c28">&#9670;&nbsp;</a></span>redis_rcodes</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="table_8h.html#structfr__table__num__sorted__t">fr_table_num_sorted_t</a> const redis_rcodes[]</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;ask&quot;</span>),     <a class="code" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387febaf0c7f93c2a2c912e44d099b1ed3ac291">REDIS_RCODE_ASK</a>         },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;error&quot;</span>),   <a class="code" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387febaf1a348dcc1bddf862657b568939df450">REDIS_RCODE_ERROR</a>       },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;move&quot;</span>),    <a class="code" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387febac861b3123c9b1c8d8a8eeb33b6f97f79">REDIS_RCODE_MOVE</a>        },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;reconnect&quot;</span>),       <a class="code" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feba06a816f21162d61b65e967649e181584">REDIS_RCODE_RECONNECT</a>   },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;success&quot;</span>), <a class="code" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feba2eb70a0603aecb095503701aa390b4e9">REDIS_RCODE_SUCCESS</a>     },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;try again&quot;</span>),       <a class="code" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387febad1e50fa0ac16f1267e6bf0347dfd392a">REDIS_RCODE_TRY_AGAIN</a>   }</div><div class="line">}</div><div class="ttc" id="redis_2base_8h_html_ac84a2cc3e43abbd5dd776db799387febac861b3123c9b1c8d8a8eeb33b6f97f79"><div class="ttname"><a href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387febac861b3123c9b1c8d8a8eeb33b6f97f79">REDIS_RCODE_MOVE</a></div><div class="ttdoc">Attempt operation on an alternative node with remap. </div><div class="ttdef"><b>Definition:</b> <a href="redis_2base_8h_source.html#l00090">base.h:90</a></div></div>
<div class="ttc" id="redis_2base_8h_html_ac84a2cc3e43abbd5dd776db799387febad1e50fa0ac16f1267e6bf0347dfd392a"><div class="ttname"><a href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387febad1e50fa0ac16f1267e6bf0347dfd392a">REDIS_RCODE_TRY_AGAIN</a></div><div class="ttdoc">Try the operation again. </div><div class="ttdef"><b>Definition:</b> <a href="redis_2base_8h_source.html#l00086">base.h:86</a></div></div>
<div class="ttc" id="redis_2base_8h_html_ac84a2cc3e43abbd5dd776db799387febaf0c7f93c2a2c912e44d099b1ed3ac291"><div class="ttname"><a href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387febaf0c7f93c2a2c912e44d099b1ed3ac291">REDIS_RCODE_ASK</a></div><div class="ttdoc">Attempt operation on an alternative node. </div><div class="ttdef"><b>Definition:</b> <a href="redis_2base_8h_source.html#l00089">base.h:89</a></div></div>
<div class="ttc" id="redis_2base_8h_html_ac84a2cc3e43abbd5dd776db799387febaf1a348dcc1bddf862657b568939df450"><div class="ttname"><a href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387febaf1a348dcc1bddf862657b568939df450">REDIS_RCODE_ERROR</a></div><div class="ttdoc">Unrecoverable library/server error. </div><div class="ttdef"><b>Definition:</b> <a href="redis_2base_8h_source.html#l00085">base.h:85</a></div></div>
<div class="ttc" id="redis_2base_8h_html_ac84a2cc3e43abbd5dd776db799387feba06a816f21162d61b65e967649e181584"><div class="ttname"><a href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feba06a816f21162d61b65e967649e181584">REDIS_RCODE_RECONNECT</a></div><div class="ttdoc">Transitory error, caller should retry the operation with a new connection. </div><div class="ttdef"><b>Definition:</b> <a href="redis_2base_8h_source.html#l00087">base.h:87</a></div></div>
<div class="ttc" id="build_8h_html_a2c7b7cca6314b99cc417bde2ce3542a4"><div class="ttname"><a href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a></div><div class="ttdeci">#define L(_str)</div><div class="ttdef"><b>Definition:</b> <a href="build_8h_source.html#l00078">build.h:78</a></div></div>
<div class="ttc" id="redis_2base_8h_html_ac84a2cc3e43abbd5dd776db799387feba2eb70a0603aecb095503701aa390b4e9"><div class="ttname"><a href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feba2eb70a0603aecb095503701aa390b4e9">REDIS_RCODE_SUCCESS</a></div><div class="ttdoc">Operation was successfull. </div><div class="ttdef"><b>Definition:</b> <a href="redis_2base_8h_source.html#l00084">base.h:84</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="redis_8c_source.html#l00039">39</a> of file <a class="el" href="redis_8c_source.html">redis.c</a>.</p>

</div>
</div>
<a id="aa0443b0b0468a239818ee9908091e9d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0443b0b0468a239818ee9908091e9d9">&#9670;&nbsp;</a></span>redis_rcodes_len</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t redis_rcodes_len = <a class="el" href="build_8h.html#ae0bb64e73aeef0ab6772433f210e9d57">NUM_ELEMENTS</a>(<a class="el" href="redis_8c.html#a1bf4726950ce886a19ae544aa30a2c28">redis_rcodes</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="redis_8c_source.html#l00047">47</a> of file <a class="el" href="redis_8c_source.html">redis.c</a>.</p>

</div>
</div>
<a id="a9fcb3961ee3b3433776672ecc6a426c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fcb3961ee3b3433776672ecc6a426c9">&#9670;&nbsp;</a></span>redis_reply_types</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="table_8h.html#structfr__table__num__sorted__t">fr_table_num_sorted_t</a> const redis_reply_types[]</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;array&quot;</span>),   REDIS_REPLY_ARRAY       },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;error&quot;</span>),   REDIS_REPLY_ERROR       },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;integer&quot;</span>), REDIS_REPLY_INTEGER     },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;nil&quot;</span>),     REDIS_REPLY_NIL         },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;status&quot;</span>),  REDIS_REPLY_STATUS      },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;string&quot;</span>),  REDIS_REPLY_STRING      }</div><div class="line">}</div><div class="ttc" id="build_8h_html_a2c7b7cca6314b99cc417bde2ce3542a4"><div class="ttname"><a href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a></div><div class="ttdeci">#define L(_str)</div><div class="ttdef"><b>Definition:</b> <a href="build_8h_source.html#l00078">build.h:78</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="redis_8c_source.html#l00029">29</a> of file <a class="el" href="redis_8c_source.html">redis.c</a>.</p>

</div>
</div>
<a id="a6f50385ad990f0912b42ab66b1dbabbd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f50385ad990f0912b42ab66b1dbabbd">&#9670;&nbsp;</a></span>redis_reply_types_len</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t redis_reply_types_len = <a class="el" href="build_8h.html#ae0bb64e73aeef0ab6772433f210e9d57">NUM_ELEMENTS</a>(<a class="el" href="redis_8c.html#a9fcb3961ee3b3433776672ecc6a426c9">redis_reply_types</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="redis_8c_source.html#l00037">37</a> of file <a class="el" href="redis_8c_source.html">redis.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Nov 13 2020 21:02:59 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
