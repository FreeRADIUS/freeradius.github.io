<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>/home/runner/work/freeradius-server/freeradius-server/src/lib/io/ring_buffer.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="freeradius.png"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_c85d3e3c5052e9ad9ce18c6863244a25.html">lib</a></li><li class="navelem"><a class="el" href="dir_65bc51589f8002bfcb72faf47ab41180.html">io</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ring_buffer.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Simple ring buffers for packet contents.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;freeradius-devel/io/ring_buffer.h&gt;</code><br />
<code>#include &lt;freeradius-devel/util/strerror.h&gt;</code><br />
<code>#include &lt;freeradius-devel/util/debug.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for ring_buffer.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="ring__buffer_8c__incl.svg" width="547" height="156"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div>
<p><a href="ring__buffer_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:structfr__ring__buffer__s"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ring__buffer_8c.html#structfr__ring__buffer__s">fr_ring_buffer_s</a></td></tr>
<tr class="separator:structfr__ring__buffer__s"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:afe34757eeacef130cc6c6b7ee810f815"><td class="memItemLeft" align="right" valign="top">uint8_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ring__buffer_8c.html#afe34757eeacef130cc6c6b7ee810f815">fr_ring_buffer_alloc</a> (<a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *<a class="el" href="control__test_8c.html#a0971f39d3c53a1b605b677667cd59d29">rb</a>, size_t size)</td></tr>
<tr class="memdesc:afe34757eeacef130cc6c6b7ee810f815"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mark data as allocated.  <a href="#afe34757eeacef130cc6c6b7ee810f815">More...</a><br /></td></tr>
<tr class="separator:afe34757eeacef130cc6c6b7ee810f815"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acaec6bac38f8f2f0143aa9be16e452a5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ring__buffer_8c.html#acaec6bac38f8f2f0143aa9be16e452a5">fr_ring_buffer_close</a> (<a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *<a class="el" href="control__test_8c.html#a0971f39d3c53a1b605b677667cd59d29">rb</a>)</td></tr>
<tr class="memdesc:acaec6bac38f8f2f0143aa9be16e452a5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close a ring buffer so that no further allocations can take place.  <a href="#acaec6bac38f8f2f0143aa9be16e452a5">More...</a><br /></td></tr>
<tr class="separator:acaec6bac38f8f2f0143aa9be16e452a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a591806571da212855676ba71c75c790c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ring__buffer_8c.html#a591806571da212855676ba71c75c790c">fr_ring_buffer_create</a> (TALLOC_CTX *ctx, size_t size)</td></tr>
<tr class="memdesc:a591806571da212855676ba71c75c790c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a ring buffer.  <a href="#a591806571da212855676ba71c75c790c">More...</a><br /></td></tr>
<tr class="separator:a591806571da212855676ba71c75c790c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab41275980199c31d27e380e7d3a22b0a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ring__buffer_8c.html#ab41275980199c31d27e380e7d3a22b0a">fr_ring_buffer_debug</a> (<a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *<a class="el" href="control__test_8c.html#a0971f39d3c53a1b605b677667cd59d29">rb</a>, FILE *fp)</td></tr>
<tr class="memdesc:ab41275980199c31d27e380e7d3a22b0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print debug information about the ring buffer.  <a href="#ab41275980199c31d27e380e7d3a22b0a">More...</a><br /></td></tr>
<tr class="separator:ab41275980199c31d27e380e7d3a22b0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a955f835ee9460809909f9c8e86bb7b0d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ring__buffer_8c.html#a955f835ee9460809909f9c8e86bb7b0d">fr_ring_buffer_free</a> (<a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *<a class="el" href="control__test_8c.html#a0971f39d3c53a1b605b677667cd59d29">rb</a>, size_t size_to_free)</td></tr>
<tr class="memdesc:a955f835ee9460809909f9c8e86bb7b0d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mark data as free,.  <a href="#a955f835ee9460809909f9c8e86bb7b0d">More...</a><br /></td></tr>
<tr class="separator:a955f835ee9460809909f9c8e86bb7b0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8834a2b2c4f7fcbc362590bdf82e7bf8"><td class="memItemLeft" align="right" valign="top">uint8_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ring__buffer_8c.html#a8834a2b2c4f7fcbc362590bdf82e7bf8">fr_ring_buffer_reserve</a> (<a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *<a class="el" href="control__test_8c.html#a0971f39d3c53a1b605b677667cd59d29">rb</a>, size_t size)</td></tr>
<tr class="memdesc:a8834a2b2c4f7fcbc362590bdf82e7bf8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reserve room in the ring buffer.  <a href="#a8834a2b2c4f7fcbc362590bdf82e7bf8">More...</a><br /></td></tr>
<tr class="separator:a8834a2b2c4f7fcbc362590bdf82e7bf8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2de037247f8723f02e442a826c543bf"><td class="memItemLeft" align="right" valign="top">uint8_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ring__buffer_8c.html#af2de037247f8723f02e442a826c543bf">fr_ring_buffer_reserve_split</a> (<a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *dst, size_t <a class="el" href="message__set__test_8c.html#a1f8d9ce884b8ea5d041b4adff0d23552">reserve_size</a>, <a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *src, size_t move_size)</td></tr>
<tr class="memdesc:af2de037247f8723f02e442a826c543bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Split an existing reservation into two.  <a href="#af2de037247f8723f02e442a826c543bf">More...</a><br /></td></tr>
<tr class="separator:af2de037247f8723f02e442a826c543bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeda03b2b446562da1c5f0b2164e8c21a"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ring__buffer_8c.html#aeda03b2b446562da1c5f0b2164e8c21a">fr_ring_buffer_size</a> (<a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *<a class="el" href="control__test_8c.html#a0971f39d3c53a1b605b677667cd59d29">rb</a>)</td></tr>
<tr class="memdesc:aeda03b2b446562da1c5f0b2164e8c21a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the size of the ring buffer.  <a href="#aeda03b2b446562da1c5f0b2164e8c21a">More...</a><br /></td></tr>
<tr class="separator:aeda03b2b446562da1c5f0b2164e8c21a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af18c99fa2ebc5a6e3cdb263c064b080e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ring__buffer_8c.html#af18c99fa2ebc5a6e3cdb263c064b080e">fr_ring_buffer_start</a> (<a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *<a class="el" href="control__test_8c.html#a0971f39d3c53a1b605b677667cd59d29">rb</a>, uint8_t **p_start, size_t *p_size)</td></tr>
<tr class="memdesc:af18c99fa2ebc5a6e3cdb263c064b080e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a pointer to the data at the start of the ring buffer.  <a href="#af18c99fa2ebc5a6e3cdb263c064b080e">More...</a><br /></td></tr>
<tr class="separator:af18c99fa2ebc5a6e3cdb263c064b080e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdecd6b0ab63bb0a57dcfc59f45d02a8"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ring__buffer_8c.html#acdecd6b0ab63bb0a57dcfc59f45d02a8">fr_ring_buffer_used</a> (<a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *<a class="el" href="control__test_8c.html#a0971f39d3c53a1b605b677667cd59d29">rb</a>)</td></tr>
<tr class="memdesc:acdecd6b0ab63bb0a57dcfc59f45d02a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the amount of data used in a ring buffer.  <a href="#acdecd6b0ab63bb0a57dcfc59f45d02a8">More...</a><br /></td></tr>
<tr class="separator:acdecd6b0ab63bb0a57dcfc59f45d02a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Simple ring buffers for packet contents. </p>
<dl class="section rcs"><dt>Id</dt><dd>fc6cfea75a9bcf87a235e496db88378868c3058b </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>2016 Alan DeKok (<a href="#" onclick="location.href='mai'+'lto:'+'ala'+'nd'+'@fr'+'ee'+'rad'+'iu'+'s.o'+'rg'; return false;">aland<span style="display: none;">.nosp@m.</span>@fre<span style="display: none;">.nosp@m.</span>eradi<span style="display: none;">.nosp@m.</span>us.o<span style="display: none;">.nosp@m.</span>rg</a>) </dd></dl>

<p class="definition">Definition in file <a class="el" href="ring__buffer_8c_source.html">ring_buffer.c</a>.</p>
</div><hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="structfr__ring__buffer__s" id="structfr__ring__buffer__s"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structfr__ring__buffer__s">&#9670;&nbsp;</a></span>fr_ring_buffer_s</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct fr_ring_buffer_s</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="ring__buffer_8c_source.html#l00035">35</a> of file <a class="el" href="ring__buffer_8c_source.html">ring_buffer.c</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="af5f6936502fbda76ebf27153b39fba5e"></a>uint8_t *</td>
<td class="fieldname">
buffer</td>
<td class="fielddoc">
actual start of the ring buffer </td></tr>
<tr><td class="fieldtype">
<a id="aa9327db983c472c0c40cc0332f590641"></a>bool</td>
<td class="fieldname">
closed</td>
<td class="fielddoc">
whether allocations are closed </td></tr>
<tr><td class="fieldtype">
<a id="abe654cecd8456ec5301e0db2b5e80658"></a>size_t</td>
<td class="fieldname">
data_end</td>
<td class="fielddoc">
end of used portion of the buffer </td></tr>
<tr><td class="fieldtype">
<a id="a1e4f9df2d3d68ea0d3905ffe376b75bb"></a>size_t</td>
<td class="fieldname">
data_start</td>
<td class="fielddoc">
start of used portion of the buffer </td></tr>
<tr><td class="fieldtype">
<a id="a589ad60b5508718c3637f3f208d18abf"></a>size_t</td>
<td class="fieldname">
reserved</td>
<td class="fielddoc">
amount of reserved data at write_offset </td></tr>
<tr><td class="fieldtype">
<a id="a6f145bff4f1ae20239abcd2ea52e9b8e"></a>size_t</td>
<td class="fieldname">
size</td>
<td class="fielddoc">
Size of this ring buffer. </td></tr>
<tr><td class="fieldtype">
<a id="a97afc1a82301465f2489daee988445ac"></a>size_t</td>
<td class="fieldname">
write_offset</td>
<td class="fielddoc">
where writes are done </td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="afe34757eeacef130cc6c6b7ee810f815"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe34757eeacef130cc6c6b7ee810f815">&#9670;&nbsp;</a></span>fr_ring_buffer_alloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t* fr_ring_buffer_alloc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *&#160;</td>
          <td class="paramname"><em>rb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mark data as allocated. </p>
<p>The size does not need to be a power of two. The application is responsible for doing cache-line alignment, if required.</p>
<p>The application does NOT need to call <a class="el" href="ring__buffer_8c.html#a8834a2b2c4f7fcbc362590bdf82e7bf8" title="Reserve room in the ring buffer. ">fr_ring_buffer_reserve()</a> before calling this function.</p>
<p>If the allocation fails, the application should create a new ring buffer, and start allocating data there.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">rb</td><td>a ring buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>to mark as "used" at the tail end of the buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>NULL on error. Which can only be "ring buffer is full".</li>
<li>pointer to data on success </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ring__buffer_8c_source.html#l00196">196</a> of file <a class="el" href="ring__buffer_8c_source.html">ring_buffer.c</a>.</p>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ring__buffer_8c_afe34757eeacef130cc6c6b7ee810f815_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ring__buffer_8c_afe34757eeacef130cc6c6b7ee810f815_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="acaec6bac38f8f2f0143aa9be16e452a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acaec6bac38f8f2f0143aa9be16e452a5">&#9670;&nbsp;</a></span>fr_ring_buffer_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fr_ring_buffer_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *&#160;</td>
          <td class="paramname"><em>rb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Close a ring buffer so that no further allocations can take place. </p>
<p>Once the ring buffer is empty, it will be automatically freed. It's called "close" and not "delete", because the ring buffer will still be active until all data has been removed.</p>
<p>If you don't care about the data in the ring buffer, you can just call talloc_free() on it.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">rb</td><td>a ring buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>&lt;0 on error.</li>
<li>0 on success </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ring__buffer_8c_source.html#l00496">496</a> of file <a class="el" href="ring__buffer_8c_source.html">ring_buffer.c</a>.</p>

</div>
</div>
<a id="a591806571da212855676ba71c75c790c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a591806571da212855676ba71c75c790c">&#9670;&nbsp;</a></span>fr_ring_buffer_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a>* fr_ring_buffer_create </td>
          <td>(</td>
          <td class="paramtype">TALLOC_CTX *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a ring buffer. </p>
<p>The size provided will be rounded up to the next highest power of 2, if it's not already a power of 2.</p>
<p>The ring buffer manages how much room is reserved (i.e. available to write to), and used. The application is responsible for tracking the start of the reservation, <em>and</em> it's write offset within that reservation.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>a talloc context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>of the raw ring buffer array to allocate. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>A new ring buffer on success.</li>
<li>NULL on failure. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ring__buffer_8c_source.html#l00064">64</a> of file <a class="el" href="ring__buffer_8c_source.html">ring_buffer.c</a>.</p>
<div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ring__buffer_8c_a591806571da212855676ba71c75c790c_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ring__buffer_8c_a591806571da212855676ba71c75c790c_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ab41275980199c31d27e380e7d3a22b0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab41275980199c31d27e380e7d3a22b0a">&#9670;&nbsp;</a></span>fr_ring_buffer_debug()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fr_ring_buffer_debug </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *&#160;</td>
          <td class="paramname"><em>rb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>fp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print debug information about the ring buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">rb</td><td>the ring buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp</td><td>the FILE where the messages are printed. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ring__buffer_8c_source.html#l00574">574</a> of file <a class="el" href="ring__buffer_8c_source.html">ring_buffer.c</a>.</p>

</div>
</div>
<a id="a955f835ee9460809909f9c8e86bb7b0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a955f835ee9460809909f9c8e86bb7b0d">&#9670;&nbsp;</a></span>fr_ring_buffer_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fr_ring_buffer_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *&#160;</td>
          <td class="paramname"><em>rb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size_to_free</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mark data as free,. </p>
<p>The size does not need to be a power of two. The application is responsible for doing cache alignment, if required. The application is responsible for tracking sizes of packets in the ring buffer.</p>
<p>If "unused" bytes are more than what's in the buffer, the used bytes are reset to zero.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">rb</td><td>a ring buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size_to_free</td><td>bytes to mark as "unused" in the buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>&lt;0 on error. Which can only be "ring buffer is full".</li>
<li>0 on success </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ring__buffer_8c_source.html#l00393">393</a> of file <a class="el" href="ring__buffer_8c_source.html">ring_buffer.c</a>.</p>
<div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ring__buffer_8c_a955f835ee9460809909f9c8e86bb7b0d_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ring__buffer_8c_a955f835ee9460809909f9c8e86bb7b0d_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a8834a2b2c4f7fcbc362590bdf82e7bf8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8834a2b2c4f7fcbc362590bdf82e7bf8">&#9670;&nbsp;</a></span>fr_ring_buffer_reserve()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t* fr_ring_buffer_reserve </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *&#160;</td>
          <td class="paramname"><em>rb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reserve room in the ring buffer. </p>
<p>The size does not need to be a power of two. The application is responsible for doing cache alignment, if required.</p>
<p>If the reservation fails, the application should create a new ring buffer, and start reserving data there.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">rb</td><td>a ring buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>to see if we can reserve </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>NULL on error. Which can only be "ring buffer is full".</li>
<li>pointer to data on success </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ring__buffer_8c_source.html#l00119">119</a> of file <a class="el" href="ring__buffer_8c_source.html">ring_buffer.c</a>.</p>
<div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ring__buffer_8c_a8834a2b2c4f7fcbc362590bdf82e7bf8_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ring__buffer_8c_a8834a2b2c4f7fcbc362590bdf82e7bf8_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="af2de037247f8723f02e442a826c543bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2de037247f8723f02e442a826c543bf">&#9670;&nbsp;</a></span>fr_ring_buffer_reserve_split()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t* fr_ring_buffer_reserve_split </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>reserve_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>move_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Split an existing reservation into two. </p>
<p>For protocols like TCP, there may sometimes be a partial packet at the end of the ring buffer. We would like to pass a <em>complete</em> packet around instead of a partial one. In that case, the partial packet at the end of the buffer should be copied to a reservation in a new ring buffer.</p>
<p>i.e. the application uses <a class="el" href="ring__buffer_8c.html#a8834a2b2c4f7fcbc362590bdf82e7bf8" title="Reserve room in the ring buffer. ">fr_ring_buffer_reserve()</a> to reserve 32K of room. He then reads 32K of data into that buffer. This data comprises 3 full packets of 10K, and one partial packet of 10K. The application then calls <a class="el" href="ring__buffer_8c.html#afe34757eeacef130cc6c6b7ee810f815" title="Mark data as allocated. ">fr_ring_buffer_alloc()</a> three times, to consume those packets. (Note that the caller doesn't really need to do 3 calls to <a class="el" href="ring__buffer_8c.html#afe34757eeacef130cc6c6b7ee810f815" title="Mark data as allocated. ">fr_ring_buffer_alloc()</a>. The ring buffer does not keep track of individual allocations).</p>
<p>The application then calls <a class="el" href="ring__buffer_8c.html#a8834a2b2c4f7fcbc362590bdf82e7bf8" title="Reserve room in the ring buffer. ">fr_ring_buffer_reserve()</a> to reserve another 32K of room, while leaving 2K of data in the ring buffer. If that reservation succeeds, great. Everything proceeds as before. (Note that the application has to remember how much data was in the ring buffer, and do it's reading there, instead of to the pointer returned from <a class="el" href="ring__buffer_8c.html#a8834a2b2c4f7fcbc362590bdf82e7bf8" title="Reserve room in the ring buffer. ">fr_ring_buffer_reserve()</a>).</p>
<p>If that call fails, there is 2K of partial data in the buffer which needs to be moved. The application should allocate a new ring buffer, and then call this function to move the data to the new ring buffer. The application then uses the new reservation to read data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">dst</td><td>ring buffer where the reservation will be made </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">reserve_size</td><td>size of the new reservation </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">src</td><td>ring buffer where the data is sitting. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">move_size</td><td>of data to move from the tail of the buffer to the start. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>NULL on error.</li>
<li>pointer to data on success </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ring__buffer_8c_source.html#l00326">326</a> of file <a class="el" href="ring__buffer_8c_source.html">ring_buffer.c</a>.</p>
<div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ring__buffer_8c_af2de037247f8723f02e442a826c543bf_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="aeda03b2b446562da1c5f0b2164e8c21a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeda03b2b446562da1c5f0b2164e8c21a">&#9670;&nbsp;</a></span>fr_ring_buffer_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t fr_ring_buffer_size </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *&#160;</td>
          <td class="paramname"><em>rb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the size of the ring buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">rb</td><td>a ring buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>size of the ring buffer.<ul>
<li>&lt;0 on error.</li>
<li>0 on success </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ring__buffer_8c_source.html#l00512">512</a> of file <a class="el" href="ring__buffer_8c_source.html">ring_buffer.c</a>.</p>
<div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ring__buffer_8c_aeda03b2b446562da1c5f0b2164e8c21a_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="af18c99fa2ebc5a6e3cdb263c064b080e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af18c99fa2ebc5a6e3cdb263c064b080e">&#9670;&nbsp;</a></span>fr_ring_buffer_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fr_ring_buffer_start </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *&#160;</td>
          <td class="paramname"><em>rb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t **&#160;</td>
          <td class="paramname"><em>p_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>p_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a pointer to the data at the start of the ring buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">rb</td><td>a ring buffer </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">p_start</td><td>pointer to data at the start of the ring buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">p_size</td><td>size of the allocated block at the start of the ring buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>size of the used data in the ring buffer.<ul>
<li>&lt;0 on error.</li>
<li>0 on success </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ring__buffer_8c_source.html#l00553">553</a> of file <a class="el" href="ring__buffer_8c_source.html">ring_buffer.c</a>.</p>
<div id="dynsection-11" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ring__buffer_8c_af18c99fa2ebc5a6e3cdb263c064b080e_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="acdecd6b0ab63bb0a57dcfc59f45d02a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acdecd6b0ab63bb0a57dcfc59f45d02a8">&#9670;&nbsp;</a></span>fr_ring_buffer_used()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t fr_ring_buffer_used </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *&#160;</td>
          <td class="paramname"><em>rb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the amount of data used in a ring buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">rb</td><td>a ring buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>size of the used data in the ring buffer.<ul>
<li>&lt;0 on error.</li>
<li>0 on success </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="ring__buffer_8c_source.html#l00526">526</a> of file <a class="el" href="ring__buffer_8c_source.html">ring_buffer.c</a>.</p>
<div id="dynsection-12" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ring__buffer_8c_acdecd6b0ab63bb0a57dcfc59f45d02a8_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Nov 13 2020 15:24:20 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
