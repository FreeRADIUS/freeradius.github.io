<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>/home/runner/work/freeradius-server/freeradius-server/src/lib/io/message.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="freeradius.png"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_c85d3e3c5052e9ad9ce18c6863244a25.html">lib</a></li><li class="navelem"><a class="el" href="dir_65bc51589f8002bfcb72faf47ab41180.html">io</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">message.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Messages for inter-thread communication.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;freeradius-devel/io/message.h&gt;</code><br />
<code>#include &lt;freeradius-devel/util/strerror.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for message.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="message_8c__incl.svg" width="388" height="156"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div>
<p><a href="message_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:structfr__message__set__s"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#structfr__message__set__s">fr_message_set_s</a></td></tr>
<tr class="memdesc:structfr__message__set__s"><td class="mdescLeft">&#160;</td><td class="mdescRight">A Message set, composed of message headers and ring buffer data.  <a href="message_8c.html#structfr__message__set__s">More...</a><br /></td></tr>
<tr class="separator:structfr__message__set__s"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a0d11553dda30a512c791b4c987b08b76"><td class="memItemLeft" align="right" valign="top">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#a0d11553dda30a512c791b4c987b08b76">MPRINT</a>(...)</td></tr>
<tr class="separator:a0d11553dda30a512c791b4c987b08b76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab750f8270c39215a720217af0b05ba06"><td class="memItemLeft" align="right" valign="top">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#ab750f8270c39215a720217af0b05ba06">MS_ALIGN</a>(_x)&#160;&#160;&#160;(((_x) + (<a class="el" href="message_8c.html#aab0b1a06a5a5746093eb84f8fff3db39">MS_ALIGN_SIZE</a>-1)) &amp; ~(<a class="el" href="message_8c.html#aab0b1a06a5a5746093eb84f8fff3db39">MS_ALIGN_SIZE</a>-1))</td></tr>
<tr class="separator:ab750f8270c39215a720217af0b05ba06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab0b1a06a5a5746093eb84f8fff3db39"><td class="memItemLeft" align="right" valign="top">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#aab0b1a06a5a5746093eb84f8fff3db39">MS_ALIGN_SIZE</a>&#160;&#160;&#160;(16)</td></tr>
<tr class="separator:aab0b1a06a5a5746093eb84f8fff3db39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66665937090fb7074e474f5e63998046"><td class="memItemLeft" align="right" valign="top">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#a66665937090fb7074e474f5e63998046">MSG_ARRAY_SIZE</a>&#160;&#160;&#160;(16)</td></tr>
<tr class="separator:a66665937090fb7074e474f5e63998046"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aeb55366110e2a76f5c5d2ae4dbb9ec85"><td class="memItemLeft" align="right" valign="top"><a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#aeb55366110e2a76f5c5d2ae4dbb9ec85">fr_message_alloc</a> (<a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *ms, <a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *m, size_t actual_packet_size)</td></tr>
<tr class="memdesc:aeb55366110e2a76f5c5d2ae4dbb9ec85"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate packet data for a message.  <a href="#aeb55366110e2a76f5c5d2ae4dbb9ec85">More...</a><br /></td></tr>
<tr class="separator:aeb55366110e2a76f5c5d2ae4dbb9ec85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38fd4fd3e9c78eb5e0f0d0e268a43ee8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#a38fd4fd3e9c78eb5e0f0d0e268a43ee8">fr_message_alloc_aligned</a> (<a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *ms, <a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *m, size_t actual_packet_size)</td></tr>
<tr class="memdesc:a38fd4fd3e9c78eb5e0f0d0e268a43ee8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate an aligned pointer for packet (or struct data).  <a href="#a38fd4fd3e9c78eb5e0f0d0e268a43ee8">More...</a><br /></td></tr>
<tr class="separator:a38fd4fd3e9c78eb5e0f0d0e268a43ee8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeee3e9ba6cd5c0b87e7ac67c6e06719a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#aeee3e9ba6cd5c0b87e7ac67c6e06719a">fr_message_alloc_reserve</a> (<a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *ms, <a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *m, size_t actual_packet_size, size_t leftover, size_t <a class="el" href="message__set__test_8c.html#a1f8d9ce884b8ea5d041b4adff0d23552">reserve_size</a>)</td></tr>
<tr class="memdesc:aeee3e9ba6cd5c0b87e7ac67c6e06719a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate packet data for a message, and reserve a new message.  <a href="#aeee3e9ba6cd5c0b87e7ac67c6e06719a">More...</a><br /></td></tr>
<tr class="separator:aeee3e9ba6cd5c0b87e7ac67c6e06719a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3801f794f597c1ec2fb4e327117801a8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#a3801f794f597c1ec2fb4e327117801a8">fr_message_done</a> (<a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *m)</td></tr>
<tr class="memdesc:a3801f794f597c1ec2fb4e327117801a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mark a message as done.  <a href="#a3801f794f597c1ec2fb4e327117801a8">More...</a><br /></td></tr>
<tr class="separator:a3801f794f597c1ec2fb4e327117801a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36b2781aed5d62264f2e482ffa778464"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#a36b2781aed5d62264f2e482ffa778464">fr_message_gc</a> (<a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *ms, int max_to_clean)</td></tr>
<tr class="memdesc:a36b2781aed5d62264f2e482ffa778464"><td class="mdescLeft">&#160;</td><td class="mdescRight">Garbage collect "done" messages.  <a href="#a36b2781aed5d62264f2e482ffa778464">More...</a><br /></td></tr>
<tr class="separator:a36b2781aed5d62264f2e482ffa778464"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0418cdb93e0854c61c4b51776b5c5285"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#a0418cdb93e0854c61c4b51776b5c5285">fr_message_get_message</a> (<a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *ms, bool *p_cleaned)</td></tr>
<tr class="memdesc:a0418cdb93e0854c61c4b51776b5c5285"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate a <a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a>, WITHOUT a ring buffer.  <a href="#a0418cdb93e0854c61c4b51776b5c5285">More...</a><br /></td></tr>
<tr class="separator:a0418cdb93e0854c61c4b51776b5c5285"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60f6babe0166892566e6bc708dd9eed3"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#a60f6babe0166892566e6bc708dd9eed3">fr_message_get_ring_buffer</a> (<a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *ms, <a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *m, bool cleaned_up)</td></tr>
<tr class="memdesc:a60f6babe0166892566e6bc708dd9eed3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a ring buffer for a message.  <a href="#a60f6babe0166892566e6bc708dd9eed3">More...</a><br /></td></tr>
<tr class="separator:a60f6babe0166892566e6bc708dd9eed3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51a3d86b437f7f52a0104a8db93637f0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#a51a3d86b437f7f52a0104a8db93637f0">fr_message_localize</a> (TALLOC_CTX *ctx, <a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *m, size_t message_size)</td></tr>
<tr class="memdesc:a51a3d86b437f7f52a0104a8db93637f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Localize a message by copying it to local storage.  <a href="#a51a3d86b437f7f52a0104a8db93637f0">More...</a><br /></td></tr>
<tr class="separator:a51a3d86b437f7f52a0104a8db93637f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a645a2c7627bc7bb65a417ef13a1d2fe1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#a645a2c7627bc7bb65a417ef13a1d2fe1">fr_message_reserve</a> (<a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *ms, size_t <a class="el" href="message__set__test_8c.html#a1f8d9ce884b8ea5d041b4adff0d23552">reserve_size</a>)</td></tr>
<tr class="memdesc:a645a2c7627bc7bb65a417ef13a1d2fe1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reserve a message.  <a href="#a645a2c7627bc7bb65a417ef13a1d2fe1">More...</a><br /></td></tr>
<tr class="separator:a645a2c7627bc7bb65a417ef13a1d2fe1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a189bcaac58671f1732fd0604a0cf96c1"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#a189bcaac58671f1732fd0604a0cf96c1">fr_message_ring_alloc</a> (<a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *ms, <a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *mr, bool clean)</td></tr>
<tr class="memdesc:a189bcaac58671f1732fd0604a0cf96c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate a message from a message ring.  <a href="#a189bcaac58671f1732fd0604a0cf96c1">More...</a><br /></td></tr>
<tr class="separator:a189bcaac58671f1732fd0604a0cf96c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0c83157e3b8f42b8a6f8cdaca139657"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#ac0c83157e3b8f42b8a6f8cdaca139657">fr_message_ring_gc</a> (<a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *ms, <a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *mr, int max_to_clean)</td></tr>
<tr class="memdesc:ac0c83157e3b8f42b8a6f8cdaca139657"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clean up messages in a message ring.  <a href="#ac0c83157e3b8f42b8a6f8cdaca139657">More...</a><br /></td></tr>
<tr class="separator:ac0c83157e3b8f42b8a6f8cdaca139657"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a286b22f9cf8e93e536c0ef9173ae2e99"><td class="memItemLeft" align="right" valign="top"><a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#a286b22f9cf8e93e536c0ef9173ae2e99">fr_message_set_create</a> (TALLOC_CTX *ctx, int num_messages, size_t message_size, size_t ring_buffer_size)</td></tr>
<tr class="memdesc:a286b22f9cf8e93e536c0ef9173ae2e99"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a message set.  <a href="#a286b22f9cf8e93e536c0ef9173ae2e99">More...</a><br /></td></tr>
<tr class="separator:a286b22f9cf8e93e536c0ef9173ae2e99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7922723a433c0aa4e909c7bff3f70ba2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#a7922723a433c0aa4e909c7bff3f70ba2">fr_message_set_debug</a> (<a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *ms, FILE *fp)</td></tr>
<tr class="memdesc:a7922723a433c0aa4e909c7bff3f70ba2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print debug information about the message set.  <a href="#a7922723a433c0aa4e909c7bff3f70ba2">More...</a><br /></td></tr>
<tr class="separator:a7922723a433c0aa4e909c7bff3f70ba2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ddc8af0d065687e15fe6b33238e5db2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#a9ddc8af0d065687e15fe6b33238e5db2">fr_message_set_gc</a> (<a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *ms)</td></tr>
<tr class="memdesc:a9ddc8af0d065687e15fe6b33238e5db2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Garbage collect the message set.  <a href="#a9ddc8af0d065687e15fe6b33238e5db2">More...</a><br /></td></tr>
<tr class="separator:a9ddc8af0d065687e15fe6b33238e5db2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72aaca002fd7b29a94d397eadee7bd3f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="message_8c.html#a72aaca002fd7b29a94d397eadee7bd3f">fr_message_set_messages_used</a> (<a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *ms)</td></tr>
<tr class="memdesc:a72aaca002fd7b29a94d397eadee7bd3f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Count the number of used messages.  <a href="#a72aaca002fd7b29a94d397eadee7bd3f">More...</a><br /></td></tr>
<tr class="separator:a72aaca002fd7b29a94d397eadee7bd3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Messages for inter-thread communication. </p>
<dl class="section rcs"><dt>Id</dt><dd>b505a5e65bcec9da5a642171c934bb8b053d9a06 </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>2016 Alan DeKok (<a href="#" onclick="location.href='mai'+'lto:'+'ala'+'nd'+'@fr'+'ee'+'rad'+'iu'+'s.o'+'rg'; return false;">aland<span style="display: none;">.nosp@m.</span>@fre<span style="display: none;">.nosp@m.</span>eradi<span style="display: none;">.nosp@m.</span>us.o<span style="display: none;">.nosp@m.</span>rg</a>) </dd></dl>

<p class="definition">Definition in file <a class="el" href="message_8c_source.html">message.c</a>.</p>
</div><hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="structfr__message__set__s" id="structfr__message__set__s"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structfr__message__set__s">&#9670;&nbsp;</a></span>fr_message_set_s</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct fr_message_set_s</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>A Message set, composed of message headers and ring buffer data. </p>
<p>A message set is intended to send short-lived messages. The message headers are fixed in size, and allocated from an array which is treated like a circular buffer. Message bodies (i.e. raw packets) are variable in size, and live in a separate ring buffer.</p>
<p>The message set starts off with a small array of message headers, and a small ring buffer. If an array/buffer fills up, a new one is allocated at double the size of the previous one.</p>
<p>The array / buffers are themselves kept in fixed-size arrays, of MSG_ARRAY_SIZE. The reason is that the memory for fr_message_set_t should be contiguous, and not in a linked list scattered in memory.</p>
<p>The originator allocates a message, and sends it to a recipient. The recipient (usually in another thread) uses the message, and marks it as FR_MESSAGE_DONE. The originator then asynchronously cleans up the message.</p>
<p>This asynchronous cleanup is done via self-clocking. If there is no need to clean up the messages, it isn't done. Only when we run out of space to store messages (or packets) is the cleanup done.</p>
<p>This cleanup latency ensures that we don't have cache line bouncing, where the originator sends the message, and then while the recipieent is reading it... thrashes the cache line with checks for "are you done?  Are you done?"</p>
<p>If there are more than one used entry in either array, we then try to coalesce the buffers on cleanup. If we discover that one array is empty, we discard it, and move the used array entries into it's place.</p>
<p>This process ensures that we don't have too many buffers in progress. It is better to have a few large buffers than many small ones.</p>
<p>MSG_ARRAY_SIZE is defined to be large (16 doublings) to allow for the edge case where messages are stuck for long periods of time.</p>
<p>With an initial message array size of 64, this gives us room for 2M packets, if <em>all</em> of the mr_array entries have packets stuck in them that aren't cleaned up for extended periods of time.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd>Add a flag for UDP-style protocols, where we can put the message into the ring buffer. This helps with locality of reference, and removes the need to track two separate things. </dd></dl>

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l00093">93</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>
</div><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Collaboration diagram for fr_message_set_s:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="structfr__message__set__s__coll__graph.svg" width="140" height="142"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="acbd34532f190704c4250d3b67e64e2fc"></a>int</td>
<td class="fieldname">
allocated</td>
<td class="fielddoc">
</td></tr>
<tr><td class="fieldtype">
<a id="a6cc7e474ace69c8915802a9ead5e13cf"></a>int</td>
<td class="fieldname">
freed</td>
<td class="fielddoc">
</td></tr>
<tr><td class="fieldtype">
<a id="acdbee7e9821ca9a080feec864d28819f"></a>size_t</td>
<td class="fieldname">
max_allocation</td>
<td class="fielddoc">
maximum allocation size </td></tr>
<tr><td class="fieldtype">
<a id="a0a078e6197df3ba4d65fe6d3aeee30c8"></a>size_t</td>
<td class="fieldname">
message_size</td>
<td class="fielddoc">
size of the callers message, including <a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> </td></tr>
<tr><td class="fieldtype">
<a id="a225c7a7ed5a0485c8d64ce0bd82f1c05"></a><a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *</td>
<td class="fieldname">
mr_array[<a class="el" href="message_8c.html#a66665937090fb7074e474f5e63998046">MSG_ARRAY_SIZE</a>]</td>
<td class="fielddoc">
array of message arrays </td></tr>
<tr><td class="fieldtype">
<a id="ac0122a4c41b68ca1a433027358bbd245"></a>int</td>
<td class="fieldname">
mr_cleaned</td>
<td class="fielddoc">
where we last cleaned </td></tr>
<tr><td class="fieldtype">
<a id="a0bd5c3e869df64d964e9da2e2c1c89f3"></a>int</td>
<td class="fieldname">
mr_current</td>
<td class="fielddoc">
current used message ring entry </td></tr>
<tr><td class="fieldtype">
<a id="ab043dd5981b3f862799f79ed879ecadd"></a>int</td>
<td class="fieldname">
mr_max</td>
<td class="fielddoc">
max used message ring entry </td></tr>
<tr><td class="fieldtype">
<a id="a05b07adedfde1a7b08498252138515f0"></a><a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *</td>
<td class="fieldname">
rb_array[<a class="el" href="message_8c.html#a66665937090fb7074e474f5e63998046">MSG_ARRAY_SIZE</a>]</td>
<td class="fielddoc">
array of ring buffers </td></tr>
<tr><td class="fieldtype">
<a id="afaac97cfb6c8a83fcddcba2f5eceefb2"></a>int</td>
<td class="fieldname">
rb_current</td>
<td class="fielddoc">
current used ring buffer entry </td></tr>
<tr><td class="fieldtype">
<a id="a5726a9982ff09d0910cabde7b410ed23"></a>int</td>
<td class="fieldname">
rb_max</td>
<td class="fielddoc">
max used ring buffer entry </td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a0d11553dda30a512c791b4c987b08b76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d11553dda30a512c791b4c987b08b76">&#9670;&nbsp;</a></span>MPRINT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a> MPRINT</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l00038">38</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>

</div>
</div>
<a id="ab750f8270c39215a720217af0b05ba06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab750f8270c39215a720217af0b05ba06">&#9670;&nbsp;</a></span>MS_ALIGN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a> MS_ALIGN</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_x</td><td>)</td>
          <td>&#160;&#160;&#160;(((_x) + (<a class="el" href="message_8c.html#aab0b1a06a5a5746093eb84f8fff3db39">MS_ALIGN_SIZE</a>-1)) &amp; ~(<a class="el" href="message_8c.html#aab0b1a06a5a5746093eb84f8fff3db39">MS_ALIGN_SIZE</a>-1))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l01171">1171</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>

</div>
</div>
<a id="aab0b1a06a5a5746093eb84f8fff3db39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab0b1a06a5a5746093eb84f8fff3db39">&#9670;&nbsp;</a></span>MS_ALIGN_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a> MS_ALIGN_SIZE&#160;&#160;&#160;(16)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l01170">1170</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>

</div>
</div>
<a id="a66665937090fb7074e474f5e63998046"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66665937090fb7074e474f5e63998046">&#9670;&nbsp;</a></span>MSG_ARRAY_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a> MSG_ARRAY_SIZE&#160;&#160;&#160;(16)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l00041">41</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="aeb55366110e2a76f5c5d2ae4dbb9ec85"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb55366110e2a76f5c5d2ae4dbb9ec85">&#9670;&nbsp;</a></span>fr_message_alloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a>* fr_message_alloc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *&#160;</td>
          <td class="paramname"><em>ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>actual_packet_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate packet data for a message. </p>
<p>The caller will normally call <a class="el" href="message_8c.html#a645a2c7627bc7bb65a417ef13a1d2fe1" title="Reserve a message. ">fr_message_reserve()</a> before calling this function, and pass the resulting message 'm' here. If 'm' is NULL, however, this function will call <a class="el" href="message_8c.html#a645a2c7627bc7bb65a417ef13a1d2fe1" title="Reserve a message. ">fr_message_reserve()</a> of 'actual_packet_size'. This capability is there for callers who know the size of the message in advance.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ms</td><td>the message set </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">m</td><td>the message message to allocate packet data for </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">actual_packet_size</td><td>to use </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>NULL on error, and input message m is left alone</li>
<li>fr_message_t* on success. Will always be input message m. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l00987">987</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>
<div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_aeb55366110e2a76f5c5d2ae4dbb9ec85_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_aeb55366110e2a76f5c5d2ae4dbb9ec85_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a38fd4fd3e9c78eb5e0f0d0e268a43ee8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38fd4fd3e9c78eb5e0f0d0e268a43ee8">&#9670;&nbsp;</a></span>fr_message_alloc_aligned()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a>* fr_message_alloc_aligned </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *&#160;</td>
          <td class="paramname"><em>ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>actual_packet_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate an aligned pointer for packet (or struct data). </p>
<p>This function is similar to <a class="el" href="message_8c.html#aeb55366110e2a76f5c5d2ae4dbb9ec85" title="Allocate packet data for a message. ">fr_message_alloc()</a> except that the return value is aligned to CPU boundaries. The amount of data allocated is also rounded up to the nearest alignment size.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ms</td><td>the message set </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">m</td><td>the message message to allocate packet data for </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">actual_packet_size</td><td>to reserve </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>NULL on error</li>
<li>fr_message_t* on success </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l01186">1186</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>
<div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a38fd4fd3e9c78eb5e0f0d0e268a43ee8_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="aeee3e9ba6cd5c0b87e7ac67c6e06719a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeee3e9ba6cd5c0b87e7ac67c6e06719a">&#9670;&nbsp;</a></span>fr_message_alloc_reserve()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a>* fr_message_alloc_reserve </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *&#160;</td>
          <td class="paramname"><em>ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>actual_packet_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>leftover</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>reserve_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate packet data for a message, and reserve a new message. </p>
<p>This function allocates a previously reserved message, and then reserves a new message.</p>
<p>The application should call <a class="el" href="message_8c.html#a645a2c7627bc7bb65a417ef13a1d2fe1" title="Reserve a message. ">fr_message_reserve()</a> with a large buffer, and then read data into the buffer. If the buffer contains multiple packets, the application should call <a class="el" href="message_8c.html#aeee3e9ba6cd5c0b87e7ac67c6e06719a" title="Allocate packet data for a message, and reserve a new message. ">fr_message_alloc_reserve()</a> repeatedly to allocate the full packets, while reserving room for the partial packet.</p>
<p>When the application is determines that there is only one full packet, and one partial packet in the buffer, it should call this function with actual_packet_size, and a large reserve_size. The partial packet will be reserved. If the ring buffer is full, the partial packet will be copied to a new ring buffer.</p>
<p>When the application determines that there are multiple full packets in the buffer, it should call this function with actual_packet_size for each buffer, and reserve_size which reserves all of the data in the buffer. i.e. the full packets + partial packets, which should start off as the original reserve_size.</p>
<p>The application should call this function to allocate each packet, while decreasing reserve_size by each actual_packet_size that was allocated. Once there is only one full and a partial packet in the buffer, it should use a large reserve_size, as above.</p>
<p>The application could just always ecall this function with a large reserve_size, at the cost of substantially more memcpy()s.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ms</td><td>the message set </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">m</td><td>the message message to allocate packet data for </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">actual_packet_size</td><td>to use </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">leftover</td><td>"dirty" bytes in the buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">reserve_size</td><td>to reserve for new message </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>NULL on error, and input message m is left alone</li>
<li>fr_message_t* on success. Will always be a new message. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l01066">1066</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>
<div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_aeee3e9ba6cd5c0b87e7ac67c6e06719a_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_aeee3e9ba6cd5c0b87e7ac67c6e06719a_icgraph.svg" width="100%" height="584"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a3801f794f597c1ec2fb4e327117801a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3801f794f597c1ec2fb4e327117801a8">&#9670;&nbsp;</a></span>fr_message_done()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fr_message_done </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mark a message as done. </p>
<p>Note that this call is usually done from a thread OTHER than the originator of the message. As such, the message is NOT actually freed. Instead, it is just marked as freed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">m</td><td>the message to make as done. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>&lt;0 on error</li>
<li>0 on success </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l00189">189</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>
<div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a3801f794f597c1ec2fb4e327117801a8_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a3801f794f597c1ec2fb4e327117801a8_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a36b2781aed5d62264f2e482ffa778464"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36b2781aed5d62264f2e482ffa778464">&#9670;&nbsp;</a></span>fr_message_gc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void fr_message_gc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *&#160;</td>
          <td class="paramname"><em>ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>max_to_clean</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Garbage collect "done" messages. </p>
<p>Called only from the originating thread. We also clean a limited number of messages at a time, so that we don't have sudden latency spikes when cleaning 1M messages.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ms</td><td>the message set </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_to_clean</td><td>the maximum number of messages to clean </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l00352">352</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>
<div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a36b2781aed5d62264f2e482ffa778464_cgraph.svg" width="100%" height="423"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a36b2781aed5d62264f2e482ffa778464_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a0418cdb93e0854c61c4b51776b5c5285"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0418cdb93e0854c61c4b51776b5c5285">&#9670;&nbsp;</a></span>fr_message_get_message()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a>* fr_message_get_message </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *&#160;</td>
          <td class="paramname"><em>ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&#160;</td>
          <td class="paramname"><em>p_cleaned</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allocate a <a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a>, WITHOUT a ring buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ms</td><td>the message set </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">p_cleaned</td><td>a flag to indicate if we cleaned the message array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>NULL on error</li>
<li>fr_message_t* on success </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l00674">674</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>
<div id="dynsection-11" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a0418cdb93e0854c61c4b51776b5c5285_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-12" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a0418cdb93e0854c61c4b51776b5c5285_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a60f6babe0166892566e6bc708dd9eed3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60f6babe0166892566e6bc708dd9eed3">&#9670;&nbsp;</a></span>fr_message_get_ring_buffer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a>* fr_message_get_ring_buffer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *&#160;</td>
          <td class="paramname"><em>ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>cleaned_up</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get a ring buffer for a message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ms</td><td>the message set </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">m</td><td>the message </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cleaned_up</td><td>whether the message set was partially garbage collected </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>NULL on error, and m is deallocated</li>
<li>m on success </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l00793">793</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>
<div id="dynsection-13" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a60f6babe0166892566e6bc708dd9eed3_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-14" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a60f6babe0166892566e6bc708dd9eed3_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a51a3d86b437f7f52a0104a8db93637f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51a3d86b437f7f52a0104a8db93637f0">&#9670;&nbsp;</a></span>fr_message_localize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a>* fr_message_localize </td>
          <td>(</td>
          <td class="paramtype">TALLOC_CTX *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>message_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Localize a message by copying it to local storage. </p>
<p>This function "localizes" a message by copying it to local storage. In the case where the recipient of a message has to sit on it for a while, that blocks the originator from cleaning up the message. The recipient can then copy the message to local storage, so that the originator can clean it up.</p>
<p>The localized message is marked as FR_MESSAGE_LOCALIZED, so that the recipient can call the normal <a class="el" href="message_8c.html#a3801f794f597c1ec2fb4e327117801a8" title="Mark a message as done. ">fr_message_done()</a> function to free it.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>the talloc context to use for localization </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">m</td><td>the message to be localized </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">message_size</td><td>the size of the message, including the <a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>NULL on allocation errror</li>
<li>a newly localized message </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l00241">241</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>
<div id="dynsection-15" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-15-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-15-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-15-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a51a3d86b437f7f52a0104a8db93637f0_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-16" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-16-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-16-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-16-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="message_8c_a51a3d86b437f7f52a0104a8db93637f0_icgraph.svg" width="559" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a645a2c7627bc7bb65a417ef13a1d2fe1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a645a2c7627bc7bb65a417ef13a1d2fe1">&#9670;&nbsp;</a></span>fr_message_reserve()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a>* fr_message_reserve </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *&#160;</td>
          <td class="paramname"><em>ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>reserve_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reserve a message. </p>
<p>A later call to <a class="el" href="message_8c.html#aeb55366110e2a76f5c5d2ae4dbb9ec85" title="Allocate packet data for a message. ">fr_message_alloc()</a> will allocate the correct packet ring buffer size. This call just allocates a message header, and reserves space for the packet.</p>
<p>If the caller later decides that the message is not needed, he should call fr_message_free() to free the message.</p>
<p>We assume that the caller will call <a class="el" href="message_8c.html#a645a2c7627bc7bb65a417ef13a1d2fe1" title="Reserve a message. ">fr_message_reserve()</a>, and then almost immediately <a class="el" href="message_8c.html#aeb55366110e2a76f5c5d2ae4dbb9ec85" title="Allocate packet data for a message. ">fr_message_alloc()</a>. Multiple calls in series to <a class="el" href="message_8c.html#a645a2c7627bc7bb65a417ef13a1d2fe1" title="Reserve a message. ">fr_message_reserve()</a> MUST NOT be done. The caller could also just call fr_ring_buffer_alloc(m-&gt;rb, size) if they wanted, and then udpate m-&gt;data_size by hand...</p>
<p>The message is returned</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ms</td><td>the message set </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">reserve_size</td><td>to reserve </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>NULL on error</li>
<li>fr_message_t* on success </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l00934">934</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>
<div id="dynsection-17" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-17-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-17-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-17-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a645a2c7627bc7bb65a417ef13a1d2fe1_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-18" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-18-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-18-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-18-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a645a2c7627bc7bb65a417ef13a1d2fe1_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a189bcaac58671f1732fd0604a0cf96c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a189bcaac58671f1732fd0604a0cf96c1">&#9670;&nbsp;</a></span>fr_message_ring_alloc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a>* fr_message_ring_alloc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *&#160;</td>
          <td class="paramname"><em>ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *&#160;</td>
          <td class="paramname"><em>mr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>clean</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allocate a message from a message ring. </p>
<p>The newly allocated message is zeroed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ms</td><td>the message set </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mr</td><td>the message ring to allocate from </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">clean</td><td>whether to clean the message ring </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>NULL on failed allocation</li>
<li>fr_message_t* on successful allocation. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l00623">623</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>
<div id="dynsection-19" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-19-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-19-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-19-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a189bcaac58671f1732fd0604a0cf96c1_cgraph.svg" width="100%" height="442"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-20" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-20-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-20-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-20-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a189bcaac58671f1732fd0604a0cf96c1_icgraph.svg" width="100%" height="594"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ac0c83157e3b8f42b8a6f8cdaca139657"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0c83157e3b8f42b8a6f8cdaca139657">&#9670;&nbsp;</a></span>fr_message_ring_gc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int fr_message_ring_gc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *&#160;</td>
          <td class="paramname"><em>ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ring__buffer_8h.html#a8755ab6ea21ed8159e8a17b4c3c70bf6">fr_ring_buffer_t</a> *&#160;</td>
          <td class="paramname"><em>mr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>max_to_clean</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Clean up messages in a message ring. </p>
<p>Find the oldest messages which are marked FR_MESSAGE_DONE, and mark them FR_MESSAGE_FREE.</p>
<p>FIXME: If we care, track which ring buffer is in use, and how many contiguous chunks we can free. Then, free the chunks at once, instead of piecemeal. Realistically tho... this will probably make little difference.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ms</td><td>the message set </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mr</td><td>the message ring </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_to_clean</td><td>maximum number of messages to clean at a time. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l00305">305</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>
<div id="dynsection-21" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-21-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-21-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-21-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_ac0c83157e3b8f42b8a6f8cdaca139657_cgraph.svg" width="100%" height="560"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-22" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-22-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-22-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-22-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_ac0c83157e3b8f42b8a6f8cdaca139657_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a286b22f9cf8e93e536c0ef9173ae2e99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a286b22f9cf8e93e536c0ef9173ae2e99">&#9670;&nbsp;</a></span>fr_message_set_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a>* fr_message_set_create </td>
          <td>(</td>
          <td class="paramtype">TALLOC_CTX *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_messages</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>message_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>ring_buffer_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a message set. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>the context for talloc </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_messages</td><td>size of the initial message array. MUST be a power of 2. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">message_size</td><td>the size of each message, INCLUDING <a class="el" href="message_8h.html#structfr__message__t">fr_message_t</a>, which MUST be at the start of the struct </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ring_buffer_size</td><td>of the ring buffer. MUST be a power of 2. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>NULL on error</li>
<li>newly allocated fr_message_set_t on success </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l00125">125</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>
<div id="dynsection-23" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-23-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-23-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-23-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a286b22f9cf8e93e536c0ef9173ae2e99_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-24" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-24-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-24-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-24-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a286b22f9cf8e93e536c0ef9173ae2e99_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a7922723a433c0aa4e909c7bff3f70ba2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7922723a433c0aa4e909c7bff3f70ba2">&#9670;&nbsp;</a></span>fr_message_set_debug()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fr_message_set_debug </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *&#160;</td>
          <td class="paramname"><em>ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>fp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print debug information about the message set. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ms</td><td>the message set </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fp</td><td>the FILE where the messages are printed. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l01316">1316</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>
<div id="dynsection-25" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-25-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-25-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-25-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="message_8c_a7922723a433c0aa4e909c7bff3f70ba2_cgraph.svg" width="350" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-26" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-26-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-26-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-26-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="message_8c_a7922723a433c0aa4e909c7bff3f70ba2_icgraph.svg" width="430" height="190"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a9ddc8af0d065687e15fe6b33238e5db2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ddc8af0d065687e15fe6b33238e5db2">&#9670;&nbsp;</a></span>fr_message_set_gc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fr_message_set_gc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *&#160;</td>
          <td class="paramname"><em>ms</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Garbage collect the message set. </p>
<p>This function should ONLY be called just before freeing the message set. It is intended only for debugging, and will cause huge latency spikes if used at run time.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ms</td><td>the message set </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l01288">1288</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>
<div id="dynsection-27" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-27-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-27-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-27-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a9ddc8af0d065687e15fe6b33238e5db2_cgraph.svg" width="100%" height="423"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-28" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-28-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-28-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-28-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="message_8c_a9ddc8af0d065687e15fe6b33238e5db2_icgraph.svg" width="100%" height="568"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a72aaca002fd7b29a94d397eadee7bd3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72aaca002fd7b29a94d397eadee7bd3f">&#9670;&nbsp;</a></span>fr_message_set_messages_used()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fr_message_set_messages_used </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="message_8h.html#ae552300e1811ce090a862a5190afcd54">fr_message_set_t</a> *&#160;</td>
          <td class="paramname"><em>ms</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Count the number of used messages. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ms</td><td>the message set </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>number of used messages </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="message_8c_source.html#l01262">1262</a> of file <a class="el" href="message_8c_source.html">message.c</a>.</p>
<div id="dynsection-29" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-29-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-29-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-29-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="message_8c_a72aaca002fd7b29a94d397eadee7bd3f_cgraph.svg" width="410" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-30" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-30-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-30-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-30-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="message_8c_a72aaca002fd7b29a94d397eadee7bd3f_icgraph.svg" width="490" height="190"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Nov 15 2020 16:03:48 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
