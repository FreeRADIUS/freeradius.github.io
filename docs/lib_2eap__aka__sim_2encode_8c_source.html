<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>/home/runner/work/freeradius-server/freeradius-server/src/lib/eap_aka_sim/encode.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="freeradius.png"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_c85d3e3c5052e9ad9ce18c6863244a25.html">lib</a></li><li class="navelem"><a class="el" href="dir_f9d4e3ff69623c77d4a7d0d622860436.html">eap_aka_sim</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">encode.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="lib_2eap__aka__sim_2encode_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *   This program is is free software; you can redistribute it and/or modify</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *   it under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *   the Free Software Foundation; either version 2 of the License, or (at</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *   your option) any later version.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *   This program is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *   GNU General Public License for more details.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *   You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *   along with this program; if not, write to the Free Software</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *   Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * @file src/lib/eap_aka_sim/encode.c</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * @brief Code common to EAP-SIM/AKA/AKA&#39; clients and servers.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * @copyright 2017 FreeRADIUS server project</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<a class="code" href="build_8h.html#a17c6430174bd106c2fa80061361f0f7b">RCSID</a>(<span class="stringliteral">&quot;$Id: 89a5a8680be48fda9856b9521bcff566ad8280f5 $&quot;</span>)</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;freeradius-devel/util/dbuff.h&gt;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;freeradius-devel/util/base.h&gt;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;freeradius-devel/util/sha1.h&gt;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;freeradius-devel/util/debug.h&gt;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;freeradius-devel/server/module.h&gt;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;freeradius-devel/tls/base.h&gt;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;freeradius-devel/io/test_point.h&gt;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &lt;freeradius-devel/eap/types.h&gt;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="eap__aka__sim_2base_8h.html">base.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="lib_2eap__aka__sim_2attrs_8h.html">attrs.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#a203a488f54cb62495963e38db2ab55a3">   38</a></span>&#160;<span class="preprocessor">#define SIM_MAX_ATTRIBUTE_VALUE_LEN     ((255 * 4) - 2)         </span><span class="comment">/* max length field value less Type + Length fields */</span><span class="preprocessor"></span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"> *  EAP-SIM/AKA/AKA&#39; PACKET FORMAT</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> *  ---------------- ------ ------</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"> * EAP Request and Response Packet Format</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> * --- ------- --- -------- ------ ------</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> *  0              1               2               3</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"> *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"> * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment"> * |     Code      |  Identifier   |        Length           |</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"> * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"> * |     Type      |    AT-Type    |   AT-Length   |     value ... |</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment"> * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"> * With AT-Type/AT-Length/Value... repeating. Length is in units</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"> * of 32 bits, and includes the Type/Length fields.</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="keyword">static</span> ssize_t <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#aba9f98ae827e7a8e928f443dab807f29">encode_tlv_hdr</a>(<a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a> *dbuff,</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                              <a class="code" href="util_2proto_8h.html#structfr__da__stack__t">fr_da_stack_t</a> *da_stack, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> depth,</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                              <a class="code" href="cursor_8h.html#structfr__cursor__t">fr_cursor_t</a> *cursor, <span class="keywordtype">void</span> *encoder_ctx);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">/** Evaluation function for EAP-AKA-encodability</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment"> * @param item  pointer to a fr_pair_t</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment"> * @param uctx  context</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment"> * @return true if the underlying fr_pair_t is EAP_AKA encodable, false otherwise</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#a6c31065754acca40b0983e8ffc130997">   69</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a6c31065754acca40b0983e8ffc130997">is_eap_aka_encodable</a>(<span class="keywordtype">void</span> <span class="keyword">const</span> *item, <span class="keywordtype">void</span> <span class="keyword">const</span> *uctx)</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;{</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <a class="code" href="util_2pair_8h.html#structvalue__pair__s">fr_pair_t</a> <span class="keyword">const</span>         *<a class="code" href="util_2pair_8h.html#ac283ca220bc7c8c819c33dadbb0def84">vp</a> = item;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <a class="code" href="eap__aka__sim_2base_8h.html#structfr__aka__sim__encode__ctx__t">fr_aka_sim_encode_ctx_t</a> <span class="keyword">const</span> *packet_ctx = uctx;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keywordflow">if</span> (!vp) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keywordflow">if</span> (vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#a6ee10539d2910058f6e5379d0d0c1994">internal</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">         *      Bool attribute presence is &#39;true&#39; in SIM</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">         *      and absence is &#39;false&#39;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordflow">if</span> ((vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>-&gt;<a class="code" href="dict_8h.html#ae8c7bc3ae3818eae7f8ccdee6a8b8b75">type</a> == <a class="code" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30ad2b7a961b1fad6fd4498c4ed804fd262">FR_TYPE_BOOL</a>) &amp;&amp; (vp-&gt;vp_bool == <span class="keyword">false</span>)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="dict_8h.html#a4ed0e2dd07a0ef75f1fa32225ac4a762">fr_dict_attr_common_parent</a>(packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a850d61b96e800dde8408923ecff65db2">root</a>, vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>, <span class="keyword">true</span>)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">/** Add an IV to a packet</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"> @verbatim</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">        0                   1                   2                   3</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">        |     AT_IV     | Length = 5    |           Reserved            |</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">        |                                                               |</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">        |                 Initialization Vector                         |</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">        |                                                               |</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">        |                                                               |</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment"> @endverbatim</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#a21c8044cf3343fd4ae285166089bb857">  101</a></span>&#160;<span class="keyword">static</span> ssize_t <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a21c8044cf3343fd4ae285166089bb857">encode_iv</a>(<a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a> *dbuff, <span class="keywordtype">void</span> *encoder_ctx)</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;{</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <a class="code" href="eap__aka__sim_2base_8h.html#structfr__aka__sim__encode__ctx__t">fr_aka_sim_encode_ctx_t</a> *packet_ctx = encoder_ctx;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        uint32_t                iv[4];</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a>              work_dbuff = <a class="code" href="dbuff_8h.html#af23b1899f99e31c4312eb383f73d2a4f">FR_DBUFF_NO_ADVANCE</a>(dbuff);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">         *      One IV per packet</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordflow">if</span> (packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a0f9f79e344ff4f0fd5d28f10da8cac40">iv_included</a>) <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">         *      Generate IV</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        iv[0] = <a class="code" href="rand_8c.html#ae6966accae06dc7d65d4cc51b5782383">fr_rand</a>();</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        iv[1] = <a class="code" href="rand_8c.html#ae6966accae06dc7d65d4cc51b5782383">fr_rand</a>();</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        iv[2] = <a class="code" href="rand_8c.html#ae6966accae06dc7d65d4cc51b5782383">fr_rand</a>();</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        iv[3] = <a class="code" href="rand_8c.html#ae6966accae06dc7d65d4cc51b5782383">fr_rand</a>();</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        memcpy(packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#ac6111e986cfcc674ed9317b9f77ea08e">iv</a>, (uint8_t *)&amp;iv[0], <span class="keyword">sizeof</span>(packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#ac6111e986cfcc674ed9317b9f77ea08e">iv</a>));      <span class="comment">/* ensures alignment */</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <a class="code" href="dbuff_8h.html#a86c930ebbfebeaa6dda3d185f0565d4e">FR_DBUFF_IN_BYTES_RETURN</a>(&amp;work_dbuff, FR_IV, (4 + <a class="code" href="eap__aka__sim_2base_8h.html#a2f9c4ab83bc0afe4202f83568da8bdef">AKA_SIM_IV_SIZE</a>) &gt;&gt; 2, 0x00, 0x00);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <a class="code" href="dbuff_8h.html#a0ec9fef69c790077c6a0c9b5a68cf55b">FR_DBUFF_IN_MEMCPY_RETURN</a>(&amp;work_dbuff, packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#ac6111e986cfcc674ed9317b9f77ea08e">iv</a>, <span class="keyword">sizeof</span>(packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#ac6111e986cfcc674ed9317b9f77ea08e">iv</a>));</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <a class="code" href="util_2proto_8h.html#a6209506c43933c5b9b4cd3a718ae3a9c">FR_PROTO_HEX_DUMP</a>(<a class="code" href="dbuff_8h.html#a350f6766c77392e54cd4bc229739a837">fr_dbuff_start</a>(&amp;work_dbuff), <a class="code" href="dbuff_8h.html#a0e3c7ddf8755664d62b07773c5e4cc46">fr_dbuff_used</a>(&amp;work_dbuff), <span class="stringliteral">&quot;Initialisation vector&quot;</span>);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a0f9f79e344ff4f0fd5d28f10da8cac40">iv_included</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="dbuff_8h.html#a32cfc2950393f2d4e92e906b1de1cf18">fr_dbuff_set</a>(dbuff, &amp;work_dbuff);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;}</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">/** encrypt a value with AES-CBC-128</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment"> * encrypts a value using AES-CBC-128, padding the value with AT_PADDING</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment"> * attributes until it matches the block length of the cipher (16).</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment"> * May also write out an AT_IV attribute if this is the first encrypted</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment"> * value being encoded.</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment"> @verbatim</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">        1                   2                   3</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">        | AT_ENCR_DATA  | Length        |           Reserved            |</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">        |                                                               |</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">        .                    Encrypted Data                             .</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">        .                                                               .</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">        |                                                               |</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment"> @endverbatim</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#a6adf46712c7949ab2afd181e71091e6d">  152</a></span>&#160;<span class="keyword">static</span> ssize_t <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a6adf46712c7949ab2afd181e71091e6d">encode_encrypted_value</a>(<a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a> *dbuff,</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                                      uint8_t <span class="keyword">const</span> *<a class="code" href="value_8h.html#a47ef05ec8d75829006b7eba839c1b603">in</a>, <span class="keywordtype">size_t</span> <a class="code" href="value_8h.html#a26bd6a430c456629c00363322491f55a">inlen</a>, <span class="keywordtype">void</span> *encoder_ctx)</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;{</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="keywordtype">size_t</span>                  total_len, pad_len, encr_len, <a class="code" href="ipaccess_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a> = 0;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a>              work_dbuff = <a class="code" href="dbuff_8h.html#af23b1899f99e31c4312eb383f73d2a4f">FR_DBUFF_NO_ADVANCE</a>(dbuff);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        uint8_t                 *encr = NULL;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <a class="code" href="eap__aka__sim_2base_8h.html#structfr__aka__sim__encode__ctx__t">fr_aka_sim_encode_ctx_t</a> *packet_ctx = encoder_ctx;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        EVP_CIPHER_CTX          *evp_ctx;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        EVP_CIPHER <span class="keyword">const</span>        *evp_cipher = EVP_aes_128_cbc();</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordtype">size_t</span>                  block_size = EVP_CIPHER_block_size(evp_cipher);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">         *      Needs to be a multiple of 4 else we can&#39;t</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">         *      pad with AT_PADDING correctly as its</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">         *      length is specified in multiples of 4.</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="build_8h.html#aba1e18067becc3e4b5ac1038c3f192e9">unlikely</a>(inlen % 4)) {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;%s: Input data length is not a multiple of 4&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        }</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        total_len = (inlen + (block_size - 1)) &amp; ~(block_size - 1);     <span class="comment">/* Round input length to block size (16) */</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        pad_len = (total_len - <a class="code" href="value_8h.html#a26bd6a430c456629c00363322491f55a">inlen</a>);          <span class="comment">/* How much we need to pad */</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">         *      Usually in and out will be the same buffer</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="build_8h.html#aba1e18067becc3e4b5ac1038c3f192e9">unlikely</a>(<a class="code" href="dbuff_8h.html#a350f6766c77392e54cd4bc229739a837">fr_dbuff_start</a>(&amp;work_dbuff) != <a class="code" href="value_8h.html#a47ef05ec8d75829006b7eba839c1b603">in</a>)) {</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                <a class="code" href="dbuff_8h.html#a0ec9fef69c790077c6a0c9b5a68cf55b">FR_DBUFF_IN_MEMCPY_RETURN</a>(&amp;work_dbuff, in, inlen);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                <a class="code" href="dbuff_8h.html#a20d5827668d3db714a6a41f561f57f8f">FR_DBUFF_EXTEND_LOWAT_OR_RETURN</a>(&amp;work_dbuff, inlen);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                <a class="code" href="dbuff_8h.html#a0a0a91bc998e927bfb71f573dd93bd38">fr_dbuff_advance</a>(&amp;work_dbuff, inlen);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        }</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">         *      Append an AT_PADDING attribute if required</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">if</span> (pad_len != 0) {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                <a class="code" href="dbuff_8h.html#a86c930ebbfebeaa6dda3d185f0565d4e">FR_DBUFF_IN_BYTES_RETURN</a>(&amp;work_dbuff, FR_PADDING, (uint8_t)(pad_len &gt;&gt; 2));</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                <a class="code" href="dbuff_8h.html#a63b165a38c53671d5ba37d61a6a570ab">FR_DBUFF_MEMSET_RETURN</a>(&amp;work_dbuff, 0, pad_len - 2);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                <a class="code" href="util_2proto_8h.html#a6209506c43933c5b9b4cd3a718ae3a9c">FR_PROTO_HEX_DUMP</a>(<a class="code" href="dbuff_8h.html#a350f6766c77392e54cd4bc229739a837">fr_dbuff_start</a>(&amp;work_dbuff), pad_len, <span class="stringliteral">&quot;Done padding attribute&quot;</span>);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        evp_ctx = EVP_CIPHER_CTX_new();</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">if</span> (!evp_ctx) {</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                tls_strerror_printf(<span class="stringliteral">&quot;Failed allocating EVP context&quot;</span>);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="build_8h.html#aba1e18067becc3e4b5ac1038c3f192e9">unlikely</a>(EVP_EncryptInit_ex(evp_ctx, evp_cipher, NULL,</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                                        packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a0641df01e2e110425c062b173cbf2c0a">keys</a>-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#ace54f2b51d1b34355e743e05d660aae4">k_encr</a>, packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#ac6111e986cfcc674ed9317b9f77ea08e">iv</a>) != 1)) {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                tls_strerror_printf(<span class="stringliteral">&quot;Failed initialising AES-128-ECB context&quot;</span>);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        error:</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                talloc_free(encr);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                EVP_CIPHER_CTX_free(evp_ctx);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        encr = talloc_array(NULL, uint8_t, total_len);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordflow">if</span> (!encr) {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;%s: Failed allocating temporary buffer&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <a class="code" href="util_2proto_8h.html#a6209506c43933c5b9b4cd3a718ae3a9c">FR_PROTO_HEX_DUMP</a>(<a class="code" href="dbuff_8h.html#a350f6766c77392e54cd4bc229739a837">fr_dbuff_start</a>(&amp;work_dbuff), total_len, <span class="stringliteral">&quot;plaintext&quot;</span>);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">         *      By default OpenSSL expects 16 bytes of plaintext</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">         *      to produce 32 bytes of ciphertext, due to padding</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">         *      being added if the plaintext is a multiple of 16.</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">         *      There&#39;s no way for OpenSSL to determine if a</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">         *      16 byte encr was padded or not, so we need to</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">         *      inform OpenSSL explicitly that there&#39;s no padding.</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        EVP_CIPHER_CTX_set_padding(evp_ctx, 0);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="build_8h.html#aba1e18067becc3e4b5ac1038c3f192e9">unlikely</a>(EVP_EncryptUpdate(evp_ctx, encr, (<span class="keywordtype">int</span> *)&amp;len, <a class="code" href="dbuff_8h.html#a350f6766c77392e54cd4bc229739a837">fr_dbuff_start</a>(&amp;work_dbuff), total_len) != 1)) {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                tls_strerror_printf(<span class="stringliteral">&quot;%s: Failed encrypting attribute&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        encr_len = <a class="code" href="ipaccess_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="build_8h.html#aba1e18067becc3e4b5ac1038c3f192e9">unlikely</a>(EVP_EncryptFinal_ex(evp_ctx, encr + encr_len, (<span class="keywordtype">int</span> *)&amp;len) != 1)) {</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                tls_strerror_printf(<span class="stringliteral">&quot;%s: Failed finalising encrypted attribute&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        }</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        encr_len += <a class="code" href="ipaccess_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">         *      Ciphertext should be same length as plaintext.</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="build_8h.html#aba1e18067becc3e4b5ac1038c3f192e9">unlikely</a>(encr_len != total_len)) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;%s: Invalid plaintext length, expected %zu, got %zu&quot;</span>,</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                                   __FUNCTION__, total_len, encr_len);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <a class="code" href="util_2proto_8h.html#a6209506c43933c5b9b4cd3a718ae3a9c">FR_PROTO_HEX_DUMP</a>(encr, encr_len, <span class="stringliteral">&quot;ciphertext&quot;</span>);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">         *      Overwrite the plaintext with our encrypted blob</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <a class="code" href="dbuff_8h.html#a3d47a9cf57ee282c5f0322eade799476">fr_dbuff_set_to_start</a>(&amp;work_dbuff);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <a class="code" href="dbuff_8h.html#a0ec9fef69c790077c6a0c9b5a68cf55b">FR_DBUFF_IN_MEMCPY_RETURN</a>(&amp;work_dbuff, encr, encr_len);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        talloc_free(encr);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        EVP_CIPHER_CTX_free(evp_ctx);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="dbuff_8h.html#a32cfc2950393f2d4e92e906b1de1cf18">fr_dbuff_set</a>(dbuff, &amp;work_dbuff);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;}</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">/** Encodes the data portion of an attribute</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment"> * @return</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment"> *      &gt; 0, Length of the data portion.</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment"> *      = 0, we could not encode anything, skip this attribute (and don&#39;t encode the header)</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment"> *      &lt; 0, failure.</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00269"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#a95262349e8b300e3cd5dd666cfac78e5">  269</a></span>&#160;<span class="keyword">static</span> ssize_t <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a95262349e8b300e3cd5dd666cfac78e5">encode_value</a>(<a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a> *dbuff,</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                            <a class="code" href="util_2proto_8h.html#structfr__da__stack__t">fr_da_stack_t</a> *da_stack, <span class="keywordtype">int</span> depth,</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                            <a class="code" href="cursor_8h.html#structfr__cursor__t">fr_cursor_t</a> *cursor, <span class="keywordtype">void</span> *encoder_ctx)</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;{</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a>              work_dbuff = <a class="code" href="dbuff_8h.html#af23b1899f99e31c4312eb383f73d2a4f">FR_DBUFF_NO_ADVANCE</a>(dbuff);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <a class="code" href="util_2pair_8h.html#structvalue__pair__s">fr_pair_t</a> <span class="keyword">const</span>         *<a class="code" href="util_2pair_8h.html#ac283ca220bc7c8c819c33dadbb0def84">vp</a> = <a class="code" href="cursor_8c.html#a92733b72ea218ecff0bc7808fae613b7">fr_cursor_current</a>(cursor);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <a class="code" href="dict_8h.html#structdict__attr__s">fr_dict_attr_t</a> <span class="keyword">const</span>    *da = da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth];</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <a class="code" href="eap__aka__sim_2base_8h.html#structfr__aka__sim__encode__ctx__t">fr_aka_sim_encode_ctx_t</a> *packet_ctx = encoder_ctx;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <a class="code" href="util_2pair_8h.html#ac3861056e222ad4e7c00cf18c7234506">VP_VERIFY</a>(vp);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <a class="code" href="util_2proto_8h.html#ab9fdc7bb041370e5abe4d2a9018956b1">FR_PROTO_STACK_PRINT</a>(da_stack, depth);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="build_8h.html#aba1e18067becc3e4b5ac1038c3f192e9">unlikely</a>(da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth + 1] != NULL)) {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;%s: Encoding value but not at top of stack&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        }</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="build_8h.html#aba1e18067becc3e4b5ac1038c3f192e9">unlikely</a>(vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a> != da)) {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;%s: Top of stack does not match vp-&gt;da&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">switch</span> (da-&gt;<a class="code" href="dict_8h.html#ae8c7bc3ae3818eae7f8ccdee6a8b8b75">type</a>) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="util_2types_8h.html#a90054456da9e7d85661400a69ef2ea8f">FR_TYPE_STRUCTURAL</a>:</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;%s: Called with structural type %s&quot;</span>, __FUNCTION__,</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                                   <a class="code" href="table_8h.html#a52dacc40217bdc0537896b713fc7a59e">fr_table_str_by_value</a>(<a class="code" href="value_8c.html#a07313a74940e698753a2b6af066892d2">fr_value_box_type_table</a>, da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth]-&gt;<a class="code" href="dict_8h.html#ae8c7bc3ae3818eae7f8ccdee6a8b8b75">type</a>, <span class="stringliteral">&quot;?Unknown?&quot;</span>));</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <span class="keywordflow">switch</span> (da-&gt;<a class="code" href="dict_8h.html#a84a65ef48909ce5b80ff4c91cf472f77">attr</a>) {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">         *      Allow manual override of IV - Mostly for testing or debugging</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">         *      0                   1                   2                   3</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">         *      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">         *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">         *      |     AT_IV     | Length = 5    |           Reserved            |</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">         *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">         *      |                                                               |</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">         *      |                 Initialization Vector                         |</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">         *      |                                                               |</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">         *      |                                                               |</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">         *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keywordflow">case</span> FR_IV:</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                <span class="keywordflow">if</span> ((vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#af237debed232346007824b84427f2900">length</a> &amp;&amp; (da-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#af237debed232346007824b84427f2900">length</a> != vp-&gt;vp_length)) ||</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                    (vp-&gt;vp_length != <span class="keyword">sizeof</span>(packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#ac6111e986cfcc674ed9317b9f77ea08e">iv</a>))) {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                        <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;%s: Attribute \&quot;%s\&quot; needs a value of exactly %zu bytes, &quot;</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                                           <span class="stringliteral">&quot;but value was %zu bytes&quot;</span>, __FUNCTION__,</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                                           da-&gt;<a class="code" href="dict_8h.html#a76dd6ef231cc56e03c76327e907826b1">name</a>, (<span class="keywordtype">size_t</span>)da-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#af237debed232346007824b84427f2900">length</a>, vp-&gt;vp_length);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                }</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                memcpy(packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#ac6111e986cfcc674ed9317b9f77ea08e">iv</a>, vp-&gt;vp_octets, <span class="keyword">sizeof</span>(packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#ac6111e986cfcc674ed9317b9f77ea08e">iv</a>));</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a0f9f79e344ff4f0fd5d28f10da8cac40">iv_included</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                <span class="keywordflow">break</span>;  <span class="comment">/* Encode IV */</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">         *      AT_RES - Special case (RES length is in bits)</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">         *      0                   1                   2                   3</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">         *      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">         *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">         *      |     AT_RES    |    Length     |          RES Length           |</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">         *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-|</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">         *      |                                                               |</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">         *      |                             RES                               |</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">         *      |                                                               |</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">         *      |                                                               |</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">         *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="keywordflow">case</span> FR_RES:</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                <span class="keywordflow">if</span> ((vp-&gt;vp_length &lt; 4) || (vp-&gt;vp_length &gt; 16)) {</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                        <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;%s: AKA-RES Length must be between 4-16 bytes, got %zu bytes&quot;</span>,</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                                           __FUNCTION__, vp-&gt;vp_length);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                <a class="code" href="dbuff_8h.html#a5cf0a1dbaf5c01a32e9e54b96acc5463">FR_DBUFF_IN_RETURN</a>(&amp;work_dbuff, (uint16_t)(vp-&gt;vp_length * 8)); <span class="comment">/* RES Length (bits, big endian) */</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                <a class="code" href="dbuff_8h.html#a0ec9fef69c790077c6a0c9b5a68cf55b">FR_DBUFF_IN_MEMCPY_RETURN</a>(&amp;work_dbuff, vp-&gt;vp_octets, vp-&gt;vp_length);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="radclient_8c.html#a1d39aac66e12dae50a24cd7a9100ef33">done</a>;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">         *      AT_CHECKCODE - Special case (Variable length with no length field)</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">         *      0                   1                   2                   3</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">         *      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">         *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">         *      | AT_CHECKCODE  | Length        |           Reserved            |</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">         *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">         *      |                                                               |</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">         *      |                     Checkcode (0 or 20 bytes)                 |</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">         *      |                                                               |</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">         *      |                                                               |</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">         *      |                                                               |</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">         *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordflow">case</span> FR_CHECKCODE:</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                <a class="code" href="dbuff_8h.html#a86c930ebbfebeaa6dda3d185f0565d4e">FR_DBUFF_IN_BYTES_RETURN</a>(&amp;work_dbuff, 0x00, 0x00);      <span class="comment">/* Reserved */</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                <a class="code" href="dbuff_8h.html#a0ec9fef69c790077c6a0c9b5a68cf55b">FR_DBUFF_IN_MEMCPY_RETURN</a>(&amp;work_dbuff, vp-&gt;vp_octets, vp-&gt;vp_length);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                <span class="keywordflow">goto</span> <a class="code" href="radclient_8c.html#a1d39aac66e12dae50a24cd7a9100ef33">done</a>;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="keywordflow">switch</span> (da-&gt;<a class="code" href="dict_8h.html#ae8c7bc3ae3818eae7f8ccdee6a8b8b75">type</a>) {</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">         *      In order to represent the string length properly we include a second</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">         *      16bit length field with the real string length.</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">         *      The end of the string is padded buff to a multiple of 4.</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">         *      0                   1                   2                   3</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">         *      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">         *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">         *      | AT_&lt;STRING&gt;   | Length        |    Actual &lt;STRING&gt; Length     |</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">         *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">         *      |                                                               |</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">         *      .                           String                              .</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">         *      .                                                               .</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">         *      |                                                               |</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">         *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30a3277792336b6d6c1577f0cbb53f74381">FR_TYPE_STRING</a>:</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                <span class="keywordflow">if</span> (vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#af237debed232346007824b84427f2900">length</a> &amp;&amp; (vp-&gt;vp_length != vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#af237debed232346007824b84427f2900">length</a>)) {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                        <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;%s: Attribute \&quot;%s\&quot; needs a value of exactly %zu bytes, &quot;</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                                           <span class="stringliteral">&quot;but value was %zu bytes&quot;</span>, __FUNCTION__,</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                                           vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>-&gt;<a class="code" href="dict_8h.html#a76dd6ef231cc56e03c76327e907826b1">name</a>, (<span class="keywordtype">size_t</span>)vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#af237debed232346007824b84427f2900">length</a>, vp-&gt;vp_length);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                }</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                <a class="code" href="dbuff_8h.html#a5cf0a1dbaf5c01a32e9e54b96acc5463">FR_DBUFF_IN_RETURN</a>(&amp;work_dbuff, (uint16_t)vp-&gt;vp_length);               <span class="comment">/* Big endian real string length */</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                <a class="code" href="dbuff_8h.html#a0ec9fef69c790077c6a0c9b5a68cf55b">FR_DBUFF_IN_MEMCPY_RETURN</a>(&amp;work_dbuff, (uint8_t <span class="keyword">const</span> *)vp-&gt;vp_strvalue, vp-&gt;vp_length);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30aee66e99bbe53ef358fe622bff40770f8">FR_TYPE_OCTETS</a>:</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                <span class="comment">/*</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">                 *      Fixed length attribute</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                <span class="keywordflow">if</span> (vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#af237debed232346007824b84427f2900">length</a>) {</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                        <span class="keywordtype">size_t</span> prefix = <a class="code" href="lib_2eap__aka__sim_2base_8c.html#a5abdceed1a7fa542e764bb938856f51d">fr_aka_sim_octets_prefix_len</a>(vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                        <span class="keywordtype">size_t</span> pad_len;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                        <span class="keywordtype">size_t</span> value_len_rounded;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                        <span class="keywordflow">if</span> (vp-&gt;vp_length &gt; vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#af237debed232346007824b84427f2900">length</a>) {</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                                <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;%s: Attribute \&quot;%s\&quot; needs a value of &lt;= %zu bytes, &quot;</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                                                   <span class="stringliteral">&quot;but value was %zu bytes&quot;</span>, __FUNCTION__,</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                                                   vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>-&gt;<a class="code" href="dict_8h.html#a76dd6ef231cc56e03c76327e907826b1">name</a>, (<span class="keywordtype">size_t</span>)vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#af237debed232346007824b84427f2900">length</a>, vp-&gt;vp_length);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                                <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                        }</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                        <span class="comment">/*</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">                         *      Calculate value padding (autopad)</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">                         */</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                        value_len_rounded = <a class="code" href="misc_8h.html#a910bc75603224dd113ee07a9c527eee6">ROUND_UP</a>(vp-&gt;vp_length, (<span class="keywordtype">size_t</span>)vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#af237debed232346007824b84427f2900">length</a>);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                        <span class="comment">/*</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">                         *      Zero out reserved bytes</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">                         */</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                        <span class="keywordflow">if</span> (prefix) <a class="code" href="dbuff_8h.html#a63b165a38c53671d5ba37d61a6a570ab">FR_DBUFF_MEMSET_RETURN</a>(&amp;work_dbuff, 0, prefix);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                        <span class="comment">/*</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">                         *      Copy in value</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">                         */</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                        <a class="code" href="dbuff_8h.html#a0ec9fef69c790077c6a0c9b5a68cf55b">FR_DBUFF_IN_MEMCPY_RETURN</a>(&amp;work_dbuff, vp-&gt;vp_octets, vp-&gt;vp_length);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                        <span class="comment">/*</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">                         *      Pad out the value</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">                         */</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                        pad_len = value_len_rounded - vp-&gt;vp_length;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                        <span class="keywordflow">if</span> (pad_len) <a class="code" href="dbuff_8h.html#a63b165a38c53671d5ba37d61a6a570ab">FR_DBUFF_MEMSET_RETURN</a>(&amp;work_dbuff, 0, pad_len);</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                <span class="comment">/*</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">                 *      Variable length attribute</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                        <a class="code" href="dbuff_8h.html#a5cf0a1dbaf5c01a32e9e54b96acc5463">FR_DBUFF_IN_RETURN</a>(&amp;work_dbuff, (uint16_t)vp-&gt;vp_length);       <span class="comment">/* Big endian real string length */</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                        <a class="code" href="dbuff_8h.html#a0ec9fef69c790077c6a0c9b5a68cf55b">FR_DBUFF_IN_MEMCPY_RETURN</a>(&amp;work_dbuff, (uint8_t <span class="keyword">const</span> *)vp-&gt;vp_strvalue, vp-&gt;vp_length);</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                }</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">         *      In SIM/AKA/AKA&#39; we represent truth values</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">         *      by either including or not including the attribute</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">         *      in the packet.</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">         *      0                   1                   2                   3</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">         *      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">         *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">         *      |   AT_&lt;BOOL&gt;   | Length = 1    |           Reserved            |</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">         *      +---------------+---------------+-------------------------------+</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30ad2b7a961b1fad6fd4498c4ed804fd262">FR_TYPE_BOOL</a>:</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                <a class="code" href="dbuff_8h.html#a86c930ebbfebeaa6dda3d185f0565d4e">FR_DBUFF_IN_BYTES_RETURN</a>(&amp;work_dbuff, 0x00, 0x00);      <span class="comment">/* reserved bytes */</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">         *      Numbers are network byte order.</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">         *      In the base RFCs only short (16bit) unsigned integers are used.</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">         *      We add support for more, just for completeness.</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">         *      0                   1                   2                   3</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">         *      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">         *      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">         *      |   AT_&lt;SHORT&gt;  | Length = 1    |    Short 1    |    Short 2    |</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">         *      +---------------+---------------+-------------------------------+</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30a8d0ab1fb5c42cc3e2bc1760914a491cf">FR_TYPE_UINT8</a>:</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30a51d06b2fa62e862fcb34d7c1a122a68f">FR_TYPE_UINT16</a>:</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30a8e3243c385d006225c2eff3d38382552">FR_TYPE_UINT32</a>:</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30aacc9d809a7a605775fff050eb108ff02">FR_TYPE_UINT64</a>:</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30a9f6ff75b35b1cad1456b5008158ddcb3">FR_TYPE_INT32</a>:</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        {</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                ssize_t <a class="code" href="ipaccess_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a> = <a class="code" href="value_8c.html#a05ed37702365d7c4ec855a860abdb5c2">fr_value_box_to_network_dbuff</a>(NULL, &amp;work_dbuff, &amp;vp-&gt;data);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                <span class="keywordflow">if</span> (len &lt; 0) <span class="keywordflow">return</span> <a class="code" href="ipaccess_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        }</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;%s: Cannot encode attribute %s&quot;</span>, __FUNCTION__, vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>-&gt;<a class="code" href="dict_8h.html#a76dd6ef231cc56e03c76327e907826b1">name</a>);</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        }</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<a class="code" href="radclient_8c.html#a1d39aac66e12dae50a24cd7a9100ef33">done</a>:</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">         *      Rebuilds the TLV stack for encoding the next attribute</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        vp = <a class="code" href="cursor_8c.html#af41d1d4247fb969990f602962ec85525">fr_cursor_filter_next</a>(cursor, <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a6c31065754acca40b0983e8ffc130997">is_eap_aka_encodable</a>, encoder_ctx);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <a class="code" href="proto_8c.html#a1097e0481003e69568734523603d298a">fr_proto_da_stack_build</a>(da_stack, vp ? vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a> : NULL);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="dbuff_8h.html#a32cfc2950393f2d4e92e906b1de1cf18">fr_dbuff_set</a>(dbuff, &amp;work_dbuff);</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;}</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">/** Encodes the data portion of an attribute</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment"> @verbatim</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">        0                   1                   2                   3</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">        | AT_VERSION_L..| Length        | Actual Version List Length    |</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">        |  Supported Version 1          |  Supported Version 2          |</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">        .                                                               .</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">        .                                                               .</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">        | Supported Version N           |     Padding                   |</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment"> @endverbatim</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00522"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#a7a9dc7a2591e7053e8a4aede633f18b4">  522</a></span>&#160;<span class="keyword">static</span> ssize_t <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a7a9dc7a2591e7053e8a4aede633f18b4">encode_array</a>(<a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a> *dbuff,</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                            <a class="code" href="util_2proto_8h.html#structfr__da__stack__t">fr_da_stack_t</a> *da_stack, <span class="keywordtype">int</span> depth,</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                            <a class="code" href="cursor_8h.html#structfr__cursor__t">fr_cursor_t</a> *cursor, <span class="keywordtype">void</span> *encoder_ctx)</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;{</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordtype">size_t</span>                  pad_len;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <span class="keywordtype">size_t</span>                  element_len;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="keywordtype">size_t</span>                  actual_len;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a>              len_dbuff = <a class="code" href="dbuff_8h.html#af23b1899f99e31c4312eb383f73d2a4f">FR_DBUFF_NO_ADVANCE</a>(dbuff);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a>              work_dbuff = <a class="code" href="dbuff_8h.html#af23b1899f99e31c4312eb383f73d2a4f">FR_DBUFF_NO_ADVANCE</a>(dbuff);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <a class="code" href="dict_8h.html#structdict__attr__s">fr_dict_attr_t</a> <span class="keyword">const</span>    *da = da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth];</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <a class="code" href="rad__assert_8h.html#ae8fbce32ab994abf84b95a7c57de209a">fr_assert</a>(da-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#a69bc6b5fc308d3de319e04fd998288a9">array</a>);</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <a class="code" href="dbuff_8h.html#a20d5827668d3db714a6a41f561f57f8f">FR_DBUFF_EXTEND_LOWAT_OR_RETURN</a>(&amp;work_dbuff, 2);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <a class="code" href="dbuff_8h.html#a0a0a91bc998e927bfb71f573dd93bd38">fr_dbuff_advance</a>(&amp;work_dbuff, 2);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="build_8h.html#aba1e18067becc3e4b5ac1038c3f192e9">unlikely</a>(da-&gt;<a class="code" href="dict_8h.html#ae8c7bc3ae3818eae7f8ccdee6a8b8b75">type</a> == <a class="code" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30aee66e99bbe53ef358fe622bff40770f8">FR_TYPE_OCTETS</a>)) {</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                <span class="keywordflow">if</span> (!da-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#af237debed232346007824b84427f2900">length</a>) {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                        <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;Can&#39;t encode array type attribute \&quot;%s\&quot; as it does not &quot;</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                                           <span class="stringliteral">&quot;have a fixed length&quot;</span>, da-&gt;<a class="code" href="dict_8h.html#a76dd6ef231cc56e03c76327e907826b1">name</a>);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                }</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                element_len = da-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#af237debed232346007824b84427f2900">length</a>;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                element_len = <a class="code" href="lib_2eap__aka__sim_2base_8c.html#aff00e2f8221c3b2802022ec0c09cd3a7">fr_aka_sim_attr_sizes</a>[da-&gt;<a class="code" href="dict_8h.html#ae8c7bc3ae3818eae7f8ccdee6a8b8b75">type</a>][0];</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        }</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">         *      Keep encoding as long as we have space to</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">         *      encode things.</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="dbuff_8h.html#a69045029f34094a7c6802864c77d3dac">fr_dbuff_extend_lowat</a>(NULL, &amp;work_dbuff, element_len) &gt;= element_len) {</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                <a class="code" href="util_2pair_8h.html#structvalue__pair__s">fr_pair_t</a>       *<a class="code" href="util_2pair_8h.html#ac283ca220bc7c8c819c33dadbb0def84">vp</a>;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                ssize_t         slen;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                slen = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a95262349e8b300e3cd5dd666cfac78e5">encode_value</a>(&amp;work_dbuff, da_stack, depth, cursor, encoder_ctx);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                <span class="keywordflow">if</span> (slen == <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>) <span class="keywordflow">return</span> slen;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                <span class="keywordflow">if</span> (slen &lt; 0) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                vp = <a class="code" href="cursor_8c.html#a92733b72ea218ecff0bc7808fae613b7">fr_cursor_current</a>(cursor);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                <span class="keywordflow">if</span> (!vp || (vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a> != da)) <span class="keywordflow">break</span>;               <span class="comment">/* Stop if we have an attribute of a different type */</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        }</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        actual_len = <a class="code" href="dbuff_8h.html#a0e3c7ddf8755664d62b07773c5e4cc46">fr_dbuff_used</a>(&amp;work_dbuff) - 2;    <span class="comment">/* Length of the elements we encoded */</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">         *      Arrays with an element size which is</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">         *      a multiple of 4 don&#39;t need an</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">         *      actual_length field, because the number</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">         *      of elements can be calculated from</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment">         *      the attribute length.</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="keywordflow">if</span> (element_len % 4) {</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                <a class="code" href="dbuff_8h.html#a5cf0a1dbaf5c01a32e9e54b96acc5463">FR_DBUFF_IN_RETURN</a>(&amp;len_dbuff, (uint16_t) actual_len);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                <a class="code" href="dbuff_8h.html#a5cf0a1dbaf5c01a32e9e54b96acc5463">FR_DBUFF_IN_RETURN</a>(&amp;len_dbuff, (uint16_t) 0);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        }</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">         *      Pad value to multiple of 4</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        pad_len = <a class="code" href="misc_8h.html#a2b8b1a3c768cdf96a12d059080337a18">ROUND_UP_POW2</a>(actual_len, 4) - actual_len;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keywordflow">if</span> (pad_len) <a class="code" href="dbuff_8h.html#a63b165a38c53671d5ba37d61a6a570ab">FR_DBUFF_MEMSET_RETURN</a>(&amp;work_dbuff, 0, pad_len);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="dbuff_8h.html#a32cfc2950393f2d4e92e906b1de1cf18">fr_dbuff_set</a>(dbuff, &amp;work_dbuff);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;}</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">/** Encode an RFC format attribute header</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment"> * This could be a standard attribute, or a TLV data type.</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment"> * If it&#39;s a standard attribute, then vp-&gt;da-&gt;attr == attribute.</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment"> * Otherwise, attribute may be something else.</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00593"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#a3d7250c8c84799ac391ad0fb8e639124">  593</a></span>&#160;<span class="keyword">static</span> ssize_t <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a3d7250c8c84799ac391ad0fb8e639124">encode_rfc_hdr</a>(<a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a> *dbuff, <a class="code" href="util_2proto_8h.html#structfr__da__stack__t">fr_da_stack_t</a> *da_stack, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> depth,</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                              <a class="code" href="cursor_8h.html#structfr__cursor__t">fr_cursor_t</a> *cursor, <span class="keywordtype">void</span> *encoder_ctx)</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;{</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <span class="keywordtype">size_t</span>                  pad_len;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <a class="code" href="dict_8h.html#structdict__attr__s">fr_dict_attr_t</a> <span class="keyword">const</span>    *da;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        ssize_t                 slen;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a>              work_dbuff = <a class="code" href="dbuff_8h.html#af23b1899f99e31c4312eb383f73d2a4f">FR_DBUFF_NO_ADVANCE</a>(dbuff);</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a>              hdr_dbuff = <a class="code" href="dbuff_8h.html#af23b1899f99e31c4312eb383f73d2a4f">FR_DBUFF_NO_ADVANCE</a>(dbuff);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <a class="code" href="util_2proto_8h.html#ab9fdc7bb041370e5abe4d2a9018956b1">FR_PROTO_STACK_PRINT</a>(da_stack, depth);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keywordflow">switch</span> (da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth]-&gt;<a class="code" href="dict_8h.html#ae8c7bc3ae3818eae7f8ccdee6a8b8b75">type</a>) {</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="util_2types_8h.html#a90054456da9e7d85661400a69ef2ea8f">FR_TYPE_STRUCTURAL</a>:</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;%s: Called with structural type %s&quot;</span>, __FUNCTION__,</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                                   <a class="code" href="table_8h.html#a52dacc40217bdc0537896b713fc7a59e">fr_table_str_by_value</a>(<a class="code" href="value_8c.html#a07313a74940e698753a2b6af066892d2">fr_value_box_type_table</a>, da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth]-&gt;<a class="code" href="dict_8h.html#ae8c7bc3ae3818eae7f8ccdee6a8b8b75">type</a>, <span class="stringliteral">&quot;?Unknown?&quot;</span>));</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                <span class="keywordflow">if</span> (((<a class="code" href="dict__ext_8h.html#affb00364829956930ef20d851f569aab">fr_dict_vendor_num_by_da</a>(da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth]) == 0) &amp;&amp; (da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth]-&gt;<a class="code" href="dict_8h.html#a84a65ef48909ce5b80ff4c91cf472f77">attr</a> == 0)) ||</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                    (da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth]-&gt;<a class="code" href="dict_8h.html#a84a65ef48909ce5b80ff4c91cf472f77">attr</a> &gt; 255)) {</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                        <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;%s: Called with non-standard attribute %u&quot;</span>, __FUNCTION__,</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                                           da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth]-&gt;<a class="code" href="dict_8h.html#a84a65ef48909ce5b80ff4c91cf472f77">attr</a>);</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                }</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        }</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">         *      Write out the value to a buffer location</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">         *      past the AT and Length fields.</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">         *      Encode value will set reserved bytes to</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">         *      zero and fill any subfields like actual</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment">         *      length.</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        da = da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth];</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <a class="code" href="dbuff_8h.html#a20d5827668d3db714a6a41f561f57f8f">FR_DBUFF_EXTEND_LOWAT_OR_RETURN</a>(&amp;work_dbuff, 2);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <a class="code" href="dbuff_8h.html#a0a0a91bc998e927bfb71f573dd93bd38">fr_dbuff_advance</a>(&amp;work_dbuff, 2);</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="keywordflow">if</span> (da-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#a69bc6b5fc308d3de319e04fd998288a9">array</a>) {</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                slen = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a7a9dc7a2591e7053e8a4aede633f18b4">encode_array</a>(&amp;<a class="code" href="dbuff_8h.html#a4fc3cf45b3bdb5c902c36ce2e9c2a3ca">FR_DBUFF_MAX</a>(&amp;work_dbuff, <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a203a488f54cb62495963e38db2ab55a3">SIM_MAX_ATTRIBUTE_VALUE_LEN</a> - 2),</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                                    da_stack, depth, cursor, encoder_ctx);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                slen = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a95262349e8b300e3cd5dd666cfac78e5">encode_value</a>(&amp;<a class="code" href="dbuff_8h.html#a4fc3cf45b3bdb5c902c36ce2e9c2a3ca">FR_DBUFF_MAX</a>(&amp;work_dbuff, <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a203a488f54cb62495963e38db2ab55a3">SIM_MAX_ATTRIBUTE_VALUE_LEN</a> - 2),</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                                    da_stack, depth, cursor, encoder_ctx);</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        }</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        <span class="keywordflow">if</span> (slen &lt;= 0) <span class="keywordflow">return</span> slen;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">         *      Pad value to multiple of 4</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        pad_len = <a class="code" href="misc_8h.html#a2b8b1a3c768cdf96a12d059080337a18">ROUND_UP_POW2</a>(<a class="code" href="dbuff_8h.html#a0e3c7ddf8755664d62b07773c5e4cc46">fr_dbuff_used</a>(&amp;work_dbuff), 4) - <a class="code" href="dbuff_8h.html#a0e3c7ddf8755664d62b07773c5e4cc46">fr_dbuff_used</a>(&amp;work_dbuff);</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="keywordflow">if</span> (pad_len) {</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                <a class="code" href="dbuff_8h.html#a63b165a38c53671d5ba37d61a6a570ab">FR_DBUFF_MEMSET_RETURN</a>(&amp;work_dbuff, 0, pad_len);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        }</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <a class="code" href="dbuff_8h.html#a3e04eab645c37ab9167682733503f57a">fr_dbuff_in_bytes</a>(&amp;hdr_dbuff, (uint8_t)da-&gt;<a class="code" href="dict_8h.html#a84a65ef48909ce5b80ff4c91cf472f77">attr</a>,</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                          (uint8_t)(<a class="code" href="dbuff_8h.html#a0e3c7ddf8755664d62b07773c5e4cc46">fr_dbuff_used</a>(&amp;work_dbuff) &gt;&gt; 2));</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        <a class="code" href="util_2proto_8h.html#a6209506c43933c5b9b4cd3a718ae3a9c">FR_PROTO_HEX_DUMP</a>(<a class="code" href="dbuff_8h.html#a350f6766c77392e54cd4bc229739a837">fr_dbuff_start</a>(&amp;work_dbuff), <a class="code" href="dbuff_8h.html#a0e3c7ddf8755664d62b07773c5e4cc46">fr_dbuff_used</a>(&amp;work_dbuff), <span class="stringliteral">&quot;Done RFC attribute&quot;</span>);</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="dbuff_8h.html#a32cfc2950393f2d4e92e906b1de1cf18">fr_dbuff_set</a>(dbuff, &amp;work_dbuff);        <span class="comment">/* AT + Length + Data */</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;}</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div><div class="line"><a name="l00658"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#a38aceb5aba8d754c7db826d0bed4a941">  658</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> ssize_t <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a38aceb5aba8d754c7db826d0bed4a941">encode_tlv_internal</a>(<a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a> *dbuff,</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                                          <a class="code" href="util_2proto_8h.html#structfr__da__stack__t">fr_da_stack_t</a> *da_stack, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> depth,</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                                          <a class="code" href="cursor_8h.html#structfr__cursor__t">fr_cursor_t</a> *cursor, <span class="keywordtype">void</span> *encoder_ctx)</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;{</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        ssize_t                 slen;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a>              work_dbuff = <a class="code" href="dbuff_8h.html#ab9db39f44fd1b2c5b5711802ff4bd7a4">FR_DBUFF_MAX_NO_ADVANCE</a>(dbuff, <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a203a488f54cb62495963e38db2ab55a3">SIM_MAX_ATTRIBUTE_VALUE_LEN</a>);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a>              value_dbuff;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <a class="code" href="dbuff_8h.html#a2ba47cf778c891b541c68fcf78954775">fr_dbuff_marker_t</a>       value_start;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <a class="code" href="util_2pair_8h.html#structvalue__pair__s">fr_pair_t</a> <span class="keyword">const</span>         *<a class="code" href="util_2pair_8h.html#ac283ca220bc7c8c819c33dadbb0def84">vp</a> = <a class="code" href="cursor_8c.html#a92733b72ea218ecff0bc7808fae613b7">fr_cursor_current</a>(cursor);</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <a class="code" href="dict_8h.html#structdict__attr__s">fr_dict_attr_t</a> <span class="keyword">const</span>    *da = da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth];</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <a class="code" href="dbuff_8h.html#a86c930ebbfebeaa6dda3d185f0565d4e">FR_DBUFF_IN_BYTES_RETURN</a>(&amp;work_dbuff, 0x00, 0x00);</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        value_dbuff = <a class="code" href="dbuff_8h.html#af23b1899f99e31c4312eb383f73d2a4f">FR_DBUFF_NO_ADVANCE</a>(&amp;work_dbuff);</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <a class="code" href="dbuff_8h.html#acd105ff335478c3daf2ecfa994f95e44">fr_dbuff_marker</a>(&amp;value_start, &amp;value_dbuff);</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                <a class="code" href="util_2proto_8h.html#ab9fdc7bb041370e5abe4d2a9018956b1">FR_PROTO_STACK_PRINT</a>(da_stack, depth);</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                <span class="comment">/*</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment">                 *      This attribute carries sub-TLVs.  The sub-TLVs</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment">                 *      can only carry SIM_MAX_ATTRIBUTE_VALUE_LEN bytes of data.</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                <span class="comment">/*</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">                 *      Determine the nested type and call the appropriate encoder</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                <span class="keywordflow">if</span> (da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth + 1]-&gt;<a class="code" href="dict_8h.html#ae8c7bc3ae3818eae7f8ccdee6a8b8b75">type</a> == <a class="code" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30a24741432e1c5c9162fadceb6d1b7508a">FR_TYPE_TLV</a>) {</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                        slen = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#aba9f98ae827e7a8e928f443dab807f29">encode_tlv_hdr</a>(&amp;work_dbuff, da_stack, depth + 1, cursor, encoder_ctx);</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                        slen = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a3d7250c8c84799ac391ad0fb8e639124">encode_rfc_hdr</a>(&amp;work_dbuff, da_stack, depth + 1, cursor, encoder_ctx);</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                }</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                <span class="keywordflow">if</span> (slen &lt;= 0) <span class="keywordflow">return</span> slen;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                <span class="comment">/*</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="comment">                 *      If nothing updated the attribute, stop</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="cursor_8c.html#a92733b72ea218ecff0bc7808fae613b7">fr_cursor_current</a>(cursor) || (vp == <a class="code" href="cursor_8c.html#a92733b72ea218ecff0bc7808fae613b7">fr_cursor_current</a>(cursor))) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                <span class="comment">/*</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">                 *      We can encode multiple sub TLVs, if after</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">                 *      rebuilding the TLV Stack, the attribute</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">                 *      at this depth is the same.</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                <span class="keywordflow">if</span> ((da != da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth]) || (da_stack-&gt;<a class="code" href="util_2proto_8h.html#ada6aec67bc66c48e2c725961c10b608e">depth</a> &lt; da-&gt;<a class="code" href="dict_8h.html#a9ce5fab7d63e50154edddb6206dfe0cb">depth</a>)) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                vp = <a class="code" href="cursor_8c.html#a92733b72ea218ecff0bc7808fae613b7">fr_cursor_current</a>(cursor);</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        }</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment">         *      encrypt the contents of the TLV using AES-CBC-128</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment">         *      or another encryption algorithm.</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="keywordflow">if</span> (!da-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#a6e2b3c4074f4eaa457c7b3050b17db5a">extra</a> &amp;&amp; da-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#af10f5512338ce5c5574aff77cc98da00">subtype</a>) {</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                ssize_t value_len = <a class="code" href="dbuff_8h.html#a0e3c7ddf8755664d62b07773c5e4cc46">fr_dbuff_used</a>(&amp;work_dbuff) - 2;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                slen = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a6adf46712c7949ab2afd181e71091e6d">encode_encrypted_value</a>(&amp;value_dbuff, <a class="code" href="dbuff_8h.html#a30e26cea78c94b2818ede7b3f4738e0e">fr_dbuff_current</a>(&amp;value_start),</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                                              value_len, encoder_ctx);</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                <span class="keywordflow">if</span> (slen &lt; 0) <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                <a class="code" href="dbuff_8h.html#a20d5827668d3db714a6a41f561f57f8f">FR_DBUFF_EXTEND_LOWAT_OR_RETURN</a>(&amp;work_dbuff, (<span class="keywordtype">size_t</span>) slen - value_len);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                <a class="code" href="dbuff_8h.html#a0a0a91bc998e927bfb71f573dd93bd38">fr_dbuff_advance</a>(&amp;work_dbuff, slen - value_len);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        }</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <a class="code" href="util_2proto_8h.html#a6209506c43933c5b9b4cd3a718ae3a9c">FR_PROTO_HEX_DUMP</a>(<a class="code" href="dbuff_8h.html#a350f6766c77392e54cd4bc229739a837">fr_dbuff_start</a>(&amp;work_dbuff), <a class="code" href="dbuff_8h.html#a0e3c7ddf8755664d62b07773c5e4cc46">fr_dbuff_used</a>(&amp;work_dbuff), <span class="stringliteral">&quot;Done TLV&quot;</span>);</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="dbuff_8h.html#a32cfc2950393f2d4e92e906b1de1cf18">fr_dbuff_set</a>(dbuff, &amp;work_dbuff);</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;}</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#aba9f98ae827e7a8e928f443dab807f29">  727</a></span>&#160;<span class="keyword">static</span> ssize_t <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#aba9f98ae827e7a8e928f443dab807f29">encode_tlv_hdr</a>(<a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a> *dbuff,</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                              <a class="code" href="util_2proto_8h.html#structfr__da__stack__t">fr_da_stack_t</a> *da_stack, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> depth,</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                              <a class="code" href="cursor_8h.html#structfr__cursor__t">fr_cursor_t</a> *cursor, <span class="keywordtype">void</span> *encoder_ctx)</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;{</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            total_len;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        ssize_t                 <a class="code" href="ipaccess_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        <a class="code" href="dict_8h.html#structdict__attr__s">fr_dict_attr_t</a> <span class="keyword">const</span>    *da;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a>              tl_dbuff;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        <a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a>              work_dbuff = <a class="code" href="dbuff_8h.html#af23b1899f99e31c4312eb383f73d2a4f">FR_DBUFF_NO_ADVANCE</a>(dbuff);</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <a class="code" href="util_2pair_8h.html#ac3861056e222ad4e7c00cf18c7234506">VP_VERIFY</a>(<a class="code" href="cursor_8c.html#a92733b72ea218ecff0bc7808fae613b7">fr_cursor_current</a>(cursor));</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        <a class="code" href="util_2proto_8h.html#ab9fdc7bb041370e5abe4d2a9018956b1">FR_PROTO_STACK_PRINT</a>(da_stack, depth);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="keywordflow">if</span> (da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth]-&gt;<a class="code" href="dict_8h.html#ae8c7bc3ae3818eae7f8ccdee6a8b8b75">type</a> != <a class="code" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30a24741432e1c5c9162fadceb6d1b7508a">FR_TYPE_TLV</a>) {</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;%s: Expected type \&quot;tlv\&quot; got \&quot;%s\&quot;&quot;</span>, __FUNCTION__,</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                                   <a class="code" href="table_8h.html#a52dacc40217bdc0537896b713fc7a59e">fr_table_str_by_value</a>(<a class="code" href="value_8c.html#a07313a74940e698753a2b6af066892d2">fr_value_box_type_table</a>, da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth]-&gt;<a class="code" href="dict_8h.html#ae8c7bc3ae3818eae7f8ccdee6a8b8b75">type</a>, <span class="stringliteral">&quot;?Unknown?&quot;</span>));</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        }</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <span class="keywordflow">if</span> (!da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth + 1]) {</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;%s: Can&#39;t encode empty TLV&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        }</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="comment">         *      Add the IV before the TLV</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="comment">         *      The ASCII art in the RFCs the attributes in</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment">         *      this order.</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <span class="keywordflow">if</span> (!da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth]-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#a6e2b3c4074f4eaa457c7b3050b17db5a">extra</a> &amp;&amp; da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth]-&gt;<a class="code" href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">flags</a>.<a class="code" href="dict_8h.html#af10f5512338ce5c5574aff77cc98da00">subtype</a>) {</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                len = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a21c8044cf3343fd4ae285166089bb857">encode_iv</a>(&amp;work_dbuff, encoder_ctx);</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                <span class="keywordflow">if</span> (len &lt; 0) <span class="keywordflow">return</span> <a class="code" href="ipaccess_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        }</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        tl_dbuff = <a class="code" href="dbuff_8h.html#af23b1899f99e31c4312eb383f73d2a4f">FR_DBUFF_NO_ADVANCE</a>(&amp;work_dbuff);</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <a class="code" href="dbuff_8h.html#a20d5827668d3db714a6a41f561f57f8f">FR_DBUFF_EXTEND_LOWAT_OR_RETURN</a>(&amp;work_dbuff, 2);</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        <a class="code" href="dbuff_8h.html#a0a0a91bc998e927bfb71f573dd93bd38">fr_dbuff_advance</a>(&amp;work_dbuff, 2);</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        da = da_stack-&gt;<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[depth];</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        len = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a38aceb5aba8d754c7db826d0bed4a941">encode_tlv_internal</a>(&amp;<a class="code" href="dbuff_8h.html#a4fc3cf45b3bdb5c902c36ce2e9c2a3ca">FR_DBUFF_MAX</a>(&amp;work_dbuff, <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a203a488f54cb62495963e38db2ab55a3">SIM_MAX_ATTRIBUTE_VALUE_LEN</a> - 2),</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                                  da_stack, depth, cursor, encoder_ctx);</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <span class="keywordflow">if</span> (len &lt;= 0) <span class="keywordflow">return</span> <a class="code" href="ipaccess_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="comment">         *      Round attr + len + data length out to a multiple</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment">         *      of four, and setup the attribute header and</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment">         *      length field in the buffer.</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        total_len = <a class="code" href="misc_8h.html#a2b8b1a3c768cdf96a12d059080337a18">ROUND_UP_POW2</a>(len + 2, 4);</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <a class="code" href="dbuff_8h.html#a86c930ebbfebeaa6dda3d185f0565d4e">FR_DBUFF_IN_BYTES_RETURN</a>(&amp;tl_dbuff, (uint8_t)da-&gt;<a class="code" href="dict_8h.html#a84a65ef48909ce5b80ff4c91cf472f77">attr</a>, (uint8_t)(total_len &gt;&gt; 2));</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <a class="code" href="util_2proto_8h.html#a6209506c43933c5b9b4cd3a718ae3a9c">FR_PROTO_HEX_DUMP</a>(<a class="code" href="dbuff_8h.html#a350f6766c77392e54cd4bc229739a837">fr_dbuff_start</a>(&amp;work_dbuff), <a class="code" href="dbuff_8h.html#a0e3c7ddf8755664d62b07773c5e4cc46">fr_dbuff_used</a>(&amp;work_dbuff), <span class="stringliteral">&quot;Done TLV attribute&quot;</span>);</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="dbuff_8h.html#a32cfc2950393f2d4e92e906b1de1cf18">fr_dbuff_set</a>(dbuff, &amp;work_dbuff);        <span class="comment">/* AT_IV + AT_*(TLV) - Can&#39;t use total_len, doesn&#39;t include IV */</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;}</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#a8a7ead5b0e57ca0a5c4d6849476354eb">  783</a></span>&#160;ssize_t <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a8a7ead5b0e57ca0a5c4d6849476354eb">fr_aka_sim_encode_pair</a>(<a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a> *dbuff, <a class="code" href="cursor_8h.html#structfr__cursor__t">fr_cursor_t</a> *cursor, <span class="keywordtype">void</span> *encoder_ctx)</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;{</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <a class="code" href="util_2pair_8h.html#structvalue__pair__s">fr_pair_t</a> <span class="keyword">const</span>         *<a class="code" href="util_2pair_8h.html#ac283ca220bc7c8c819c33dadbb0def84">vp</a>;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a>              work_dbuff = <a class="code" href="dbuff_8h.html#af23b1899f99e31c4312eb383f73d2a4f">FR_DBUFF_NO_ADVANCE</a>(dbuff);</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <a class="code" href="dbuff_8h.html#a2ba47cf778c891b541c68fcf78954775">fr_dbuff_marker_t</a>       m;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        ssize_t                 slen;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <a class="code" href="util_2proto_8h.html#structfr__da__stack__t">fr_da_stack_t</a>           da_stack;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <a class="code" href="dict_8h.html#structdict__attr__s">fr_dict_attr_t</a> <span class="keyword">const</span>    *da = NULL;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <a class="code" href="eap__aka__sim_2base_8h.html#structfr__aka__sim__encode__ctx__t">fr_aka_sim_encode_ctx_t</a> *packet_ctx = encoder_ctx;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <a class="code" href="dbuff_8h.html#acd105ff335478c3daf2ecfa994f95e44">fr_dbuff_marker</a>(&amp;m, &amp;work_dbuff);</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keywordflow">if</span> (!cursor) <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        vp = <a class="code" href="cursor_8c.html#abf88b92c985da38854d51efbe3116641">fr_cursor_filter_current</a>(cursor, <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a6c31065754acca40b0983e8ffc130997">is_eap_aka_encodable</a>, encoder_ctx);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="keywordflow">if</span> (!vp) <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <a class="code" href="util_2pair_8h.html#ac3861056e222ad4e7c00cf18c7234506">VP_VERIFY</a>(vp);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <span class="keywordflow">if</span> (vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>-&gt;<a class="code" href="dict_8h.html#a9ce5fab7d63e50154edddb6206dfe0cb">depth</a> &gt; <a class="code" href="dict_8h.html#ac7eb1cd4956d9e7e0956e7ffe519b180">FR_DICT_MAX_TLV_STACK</a>) {</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;%s: Attribute depth %i exceeds maximum nesting depth %i&quot;</span>,</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                                   __FUNCTION__, vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>-&gt;<a class="code" href="dict_8h.html#a9ce5fab7d63e50154edddb6206dfe0cb">depth</a>, <a class="code" href="dict_8h.html#ac7eb1cd4956d9e7e0956e7ffe519b180">FR_DICT_MAX_TLV_STACK</a>);</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        }</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="keywordflow">if</span> (vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>-&gt;<a class="code" href="dict_8h.html#a84a65ef48909ce5b80ff4c91cf472f77">attr</a> == FR_MAC) {</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                <a class="code" href="cursor_8c.html#af41d1d4247fb969990f602962ec85525">fr_cursor_filter_next</a>(cursor, <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a6c31065754acca40b0983e8ffc130997">is_eap_aka_encodable</a>, encoder_ctx);</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        }</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="comment">         *      Nested structures of attributes can&#39;t be longer than</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="comment">         *      4 * 255 bytes, so each call to an encode function can</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="comment">         *      only use 4 * 255 bytes of buffer space at a time.</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="comment">         *      Fast path for the common case.</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <span class="keywordflow">if</span> ((vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>-&gt;<a class="code" href="dict_8h.html#aacf809bb15fcfa56e3355258e15c77a0">parent</a> == packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a850d61b96e800dde8408923ecff65db2">root</a>) &amp;&amp; (vp-&gt;vp_type != <a class="code" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30a24741432e1c5c9162fadceb6d1b7508a">FR_TYPE_TLV</a>)) {</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                da_stack.<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[0] = vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                da_stack.<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[1] = NULL;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                da_stack.<a class="code" href="util_2proto_8h.html#ada6aec67bc66c48e2c725961c10b608e">depth</a> = 1;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                <a class="code" href="util_2proto_8h.html#ab9fdc7bb041370e5abe4d2a9018956b1">FR_PROTO_STACK_PRINT</a>(&amp;da_stack, 0);</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a3d7250c8c84799ac391ad0fb8e639124">encode_rfc_hdr</a>(&amp;<a class="code" href="dbuff_8h.html#a4fc3cf45b3bdb5c902c36ce2e9c2a3ca">FR_DBUFF_MAX</a>(dbuff, <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a203a488f54cb62495963e38db2ab55a3">SIM_MAX_ATTRIBUTE_VALUE_LEN</a> + 2),</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                                      &amp;da_stack, 0, cursor, encoder_ctx);</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        }</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="comment">         *      Do more work to set up the stack for the complex case.</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <a class="code" href="proto_8c.html#a1097e0481003e69568734523603d298a">fr_proto_da_stack_build</a>(&amp;da_stack, vp-&gt;<a class="code" href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">da</a>);</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        <a class="code" href="util_2proto_8h.html#ab9fdc7bb041370e5abe4d2a9018956b1">FR_PROTO_STACK_PRINT</a>(&amp;da_stack, 0);</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        da = da_stack.<a class="code" href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">da</a>[0];</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        <span class="keywordflow">switch</span> (da-&gt;<a class="code" href="dict_8h.html#ae8c7bc3ae3818eae7f8ccdee6a8b8b75">type</a>) {</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment">         *      Supported types</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                slen = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a3d7250c8c84799ac391ad0fb8e639124">encode_rfc_hdr</a>(&amp;<a class="code" href="dbuff_8h.html#a4fc3cf45b3bdb5c902c36ce2e9c2a3ca">FR_DBUFF_MAX</a>(&amp;work_dbuff, <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a203a488f54cb62495963e38db2ab55a3">SIM_MAX_ATTRIBUTE_VALUE_LEN</a> + 2),</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                                      &amp;da_stack, 0, cursor, encoder_ctx);</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                <span class="keywordflow">if</span> (slen &lt; 0) <span class="keywordflow">return</span> slen;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30a24741432e1c5c9162fadceb6d1b7508a">FR_TYPE_TLV</a>:</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                slen = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#aba9f98ae827e7a8e928f443dab807f29">encode_tlv_hdr</a>(&amp;<a class="code" href="dbuff_8h.html#a4fc3cf45b3bdb5c902c36ce2e9c2a3ca">FR_DBUFF_MAX</a>(&amp;work_dbuff, <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a203a488f54cb62495963e38db2ab55a3">SIM_MAX_ATTRIBUTE_VALUE_LEN</a> + 2),</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                                      &amp;da_stack, 0, cursor, encoder_ctx);</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                <span class="keywordflow">if</span> (slen &lt; 0) <span class="keywordflow">return</span> slen;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        }</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment">         *      We couldn&#39;t do it, so we didn&#39;t do anything.</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="cursor_8c.html#a92733b72ea218ecff0bc7808fae613b7">fr_cursor_current</a>(cursor) == vp) {</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                <a class="code" href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a>(<span class="stringliteral">&quot;%s: Nested attribute structure too large to encode&quot;</span>, __FUNCTION__);</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        }</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="dbuff_8h.html#a32cfc2950393f2d4e92e906b1de1cf18">fr_dbuff_set</a>(dbuff, &amp;work_dbuff);</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;}</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div><div class="line"><a name="l00866"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#a3e26126143ed6181e602d10062b0ec5f">  866</a></span>&#160;ssize_t <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a3e26126143ed6181e602d10062b0ec5f">fr_aka_sim_encode</a>(<a class="code" href="request_8h.html#structrequest__s">request_t</a> *request, <a class="code" href="util_2pair_8h.html#structvalue__pair__s">fr_pair_t</a> *to_encode, <span class="keywordtype">void</span> *encode_ctx)</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;{</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <a class="code" href="util_2pair_8h.html#structvalue__pair__s">fr_pair_t</a>               *<a class="code" href="util_2pair_8h.html#ac283ca220bc7c8c819c33dadbb0def84">vp</a>;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        uint8_t                 *buff;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        ssize_t                 slen;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <a class="code" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a>              dbuff;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <a class="code" href="dbuff_8h.html#a2ba47cf778c891b541c68fcf78954775">fr_dbuff_marker_t</a>       hmac;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        fr_dbuff_uctx_talloc_t  tctx;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        <span class="keywordtype">bool</span>                    do_hmac = <span class="keyword">false</span>;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>           subtype;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        <a class="code" href="cursor_8h.html#structfr__cursor__t">fr_cursor_t</a>             cursor;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        <a class="code" href="eap__aka__sim_2base_8h.html#structfr__aka__sim__encode__ctx__t">fr_aka_sim_encode_ctx_t</a> *packet_ctx = encode_ctx;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        <a class="code" href="compose_8h.html#structeap__packet__t">eap_packet_t</a>            *eap_packet = packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a260ae7894ee8493bdefffde4d089bee8">eap_packet</a>;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment">         *      Encoded_msg is now an EAP-SIM message.</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment">         *      It might be too big for putting into an</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment">         *      EAP packet.</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        vp = <a class="code" href="pair_8c.html#a49b539ca8f3606dcff10e26c1b52e9ab">fr_pair_find_by_child_num</a>(&amp;to_encode, packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a850d61b96e800dde8408923ecff65db2">root</a>, FR_SUBTYPE);</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <span class="keywordflow">if</span> (!vp) {</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                <a class="code" href="radclient_8h.html#a0100b7d38bdad8451e7ac9a07d276792">REDEBUG</a>(<span class="stringliteral">&quot;Missing subtype attribute&quot;</span>);</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        }</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        subtype = vp-&gt;vp_uint16;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment">         *      Group attributes with similar lineages together</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        <a class="code" href="pair_8c.html#acc50c595dbf119f3e709aa0e60520f61">fr_pair_list_sort</a>(&amp;to_encode, <a class="code" href="pair_8c.html#a5221bccb1c200e7ea7669e05bbb8dc17">fr_pair_cmp_by_parent_num</a>);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="cursor_8h.html#af9de35ceab0cb4f99228a2931c5e8366">fr_cursor_init</a>(&amp;cursor, &amp;to_encode) == vp) <a class="code" href="cursor_8c.html#af6c2090d1e00319075d6def5aa2666fd">fr_cursor_next</a>(&amp;cursor); <span class="comment">/* Skip subtype if it came out first */</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment">         *      Will we need to generate a HMAC?</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="pair_8c.html#a49b539ca8f3606dcff10e26c1b52e9ab">fr_pair_find_by_child_num</a>(&amp;to_encode, packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a850d61b96e800dde8408923ecff65db2">root</a>, FR_MAC)) do_hmac = <span class="keyword">true</span>;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="comment">         *      Fast path, we just need to encode a subtype</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="keywordflow">if</span> (!do_hmac &amp;&amp; !<a class="code" href="cursor_8c.html#abf88b92c985da38854d51efbe3116641">fr_cursor_filter_current</a>(&amp;cursor, <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a6c31065754acca40b0983e8ffc130997">is_eap_aka_encodable</a>, packet_ctx)) {</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                <a class="code" href="debug_8h.html#ae62598c720cbf8575cc3080f03058d5d">MEM</a>(buff = talloc_array(eap_packet, uint8_t, 3));</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                buff[0] = subtype;      <span class="comment">/* SIM or AKA subtype */</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                buff[1] = 0;            <span class="comment">/* Reserved (0) */</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                buff[2] = 0;            <span class="comment">/* Reserved (1) */</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                eap_packet-&gt;<a class="code" href="compose_8h.html#a038c6e73669e577062e4ec74a224ad4a">type</a>.<a class="code" href="eap_2types_8h.html#a5f338f2ea659ba27bcfb04be5db22292">length</a> = 3;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                eap_packet-&gt;<a class="code" href="compose_8h.html#a038c6e73669e577062e4ec74a224ad4a">type</a>.<a class="code" href="eap_2types_8h.html#a867cdaf9638f573102ed1609a07a9731">data</a> = buff;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                <a class="code" href="util_2proto_8h.html#a6209506c43933c5b9b4cd3a718ae3a9c">FR_PROTO_HEX_DUMP</a>(buff, eap_packet-&gt;<a class="code" href="compose_8h.html#a038c6e73669e577062e4ec74a224ad4a">type</a>.<a class="code" href="eap_2types_8h.html#a5f338f2ea659ba27bcfb04be5db22292">length</a>, <span class="stringliteral">&quot;sim packet&quot;</span>);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        }</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        <a class="code" href="cursor_8c.html#ac0e33de2a6f1cb5e82c4d4e4255c2b95">fr_cursor_head</a>(&amp;cursor);        <span class="comment">/* Reset */</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <a class="code" href="dbuff_8h.html#aaae109ead816d3ab29a6e36d49b29865">fr_dbuff_init_talloc</a>(NULL, &amp;dbuff, &amp;tctx, 512, 1024);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <a class="code" href="dbuff_8h.html#a3e04eab645c37ab9167682733503f57a">fr_dbuff_in_bytes</a>(&amp;dbuff, subtype, 0x00, 0x00);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment">         *      Add space in the packet for AT_MAC</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="keywordflow">if</span> (do_hmac) {</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                <a class="code" href="dbuff_8h.html#a86c930ebbfebeaa6dda3d185f0565d4e">FR_DBUFF_IN_BYTES_RETURN</a>(&amp;dbuff, FR_MAC, <a class="code" href="eap__aka__sim_2base_8h.html#a625fce80d218fe33df76363df0ad32c6">AKA_SIM_MAC_SIZE</a> &gt;&gt; 2, 0x00, 0x00);</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                <a class="code" href="dbuff_8h.html#acd105ff335478c3daf2ecfa994f95e44">fr_dbuff_marker</a>(&amp;hmac, &amp;dbuff);</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                <a class="code" href="dbuff_8h.html#a63b165a38c53671d5ba37d61a6a570ab">FR_DBUFF_MEMSET_RETURN</a>(&amp;dbuff, 0, 16);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        }</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="comment">         *      Encode all the things...</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        (void)<a class="code" href="cursor_8c.html#ac0e33de2a6f1cb5e82c4d4e4255c2b95">fr_cursor_head</a>(&amp;cursor);</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="cursor_8c.html#a92733b72ea218ecff0bc7808fae613b7">fr_cursor_current</a>(&amp;cursor)) {</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                slen = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a8a7ead5b0e57ca0a5c4d6849476354eb">fr_aka_sim_encode_pair</a>(&amp;dbuff, &amp;cursor, packet_ctx);</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                <span class="keywordflow">if</span> (slen &lt; 0) {</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                error:</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                        talloc_free(<a class="code" href="dbuff_8h.html#a40f8621574691541265dba8f1c2ae14b">fr_dbuff_buff</a>(&amp;dbuff));</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a>;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                }</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                <a class="code" href="rad__assert_8h.html#ae8fbce32ab994abf84b95a7c57de209a">fr_assert</a>(<a class="code" href="dbuff_8h.html#a0e3c7ddf8755664d62b07773c5e4cc46">fr_dbuff_used</a>(&amp;dbuff) &gt; 0);   <span class="comment">/* We messed up a check somewhere in the encoder */</span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        }</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        eap_packet-&gt;<a class="code" href="compose_8h.html#a038c6e73669e577062e4ec74a224ad4a">type</a>.<a class="code" href="eap_2types_8h.html#a5f338f2ea659ba27bcfb04be5db22292">length</a> = <a class="code" href="dbuff_8h.html#a0e3c7ddf8755664d62b07773c5e4cc46">fr_dbuff_used</a>(&amp;dbuff);</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        eap_packet-&gt;<a class="code" href="compose_8h.html#a038c6e73669e577062e4ec74a224ad4a">type</a>.<a class="code" href="eap_2types_8h.html#a867cdaf9638f573102ed1609a07a9731">data</a> = <a class="code" href="dbuff_8h.html#a40f8621574691541265dba8f1c2ae14b">fr_dbuff_buff</a>(&amp;dbuff);</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment">         *      Calculate a SHA1-HMAC over the complete EAP packet</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        <span class="keywordflow">if</span> (do_hmac) {</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                slen = <a class="code" href="eap__aka__sim_2base_8h.html#a29af445ef7de31bb2bc912eccd8d1fe9">fr_aka_sim_crypto_sign_packet</a>(<a class="code" href="dbuff_8h.html#a30e26cea78c94b2818ede7b3f4738e0e">fr_dbuff_current</a>(&amp;hmac), eap_packet, <span class="keyword">false</span>,</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                                                 packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a4b575d2ddf06d86d5ab369832c7ba269">hmac_md</a>,</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                                                 packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a0641df01e2e110425c062b173cbf2c0a">keys</a>-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#aa5aaa347c34279757bb0a22a1a537080">k_aut</a>, packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a0641df01e2e110425c062b173cbf2c0a">keys</a>-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#ab1fc029851a20190bd3f58d9e450b07c">k_aut_len</a>,</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                                                 packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#ae8b12504c345c1e0cfef576a494f5d6d">hmac_extra</a>, packet_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#aeca2707db366ec90236d526256557696">hmac_extra_len</a>);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                <span class="keywordflow">if</span> (slen &lt; 0) <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                <a class="code" href="util_2proto_8h.html#a6209506c43933c5b9b4cd3a718ae3a9c">FR_PROTO_HEX_DUMP</a>(<a class="code" href="dbuff_8h.html#a30e26cea78c94b2818ede7b3f4738e0e">fr_dbuff_current</a>(&amp;hmac) - 4, <a class="code" href="eap__aka__sim_2base_8h.html#a625fce80d218fe33df76363df0ad32c6">AKA_SIM_MAC_SIZE</a>, <span class="stringliteral">&quot;hmac attribute&quot;</span>);</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        }</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        <a class="code" href="util_2proto_8h.html#a6209506c43933c5b9b4cd3a718ae3a9c">FR_PROTO_HEX_DUMP</a>(eap_packet-&gt;<a class="code" href="compose_8h.html#a038c6e73669e577062e4ec74a224ad4a">type</a>.<a class="code" href="eap_2types_8h.html#a867cdaf9638f573102ed1609a07a9731">data</a>, eap_packet-&gt;<a class="code" href="compose_8h.html#a038c6e73669e577062e4ec74a224ad4a">type</a>.<a class="code" href="eap_2types_8h.html#a5f338f2ea659ba27bcfb04be5db22292">length</a>, <span class="stringliteral">&quot;sim packet&quot;</span>);</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment">         *      Shrink buffer to the correct size</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        <span class="keywordflow">if</span> (eap_packet-&gt;<a class="code" href="compose_8h.html#a038c6e73669e577062e4ec74a224ad4a">type</a>.<a class="code" href="eap_2types_8h.html#a5f338f2ea659ba27bcfb04be5db22292">length</a> != talloc_array_length(eap_packet-&gt;<a class="code" href="compose_8h.html#a038c6e73669e577062e4ec74a224ad4a">type</a>.<a class="code" href="eap_2types_8h.html#a867cdaf9638f573102ed1609a07a9731">data</a>)) {</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                uint8_t *realloced;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                realloced = talloc_realloc(eap_packet, eap_packet-&gt;<a class="code" href="compose_8h.html#a038c6e73669e577062e4ec74a224ad4a">type</a>.<a class="code" href="eap_2types_8h.html#a867cdaf9638f573102ed1609a07a9731">data</a>, uint8_t, eap_packet-&gt;<a class="code" href="compose_8h.html#a038c6e73669e577062e4ec74a224ad4a">type</a>.<a class="code" href="eap_2types_8h.html#a5f338f2ea659ba27bcfb04be5db22292">length</a>);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                <span class="keywordflow">if</span> (!realloced) <span class="keywordflow">goto</span> error;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                eap_packet-&gt;<a class="code" href="compose_8h.html#a038c6e73669e577062e4ec74a224ad4a">type</a>.<a class="code" href="eap_2types_8h.html#a867cdaf9638f573102ed1609a07a9731">data</a> = realloced;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        }</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="dbuff_8h.html#a0e3c7ddf8755664d62b07773c5e4cc46">fr_dbuff_used</a>(&amp;dbuff);</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;}</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment"> *      Test ctx data</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00986"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#a61b16acb898e33a446c742f784749801">  986</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a61b16acb898e33a446c742f784749801">_test_ctx_free</a>(<a class="code" href="build_8h.html#addf5ec070e9499d36b7f2009ce736076">UNUSED</a> <a class="code" href="eap__aka__sim_2base_8h.html#structfr__aka__sim__encode__ctx__t">fr_aka_sim_encode_ctx_t</a> *ctx)</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;{</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        <a class="code" href="lib_2eap__aka__sim_2base_8c.html#a35bd6908e69d8452519b3dd57742759d">fr_aka_sim_free</a>();</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;}</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div><div class="line"><a name="l00993"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#a976de4c9b2b8e3bb04b0607d05d2f37b">  993</a></span>&#160;<span class="keyword">static</span> <a class="code" href="eap__aka__sim_2base_8h.html#structfr__aka__sim__encode__ctx__t">fr_aka_sim_encode_ctx_t</a> *<a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a976de4c9b2b8e3bb04b0607d05d2f37b">test_ctx_init</a>(TALLOC_CTX *ctx, uint8_t <span class="keyword">const</span> *k_encr, <span class="keywordtype">size_t</span> k_encr_len)</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;{</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        <a class="code" href="eap__aka__sim_2base_8h.html#structfr__aka__sim__encode__ctx__t">fr_aka_sim_encode_ctx_t</a> *test_ctx;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <a class="code" href="eap__aka__sim_2base_8h.html#structfr__aka__sim__keys__t">fr_aka_sim_keys_t</a>               *keys;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        test_ctx = talloc_zero(ctx, <a class="code" href="eap__aka__sim_2base_8h.html#structfr__aka__sim__encode__ctx__t">fr_aka_sim_encode_ctx_t</a>);</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        test_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a0641df01e2e110425c062b173cbf2c0a">keys</a> = keys = talloc_zero(test_ctx, <a class="code" href="eap__aka__sim_2base_8h.html#structfr__aka__sim__keys__t">fr_aka_sim_keys_t</a>);</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        memcpy(keys-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#ace54f2b51d1b34355e743e05d660aae4">k_encr</a>, k_encr, k_encr_len);</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        talloc_set_destructor(test_ctx, <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a61b16acb898e33a446c742f784749801">_test_ctx_free</a>);</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="lib_2eap__aka__sim_2base_8c.html#a580043357c97379fc072baec950ca6f4">fr_aka_sim_init</a>() &lt; 0) {</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                talloc_free(test_ctx);</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        }</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        <span class="keywordflow">return</span> test_ctx;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;}</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment"> *      Test ctx data</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01014"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#a82e228450a06a9107995a3bcb5ed6f94"> 1014</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a82e228450a06a9107995a3bcb5ed6f94">encode_test_ctx_sim</a>(<span class="keywordtype">void</span> **<a class="code" href="value_8h.html#af17d2d4e72bd60de680d3f4a29a1275f">out</a>, TALLOC_CTX *ctx)</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;{</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        <a class="code" href="eap__aka__sim_2base_8h.html#structfr__aka__sim__encode__ctx__t">fr_aka_sim_encode_ctx_t</a> *test_ctx;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        <span class="keyword">static</span> uint8_t          k_encr[] = { 0x00, 0x01, 0x02, 0x03, 0x04 ,0x05, 0x06, 0x07,</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                                             0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f };</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        test_ctx = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a976de4c9b2b8e3bb04b0607d05d2f37b">test_ctx_init</a>(ctx, k_encr, <span class="keyword">sizeof</span>(k_encr));</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <span class="keywordflow">if</span> (!test_ctx) <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        test_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a850d61b96e800dde8408923ecff65db2">root</a> = <a class="code" href="dict_8h.html#a7c79c676c03022a0e7404ae0232bd902">fr_dict_root</a>(<a class="code" href="lib_2eap__aka__sim_2attrs_8h.html#aa5a26799b1edc0773d42133016b88d32">dict_eap_aka_sim</a>);</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        test_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a0f9f79e344ff4f0fd5d28f10da8cac40">iv_included</a> = <span class="keyword">true</span>;   <span class="comment">/* Ensures IV is all zeros */</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        *out = test_ctx;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;}</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;</div><div class="line"><a name="l01031"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#aebc37f0ff41c37fcc125538cb293dc07"> 1031</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#aebc37f0ff41c37fcc125538cb293dc07">encode_test_ctx_aka</a>(<span class="keywordtype">void</span> **<a class="code" href="value_8h.html#af17d2d4e72bd60de680d3f4a29a1275f">out</a>, TALLOC_CTX *ctx)</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;{</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        <a class="code" href="eap__aka__sim_2base_8h.html#structfr__aka__sim__encode__ctx__t">fr_aka_sim_encode_ctx_t</a> *test_ctx;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        <span class="keyword">static</span> uint8_t          k_encr[] = { 0x00, 0x01, 0x02, 0x03, 0x04 ,0x05, 0x06, 0x07,</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                                             0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f };</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        test_ctx = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a976de4c9b2b8e3bb04b0607d05d2f37b">test_ctx_init</a>(ctx, k_encr, <span class="keyword">sizeof</span>(k_encr));</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        <span class="keywordflow">if</span> (!test_ctx) <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        test_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a850d61b96e800dde8408923ecff65db2">root</a> = <a class="code" href="dict_8h.html#a7c79c676c03022a0e7404ae0232bd902">fr_dict_root</a>(<a class="code" href="lib_2eap__aka__sim_2attrs_8h.html#aa5a26799b1edc0773d42133016b88d32">dict_eap_aka_sim</a>);</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        test_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a0f9f79e344ff4f0fd5d28f10da8cac40">iv_included</a> = <span class="keyword">true</span>;   <span class="comment">/* Ensures IV is all zeros */</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        *out = test_ctx;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;}</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;</div><div class="line"><a name="l01048"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#ab5c53522ab41ef078f2b6ce4dccb3da6"> 1048</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#ab5c53522ab41ef078f2b6ce4dccb3da6">encode_test_ctx_sim_rfc4186</a>(<span class="keywordtype">void</span> **<a class="code" href="value_8h.html#af17d2d4e72bd60de680d3f4a29a1275f">out</a>, TALLOC_CTX *ctx)</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;{</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        <a class="code" href="eap__aka__sim_2base_8h.html#structfr__aka__sim__encode__ctx__t">fr_aka_sim_encode_ctx_t</a> *test_ctx;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="keyword">static</span> uint8_t          k_encr[] = { 0x53, 0x6e, 0x5e, 0xbc, 0x44 ,0x65, 0x58, 0x2a,</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                                             0xa6, 0xa8, 0xec, 0x99, 0x86, 0xeb, 0xb6, 0x20 };</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        test_ctx = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a976de4c9b2b8e3bb04b0607d05d2f37b">test_ctx_init</a>(ctx, k_encr, <span class="keyword">sizeof</span>(k_encr));</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <span class="keywordflow">if</span> (!test_ctx) <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        test_ctx-&gt;<a class="code" href="eap__aka__sim_2base_8h.html#a850d61b96e800dde8408923ecff65db2">root</a> = <a class="code" href="dict_8h.html#a7c79c676c03022a0e7404ae0232bd902">fr_dict_root</a>(<a class="code" href="lib_2eap__aka__sim_2attrs_8h.html#aa5a26799b1edc0773d42133016b88d32">dict_eap_aka_sim</a>);</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        *out = test_ctx;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;}</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment"> *      Test points</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="keyword">extern</span> <a class="code" href="test__point_8h.html#structfr__test__point__pair__encode__t">fr_test_point_pair_encode_t</a> <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a2ce856782647f3f95ddcb8db37fda149">sim_tp_encode</a>;</div><div class="line"><a name="l01068"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#a2ce856782647f3f95ddcb8db37fda149"> 1068</a></span>&#160;<a class="code" href="test__point_8h.html#structfr__test__point__pair__encode__t">fr_test_point_pair_encode_t</a> sim_tp_encode = {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        .<a class="code" href="test__point_8h.html#a6def3b7354f72355a6f03ea2a8bddb95">test_ctx</a>       = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a82e228450a06a9107995a3bcb5ed6f94">encode_test_ctx_sim</a>,</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        .func           = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a8a7ead5b0e57ca0a5c4d6849476354eb">fr_aka_sim_encode_pair</a></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;};</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="keyword">extern</span> <a class="code" href="test__point_8h.html#structfr__test__point__pair__encode__t">fr_test_point_pair_encode_t</a> <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a9e8a7ae2d3e13385c88f7e1d3ff8c640">aka_tp_encode</a>;</div><div class="line"><a name="l01074"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#a9e8a7ae2d3e13385c88f7e1d3ff8c640"> 1074</a></span>&#160;<a class="code" href="test__point_8h.html#structfr__test__point__pair__encode__t">fr_test_point_pair_encode_t</a> aka_tp_encode = {</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        .<a class="code" href="test__point_8h.html#a6def3b7354f72355a6f03ea2a8bddb95">test_ctx</a>       = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#aebc37f0ff41c37fcc125538cb293dc07">encode_test_ctx_aka</a>,</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        .func           = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a8a7ead5b0e57ca0a5c4d6849476354eb">fr_aka_sim_encode_pair</a></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;};</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="keyword">extern</span> <a class="code" href="test__point_8h.html#structfr__test__point__pair__encode__t">fr_test_point_pair_encode_t</a> <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a5a44d0f96bfe601dc16f8b904f39537a">sim_tp_encode_rfc4186</a>;</div><div class="line"><a name="l01080"></a><span class="lineno"><a class="line" href="lib_2eap__aka__sim_2encode_8c.html#a5a44d0f96bfe601dc16f8b904f39537a"> 1080</a></span>&#160;<a class="code" href="test__point_8h.html#structfr__test__point__pair__encode__t">fr_test_point_pair_encode_t</a> sim_tp_encode_rfc4186 = {</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        .<a class="code" href="test__point_8h.html#a6def3b7354f72355a6f03ea2a8bddb95">test_ctx</a>       = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#ab5c53522ab41ef078f2b6ce4dccb3da6">encode_test_ctx_sim_rfc4186</a>,</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        .func           = <a class="code" href="lib_2eap__aka__sim_2encode_8c.html#a8a7ead5b0e57ca0a5c4d6849476354eb">fr_aka_sim_encode_pair</a></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;};</div><div class="ttc" id="cursor_8h_html_af9de35ceab0cb4f99228a2931c5e8366"><div class="ttname"><a href="cursor_8h.html#af9de35ceab0cb4f99228a2931c5e8366">fr_cursor_init</a></div><div class="ttdeci">#define fr_cursor_init(_cursor, _head)</div><div class="ttdoc">Initialise a cursor. </div><div class="ttdef"><b>Definition:</b> <a href="cursor_8h_source.html#l00167">cursor.h:167</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_a9e8a7ae2d3e13385c88f7e1d3ff8c640"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#a9e8a7ae2d3e13385c88f7e1d3ff8c640">aka_tp_encode</a></div><div class="ttdeci">fr_test_point_pair_encode_t aka_tp_encode</div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l01074">encode.c:1074</a></div></div>
<div class="ttc" id="dbuff_8h_html_a3e04eab645c37ab9167682733503f57a"><div class="ttname"><a href="dbuff_8h.html#a3e04eab645c37ab9167682733503f57a">fr_dbuff_in_bytes</a></div><div class="ttdeci">#define fr_dbuff_in_bytes(_dbuff,...)</div><div class="ttdoc">Copy a byte sequence into a dbuff. </div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l01118">dbuff.h:1118</a></div></div>
<div class="ttc" id="dbuff_8h_html_a32cfc2950393f2d4e92e906b1de1cf18"><div class="ttname"><a href="dbuff_8h.html#a32cfc2950393f2d4e92e906b1de1cf18">fr_dbuff_set</a></div><div class="ttdeci">#define fr_dbuff_set(_dst, _src)</div><div class="ttdoc">Set the &amp;#39;current&amp;#39; position in a dbuff or marker using another dbuff or marker, a char pointer...</div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l00822">dbuff.h:822</a></div></div>
<div class="ttc" id="dbuff_8h_html_a0e3c7ddf8755664d62b07773c5e4cc46"><div class="ttname"><a href="dbuff_8h.html#a0e3c7ddf8755664d62b07773c5e4cc46">fr_dbuff_used</a></div><div class="ttdeci">#define fr_dbuff_used(_dbuff_or_marker)</div><div class="ttdoc">Return the number of bytes remaining between the start of the dbuff or marker and the current positio...</div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l00608">dbuff.h:608</a></div></div>
<div class="ttc" id="eap__aka__sim_2base_8h_html_a625fce80d218fe33df76363df0ad32c6"><div class="ttname"><a href="eap__aka__sim_2base_8h.html#a625fce80d218fe33df76363df0ad32c6">AKA_SIM_MAC_SIZE</a></div><div class="ttdeci">#define AKA_SIM_MAC_SIZE</div><div class="ttdoc">Length of MAC used to prevent packet modification. </div><div class="ttdef"><b>Definition:</b> <a href="eap__aka__sim_2base_8h_source.html#l00041">base.h:41</a></div></div>
<div class="ttc" id="dbuff_8h_html_a40f8621574691541265dba8f1c2ae14b"><div class="ttname"><a href="dbuff_8h.html#a40f8621574691541265dba8f1c2ae14b">fr_dbuff_buff</a></div><div class="ttdeci">#define fr_dbuff_buff(_dbuff_or_marker)</div><div class="ttdoc">Return the underlying buffer in a dbuff or one of marker. </div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l00702">dbuff.h:702</a></div></div>
<div class="ttc" id="dict_8h_html_a76dd6ef231cc56e03c76327e907826b1"><div class="ttname"><a href="dict_8h.html#a76dd6ef231cc56e03c76327e907826b1">dict_attr_s::name</a></div><div class="ttdeci">char const  * name</div><div class="ttdoc">Attribute name. </div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00137">dict.h:137</a></div></div>
<div class="ttc" id="cursor_8c_html_a92733b72ea218ecff0bc7808fae613b7"><div class="ttname"><a href="cursor_8c.html#a92733b72ea218ecff0bc7808fae613b7">fr_cursor_current</a></div><div class="ttdeci">void * fr_cursor_current(fr_cursor_t *cursor)</div><div class="ttdoc">Return the item the cursor current points to. </div><div class="ttdef"><b>Definition:</b> <a href="cursor_8c_source.html#l00246">cursor.c:246</a></div></div>
<div class="ttc" id="util_2types_8h_html_a372af96cb1f1bd71720f5b25c8acfd30a8e3243c385d006225c2eff3d38382552"><div class="ttname"><a href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30a8e3243c385d006225c2eff3d38382552">FR_TYPE_UINT32</a></div><div class="ttdoc">32 Bit unsigned integer. </div><div class="ttdef"><b>Definition:</b> <a href="util_2types_8h_source.html#l00054">types.h:54</a></div></div>
<div class="ttc" id="eap_2types_8h_html_a867cdaf9638f573102ed1609a07a9731"><div class="ttname"><a href="eap_2types_8h.html#a867cdaf9638f573102ed1609a07a9731">eap_type_data_t::data</a></div><div class="ttdeci">uint8_t * data</div><div class="ttdef"><b>Definition:</b> <a href="eap_2types_8h_source.html#l00112">types.h:112</a></div></div>
<div class="ttc" id="dbuff_8h_html_a3d47a9cf57ee282c5f0322eade799476"><div class="ttname"><a href="dbuff_8h.html#a3d47a9cf57ee282c5f0322eade799476">fr_dbuff_set_to_start</a></div><div class="ttdeci">#define fr_dbuff_set_to_start(_dbuff_or_marker)</div><div class="ttdoc">Reset the &amp;#39;current&amp;#39; position of the dbuff or marker to the &amp;#39;start&amp;#39; of the buffer. ...</div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l00862">dbuff.h:862</a></div></div>
<div class="ttc" id="dict_8h_html_ae8c7bc3ae3818eae7f8ccdee6a8b8b75"><div class="ttname"><a href="dict_8h.html#ae8c7bc3ae3818eae7f8ccdee6a8b8b75">dict_attr_s::type</a></div><div class="ttdeci">fr_type_t type</div><div class="ttdoc">Value type. </div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00143">dict.h:143</a></div></div>
<div class="ttc" id="rad__assert_8h_html_ae8fbce32ab994abf84b95a7c57de209a"><div class="ttname"><a href="rad__assert_8h.html#ae8fbce32ab994abf84b95a7c57de209a">fr_assert</a></div><div class="ttdeci">#define fr_assert(_expr)</div><div class="ttdef"><b>Definition:</b> <a href="rad__assert_8h_source.html#l00038">rad_assert.h:38</a></div></div>
<div class="ttc" id="eap__aka__sim_2base_8h_html_a850d61b96e800dde8408923ecff65db2"><div class="ttname"><a href="eap__aka__sim_2base_8h.html#a850d61b96e800dde8408923ecff65db2">fr_aka_sim_encode_ctx_t::root</a></div><div class="ttdeci">fr_dict_attr_t const  * root</div><div class="ttdoc">Root attribute of the dictionary. </div><div class="ttdef"><b>Definition:</b> <a href="eap__aka__sim_2base_8h_source.html#l00228">base.h:228</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2attrs_8h_html"><div class="ttname"><a href="lib_2eap__aka__sim_2attrs_8h.html">attrs.h</a></div><div class="ttdoc">Attributes to EAP-SIM/AKA/AKA&amp;#39; clients and servers. </div></div>
<div class="ttc" id="eap__aka__sim_2base_8h_html_ae8b12504c345c1e0cfef576a494f5d6d"><div class="ttname"><a href="eap__aka__sim_2base_8h.html#ae8b12504c345c1e0cfef576a494f5d6d">fr_aka_sim_encode_ctx_t::hmac_extra</a></div><div class="ttdeci">uint8_t const  * hmac_extra</div><div class="ttdoc">Extra data for the HMAC function. </div><div class="ttdef"><b>Definition:</b> <a href="eap__aka__sim_2base_8h_source.html#l00239">base.h:239</a></div></div>
<div class="ttc" id="radclient_8h_html_a0100b7d38bdad8451e7ac9a07d276792"><div class="ttname"><a href="radclient_8h.html#a0100b7d38bdad8451e7ac9a07d276792">REDEBUG</a></div><div class="ttdeci">#define REDEBUG(fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="radclient_8h_source.html#l00049">radclient.h:49</a></div></div>
<div class="ttc" id="strerror_8c_html_ae701765650b8aea79a3037bc4921d7f8"><div class="ttname"><a href="strerror_8c.html#ae701765650b8aea79a3037bc4921d7f8">fr_strerror_printf</a></div><div class="ttdeci">void fr_strerror_printf(char const *fmt,...)</div><div class="ttdoc">Log to thread local error buffer. </div><div class="ttdef"><b>Definition:</b> <a href="strerror_8c_source.html#l00194">strerror.c:194</a></div></div>
<div class="ttc" id="util_2types_8h_html_a372af96cb1f1bd71720f5b25c8acfd30a8d0ab1fb5c42cc3e2bc1760914a491cf"><div class="ttname"><a href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30a8d0ab1fb5c42cc3e2bc1760914a491cf">FR_TYPE_UINT8</a></div><div class="ttdoc">8 Bit unsigned integer. </div><div class="ttdef"><b>Definition:</b> <a href="util_2types_8h_source.html#l00052">types.h:52</a></div></div>
<div class="ttc" id="dbuff_8h_html_a20d5827668d3db714a6a41f561f57f8f"><div class="ttname"><a href="dbuff_8h.html#a20d5827668d3db714a6a41f561f57f8f">FR_DBUFF_EXTEND_LOWAT_OR_RETURN</a></div><div class="ttdeci">#define FR_DBUFF_EXTEND_LOWAT_OR_RETURN(_dbuff_or_marker, _lowat)</div><div class="ttdoc">Extend if we&amp;#39;re below _lowat and return if we can&amp;#39;t extend above _lowat. </div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l00519">dbuff.h:519</a></div></div>
<div class="ttc" id="dict_8h_html_ac7eb1cd4956d9e7e0956e7ffe519b180"><div class="ttname"><a href="dict_8h.html#ac7eb1cd4956d9e7e0956e7ffe519b180">FR_DICT_MAX_TLV_STACK</a></div><div class="ttdeci">#define FR_DICT_MAX_TLV_STACK</div><div class="ttdoc">Maximum TLV stack size. </div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00276">dict.h:276</a></div></div>
<div class="ttc" id="dbuff_8h_html_a63b165a38c53671d5ba37d61a6a570ab"><div class="ttname"><a href="dbuff_8h.html#a63b165a38c53671d5ba37d61a6a570ab">FR_DBUFF_MEMSET_RETURN</a></div><div class="ttdeci">#define FR_DBUFF_MEMSET_RETURN(_dbuff_or_marker, _c, _inlen)</div><div class="ttdoc">Set _inlen bytes of a dbuff or marker to _c returning if there is insufficient space. </div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l01160">dbuff.h:1160</a></div></div>
<div class="ttc" id="util_2pair_8h_html_ac3861056e222ad4e7c00cf18c7234506"><div class="ttname"><a href="util_2pair_8h.html#ac3861056e222ad4e7c00cf18c7234506">VP_VERIFY</a></div><div class="ttdeci">#define VP_VERIFY(_x)</div><div class="ttdef"><b>Definition:</b> <a href="util_2pair_8h_source.html#l00045">pair.h:45</a></div></div>
<div class="ttc" id="cursor_8h_html_structfr__cursor__t"><div class="ttname"><a href="cursor_8h.html#structfr__cursor__t">fr_cursor_t</a></div><div class="ttdef"><b>Definition:</b> <a href="cursor_8h_source.html#l00061">cursor.h:61</a></div></div>
<div class="ttc" id="util_2proto_8h_html_ada6aec67bc66c48e2c725961c10b608e"><div class="ttname"><a href="util_2proto_8h.html#ada6aec67bc66c48e2c725961c10b608e">fr_da_stack_t::depth</a></div><div class="ttdeci">uint8_t depth</div><div class="ttdoc">Deepest attribute in the stack. </div><div class="ttdef"><b>Definition:</b> <a href="util_2proto_8h_source.html#l00055">proto.h:55</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_a82e228450a06a9107995a3bcb5ed6f94"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#a82e228450a06a9107995a3bcb5ed6f94">encode_test_ctx_sim</a></div><div class="ttdeci">static int encode_test_ctx_sim(void **out, TALLOC_CTX *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l01014">encode.c:1014</a></div></div>
<div class="ttc" id="util_2proto_8h_html_ab9fdc7bb041370e5abe4d2a9018956b1"><div class="ttname"><a href="util_2proto_8h.html#ab9fdc7bb041370e5abe4d2a9018956b1">FR_PROTO_STACK_PRINT</a></div><div class="ttdeci">#define FR_PROTO_STACK_PRINT(_stack, _depth)</div><div class="ttdef"><b>Definition:</b> <a href="util_2proto_8h_source.html#l00043">proto.h:43</a></div></div>
<div class="ttc" id="value_8c_html_a05ed37702365d7c4ec855a860abdb5c2"><div class="ttname"><a href="value_8c.html#a05ed37702365d7c4ec855a860abdb5c2">fr_value_box_to_network_dbuff</a></div><div class="ttdeci">ssize_t fr_value_box_to_network_dbuff(size_t *need, fr_dbuff_t *dbuff, fr_value_box_t const *value)</div><div class="ttdef"><b>Definition:</b> <a href="value_8c_source.html#l01183">value.c:1183</a></div></div>
<div class="ttc" id="dict_8h_html_a84a65ef48909ce5b80ff4c91cf472f77"><div class="ttname"><a href="dict_8h.html#a84a65ef48909ce5b80ff4c91cf472f77">dict_attr_s::attr</a></div><div class="ttdeci">unsigned int attr</div><div class="ttdoc">Attribute number. </div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00140">dict.h:140</a></div></div>
<div class="ttc" id="eap__aka__sim_2base_8h_html_a4b575d2ddf06d86d5ab369832c7ba269"><div class="ttname"><a href="eap__aka__sim_2base_8h.html#a4b575d2ddf06d86d5ab369832c7ba269">fr_aka_sim_encode_ctx_t::hmac_md</a></div><div class="ttdeci">EVP_MD const  * hmac_md</div><div class="ttdoc">HMAC digest algorithm, usually EVP_sha1(). </div><div class="ttdef"><b>Definition:</b> <a href="eap__aka__sim_2base_8h_source.html#l00236">base.h:236</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_a7a9dc7a2591e7053e8a4aede633f18b4"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#a7a9dc7a2591e7053e8a4aede633f18b4">encode_array</a></div><div class="ttdeci">static ssize_t encode_array(fr_dbuff_t *dbuff, fr_da_stack_t *da_stack, int depth, fr_cursor_t *cursor, void *encoder_ctx)</div><div class="ttdoc">Encodes the data portion of an attribute. </div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l00522">encode.c:522</a></div></div>
<div class="ttc" id="dict_8h_html_aacf809bb15fcfa56e3355258e15c77a0"><div class="ttname"><a href="dict_8h.html#aacf809bb15fcfa56e3355258e15c77a0">dict_attr_s::parent</a></div><div class="ttdeci">fr_dict_attr_t const  * parent</div><div class="ttdoc">Immediate parent of this attribute. </div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00145">dict.h:145</a></div></div>
<div class="ttc" id="cursor_8c_html_ac0e33de2a6f1cb5e82c4d4e4255c2b95"><div class="ttname"><a href="cursor_8c.html#ac0e33de2a6f1cb5e82c4d4e4255c2b95">fr_cursor_head</a></div><div class="ttdeci">void * fr_cursor_head(fr_cursor_t *cursor)</div><div class="ttdoc">Rewind cursor to the start of the list. </div><div class="ttdef"><b>Definition:</b> <a href="cursor_8c_source.html#l00139">cursor.c:139</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2base_8c_html_a35bd6908e69d8452519b3dd57742759d"><div class="ttname"><a href="lib_2eap__aka__sim_2base_8c.html#a35bd6908e69d8452519b3dd57742759d">fr_aka_sim_free</a></div><div class="ttdeci">void fr_aka_sim_free(void)</div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2base_8c_source.html#l00253">base.c:253</a></div></div>
<div class="ttc" id="eap_2types_8h_html_a5f338f2ea659ba27bcfb04be5db22292"><div class="ttname"><a href="eap_2types_8h.html#a5f338f2ea659ba27bcfb04be5db22292">eap_type_data_t::length</a></div><div class="ttdeci">size_t length</div><div class="ttdef"><b>Definition:</b> <a href="eap_2types_8h_source.html#l00111">types.h:111</a></div></div>
<div class="ttc" id="util_2pair_8h_html_structvalue__pair__s"><div class="ttname"><a href="util_2pair_8h.html#structvalue__pair__s">value_pair_s</a></div><div class="ttdoc">Stores an attribute, a value and various bits of other data. </div><div class="ttdef"><b>Definition:</b> <a href="util_2pair_8h_source.html#l00089">pair.h:89</a></div></div>
<div class="ttc" id="eap__aka__sim_2base_8h_html_a2f9c4ab83bc0afe4202f83568da8bdef"><div class="ttname"><a href="eap__aka__sim_2base_8h.html#a2f9c4ab83bc0afe4202f83568da8bdef">AKA_SIM_IV_SIZE</a></div><div class="ttdeci">#define AKA_SIM_IV_SIZE</div><div class="ttdoc">Length of the IV used when processing AT_ENCR. </div><div class="ttdef"><b>Definition:</b> <a href="eap__aka__sim_2base_8h_source.html#l00039">base.h:39</a></div></div>
<div class="ttc" id="value_8h_html_af17d2d4e72bd60de680d3f4a29a1275f"><div class="ttname"><a href="value_8h.html#af17d2d4e72bd60de680d3f4a29a1275f">out</a></div><div class="ttdeci">static size_t char ** out</div><div class="ttdef"><b>Definition:</b> <a href="value_8h_source.html#l00751">value.h:751</a></div></div>
<div class="ttc" id="eap__aka__sim_2base_8h_html_a29af445ef7de31bb2bc912eccd8d1fe9"><div class="ttname"><a href="eap__aka__sim_2base_8h.html#a29af445ef7de31bb2bc912eccd8d1fe9">fr_aka_sim_crypto_sign_packet</a></div><div class="ttdeci">ssize_t fr_aka_sim_crypto_sign_packet(uint8_t out[static AKA_SIM_MAC_DIGEST_SIZE], eap_packet_t *eap_packet, bool zero_mac, EVP_MD const *md, uint8_t const *key, size_t const key_len, uint8_t const *hmac_extra, size_t const hmac_extra_len)</div><div class="ttdoc">Calculate the digest value for a packet. </div><div class="ttdef"><b>Definition:</b> <a href="aka__sim_2crypto_8c_source.html#l00235">crypto.c:235</a></div></div>
<div class="ttc" id="dbuff_8h_html_af23b1899f99e31c4312eb383f73d2a4f"><div class="ttname"><a href="dbuff_8h.html#af23b1899f99e31c4312eb383f73d2a4f">FR_DBUFF_NO_ADVANCE</a></div><div class="ttdeci">#define FR_DBUFF_NO_ADVANCE(_dbuff)</div><div class="ttdoc">Prevent an dbuff being advanced by operations on its child. </div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l00167">dbuff.h:167</a></div></div>
<div class="ttc" id="dbuff_8h_html_a4fc3cf45b3bdb5c902c36ce2e9c2a3ca"><div class="ttname"><a href="dbuff_8h.html#a4fc3cf45b3bdb5c902c36ce2e9c2a3ca">FR_DBUFF_MAX</a></div><div class="ttdeci">#define FR_DBUFF_MAX(_dbuff, _max)</div><div class="ttdoc">Limit the maximum number of bytes available in the dbuff when passing it to another function...</div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l00255">dbuff.h:255</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_a6c31065754acca40b0983e8ffc130997"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#a6c31065754acca40b0983e8ffc130997">is_eap_aka_encodable</a></div><div class="ttdeci">static bool is_eap_aka_encodable(void const *item, void const *uctx)</div><div class="ttdoc">Evaluation function for EAP-AKA-encodability. </div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l00069">encode.c:69</a></div></div>
<div class="ttc" id="dict__ext_8h_html_affb00364829956930ef20d851f569aab"><div class="ttname"><a href="dict__ext_8h.html#affb00364829956930ef20d851f569aab">fr_dict_vendor_num_by_da</a></div><div class="ttdeci">static uint32_t fr_dict_vendor_num_by_da(fr_dict_attr_t const *da)</div><div class="ttdoc">Return the vendor number for an attribute. </div><div class="ttdef"><b>Definition:</b> <a href="dict__ext_8h_source.html#l00171">dict_ext.h:171</a></div></div>
<div class="ttc" id="eap__aka__sim_2base_8h_html_a0f9f79e344ff4f0fd5d28f10da8cac40"><div class="ttname"><a href="eap__aka__sim_2base_8h.html#a0f9f79e344ff4f0fd5d28f10da8cac40">fr_aka_sim_encode_ctx_t::iv_included</a></div><div class="ttdeci">bool iv_included</div><div class="ttdoc">Whether we&amp;#39;ve already added an IV to this packet. </div><div class="ttdef"><b>Definition:</b> <a href="eap__aka__sim_2base_8h_source.html#l00231">base.h:231</a></div></div>
<div class="ttc" id="eap__aka__sim_2base_8h_html_structfr__aka__sim__keys__t"><div class="ttname"><a href="eap__aka__sim_2base_8h.html#structfr__aka__sim__keys__t">fr_aka_sim_keys_t</a></div><div class="ttdoc">Master key state struct for all SIMlike EAP protocols. </div><div class="ttdef"><b>Definition:</b> <a href="eap__aka__sim_2base_8h_source.html#l00138">base.h:138</a></div></div>
<div class="ttc" id="util_2types_8h_html_a90054456da9e7d85661400a69ef2ea8f"><div class="ttname"><a href="util_2types_8h.html#a90054456da9e7d85661400a69ef2ea8f">FR_TYPE_STRUCTURAL</a></div><div class="ttdeci">#define FR_TYPE_STRUCTURAL</div><div class="ttdoc">Match all non value types in case statements. </div><div class="ttdef"><b>Definition:</b> <a href="util_2types_8h_source.html#l00167">types.h:167</a></div></div>
<div class="ttc" id="dbuff_8h_html_a0ec9fef69c790077c6a0c9b5a68cf55b"><div class="ttname"><a href="dbuff_8h.html#a0ec9fef69c790077c6a0c9b5a68cf55b">FR_DBUFF_IN_MEMCPY_RETURN</a></div><div class="ttdeci">#define FR_DBUFF_IN_MEMCPY_RETURN(_out, _in, _inlen)</div><div class="ttdoc">Copy exactly _inlen bytes into dbuff or marker returning if there&amp;#39;s insufficient space. </div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l01032">dbuff.h:1032</a></div></div>
<div class="ttc" id="dbuff_8h_html_acd105ff335478c3daf2ecfa994f95e44"><div class="ttname"><a href="dbuff_8h.html#acd105ff335478c3daf2ecfa994f95e44">fr_dbuff_marker</a></div><div class="ttdeci">static uint8_t * fr_dbuff_marker(fr_dbuff_marker_t *m, fr_dbuff_t *dbuff)</div><div class="ttdoc">Initialises a new marker pointing to the &amp;#39;current&amp;#39; position of the dbuff. </div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l00899">dbuff.h:899</a></div></div>
<div class="ttc" id="eap__aka__sim_2base_8h_html"><div class="ttname"><a href="eap__aka__sim_2base_8h.html">base.h</a></div><div class="ttdoc">Functions common to SIM protocols (EAP-SIM/EAP-AKA/EAP-AKA&amp;#39;) </div></div>
<div class="ttc" id="debug_8h_html_ae62598c720cbf8575cc3080f03058d5d"><div class="ttname"><a href="debug_8h.html#ae62598c720cbf8575cc3080f03058d5d">MEM</a></div><div class="ttdeci">#define MEM(x)</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00035">debug.h:35</a></div></div>
<div class="ttc" id="dict_8h_html_a9ce5fab7d63e50154edddb6206dfe0cb"><div class="ttname"><a href="dict_8h.html#a9ce5fab7d63e50154edddb6206dfe0cb">dict_attr_s::depth</a></div><div class="ttdeci">unsigned int depth</div><div class="ttdoc">Depth of nesting for this attribute. </div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00141">dict.h:141</a></div></div>
<div class="ttc" id="compose_8h_html_structeap__packet__t"><div class="ttname"><a href="compose_8h.html#structeap__packet__t">eap_packet_t</a></div><div class="ttdoc">Structure to hold EAP data. </div><div class="ttdef"><b>Definition:</b> <a href="compose_8h_source.html#l00035">compose.h:35</a></div></div>
<div class="ttc" id="radclient_8c_html_a1d39aac66e12dae50a24cd7a9100ef33"><div class="ttname"><a href="radclient_8c.html#a1d39aac66e12dae50a24cd7a9100ef33">done</a></div><div class="ttdeci">static bool done</div><div class="ttdef"><b>Definition:</b> <a href="radclient_8c_source.html#l00063">radclient.c:63</a></div></div>
<div class="ttc" id="dbuff_8h_html_a30e26cea78c94b2818ede7b3f4738e0e"><div class="ttname"><a href="dbuff_8h.html#a30e26cea78c94b2818ede7b3f4738e0e">fr_dbuff_current</a></div><div class="ttdeci">#define fr_dbuff_current(_dbuff_or_marker)</div><div class="ttdoc">Return the &amp;#39;current&amp;#39; position of a dbuff or marker. </div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l00731">dbuff.h:731</a></div></div>
<div class="ttc" id="cursor_8c_html_af41d1d4247fb969990f602962ec85525"><div class="ttname"><a href="cursor_8c.html#af41d1d4247fb969990f602962ec85525">fr_cursor_filter_next</a></div><div class="ttdeci">void * fr_cursor_filter_next(fr_cursor_t *cursor, fr_cursor_eval_t eval, void const *uctx)</div><div class="ttdoc">Return the next item, skipping the current item, that satisfies an evaluation function. </div><div class="ttdef"><b>Definition:</b> <a href="cursor_8c_source.html#l00429">cursor.c:429</a></div></div>
<div class="ttc" id="value_8h_html_a26bd6a430c456629c00363322491f55a"><div class="ttname"><a href="value_8h.html#a26bd6a430c456629c00363322491f55a">inlen</a></div><div class="ttdeci">static size_t inlen</div><div class="ttdef"><b>Definition:</b> <a href="value_8h_source.html#l00578">value.h:578</a></div></div>
<div class="ttc" id="util_2pair_8h_html_a2f772927643d2f56cc1b22b1c13893a1"><div class="ttname"><a href="util_2pair_8h.html#a2f772927643d2f56cc1b22b1c13893a1">value_pair_s::da</a></div><div class="ttdeci">fr_dict_attr_t const  * da</div><div class="ttdoc">Dictionary attribute defines the attribute number, vendor and type of the attribute. </div><div class="ttdef"><b>Definition:</b> <a href="util_2pair_8h_source.html#l00090">pair.h:90</a></div></div>
<div class="ttc" id="dbuff_8h_html_a350f6766c77392e54cd4bc229739a837"><div class="ttname"><a href="dbuff_8h.html#a350f6766c77392e54cd4bc229739a837">fr_dbuff_start</a></div><div class="ttdeci">#define fr_dbuff_start(_dbuff_or_marker)</div><div class="ttdoc">Return the &amp;#39;start&amp;#39; position of a dbuff or marker. </div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l00718">dbuff.h:718</a></div></div>
<div class="ttc" id="io_2pair_8h_html_ab7230dcb03d6d0a60b003f250f257234"><div class="ttname"><a href="io_2pair_8h.html#ab7230dcb03d6d0a60b003f250f257234">PAIR_ENCODE_FATAL_ERROR</a></div><div class="ttdeci">#define PAIR_ENCODE_FATAL_ERROR</div><div class="ttdoc">Skipped encoding attribute. </div><div class="ttdef"><b>Definition:</b> <a href="io_2pair_8h_source.html#l00039">pair.h:39</a></div></div>
<div class="ttc" id="eap__aka__sim_2base_8h_html_a260ae7894ee8493bdefffde4d089bee8"><div class="ttname"><a href="eap__aka__sim_2base_8h.html#a260ae7894ee8493bdefffde4d089bee8">fr_aka_sim_encode_ctx_t::eap_packet</a></div><div class="ttdeci">eap_packet_t * eap_packet</div><div class="ttdoc">Needed for HMAC generation so we can construct the EAP packet header. </div><div class="ttdef"><b>Definition:</b> <a href="eap__aka__sim_2base_8h_source.html#l00237">base.h:237</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_a5a44d0f96bfe601dc16f8b904f39537a"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#a5a44d0f96bfe601dc16f8b904f39537a">sim_tp_encode_rfc4186</a></div><div class="ttdeci">fr_test_point_pair_encode_t sim_tp_encode_rfc4186</div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l01080">encode.c:1080</a></div></div>
<div class="ttc" id="cursor_8c_html_abf88b92c985da38854d51efbe3116641"><div class="ttname"><a href="cursor_8c.html#abf88b92c985da38854d51efbe3116641">fr_cursor_filter_current</a></div><div class="ttdeci">void * fr_cursor_filter_current(fr_cursor_t *cursor, fr_cursor_eval_t eval, void const *uctx)</div><div class="ttdoc">Return the next item, starting with the current item, that satisfies an evaluation function...</div><div class="ttdef"><b>Definition:</b> <a href="cursor_8c_source.html#l00447">cursor.c:447</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2base_8c_html_aff00e2f8221c3b2802022ec0c09cd3a7"><div class="ttname"><a href="lib_2eap__aka__sim_2base_8c.html#aff00e2f8221c3b2802022ec0c09cd3a7">fr_aka_sim_attr_sizes</a></div><div class="ttdeci">size_t const fr_aka_sim_attr_sizes[FR_TYPE_MAX+1][2]</div><div class="ttdoc">SIM AT on-the-wire format attribute sizes. </div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2base_8c_source.html#l00185">base.c:185</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_ab5c53522ab41ef078f2b6ce4dccb3da6"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#ab5c53522ab41ef078f2b6ce4dccb3da6">encode_test_ctx_sim_rfc4186</a></div><div class="ttdeci">static int encode_test_ctx_sim_rfc4186(void **out, TALLOC_CTX *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l01048">encode.c:1048</a></div></div>
<div class="ttc" id="eap__aka__sim_2base_8h_html_aeca2707db366ec90236d526256557696"><div class="ttname"><a href="eap__aka__sim_2base_8h.html#aeca2707db366ec90236d526256557696">fr_aka_sim_encode_ctx_t::hmac_extra_len</a></div><div class="ttdeci">size_t hmac_extra_len</div><div class="ttdoc">The length of the HMAC data. </div><div class="ttdef"><b>Definition:</b> <a href="eap__aka__sim_2base_8h_source.html#l00240">base.h:240</a></div></div>
<div class="ttc" id="util_2types_8h_html_a372af96cb1f1bd71720f5b25c8acfd30a24741432e1c5c9162fadceb6d1b7508a"><div class="ttname"><a href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30a24741432e1c5c9162fadceb6d1b7508a">FR_TYPE_TLV</a></div><div class="ttdoc">Contains nested attributes. </div><div class="ttdef"><b>Definition:</b> <a href="util_2types_8h_source.html#l00072">types.h:72</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_a976de4c9b2b8e3bb04b0607d05d2f37b"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#a976de4c9b2b8e3bb04b0607d05d2f37b">test_ctx_init</a></div><div class="ttdeci">static fr_aka_sim_encode_ctx_t * test_ctx_init(TALLOC_CTX *ctx, uint8_t const *k_encr, size_t k_encr_len)</div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l00993">encode.c:993</a></div></div>
<div class="ttc" id="build_8h_html_addf5ec070e9499d36b7f2009ce736076"><div class="ttname"><a href="build_8h.html#addf5ec070e9499d36b7f2009ce736076">UNUSED</a></div><div class="ttdeci">#define UNUSED</div><div class="ttdef"><b>Definition:</b> <a href="build_8h_source.html#l00124">build.h:124</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_a203a488f54cb62495963e38db2ab55a3"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#a203a488f54cb62495963e38db2ab55a3">SIM_MAX_ATTRIBUTE_VALUE_LEN</a></div><div class="ttdeci">#define SIM_MAX_ATTRIBUTE_VALUE_LEN</div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l00038">encode.c:38</a></div></div>
<div class="ttc" id="dbuff_8h_html_a2ba47cf778c891b541c68fcf78954775"><div class="ttname"><a href="dbuff_8h.html#a2ba47cf778c891b541c68fcf78954775">fr_dbuff_marker_t</a></div><div class="ttdeci">struct fr_dbuff_marker_s fr_dbuff_marker_t</div><div class="ttdoc">A position marker associated with a dbuff. </div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l00058">dbuff.h:58</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_aba9f98ae827e7a8e928f443dab807f29"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#aba9f98ae827e7a8e928f443dab807f29">encode_tlv_hdr</a></div><div class="ttdeci">static ssize_t encode_tlv_hdr(fr_dbuff_t *dbuff, fr_da_stack_t *da_stack, unsigned int depth, fr_cursor_t *cursor, void *encoder_ctx)</div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l00727">encode.c:727</a></div></div>
<div class="ttc" id="table_8h_html_a52dacc40217bdc0537896b713fc7a59e"><div class="ttname"><a href="table_8h.html#a52dacc40217bdc0537896b713fc7a59e">fr_table_str_by_value</a></div><div class="ttdeci">#define fr_table_str_by_value(_table, _number, _def)</div><div class="ttdoc">Convert an integer to a string. </div><div class="ttdef"><b>Definition:</b> <a href="table_8h_source.html#l00239">table.h:239</a></div></div>
<div class="ttc" id="eap__aka__sim_2base_8h_html_a0641df01e2e110425c062b173cbf2c0a"><div class="ttname"><a href="eap__aka__sim_2base_8h.html#a0641df01e2e110425c062b173cbf2c0a">fr_aka_sim_encode_ctx_t::keys</a></div><div class="ttdeci">fr_aka_sim_keys_t const  * keys</div><div class="ttdoc">From the EAP session. </div><div class="ttdef"><b>Definition:</b> <a href="eap__aka__sim_2base_8h_source.html#l00229">base.h:229</a></div></div>
<div class="ttc" id="dict_8h_html_a6e2b3c4074f4eaa457c7b3050b17db5a"><div class="ttname"><a href="dict_8h.html#a6e2b3c4074f4eaa457c7b3050b17db5a">fr_dict_attr_flags_t::extra</a></div><div class="ttdeci">unsigned int extra</div><div class="ttdoc">really &quot;subtype is used by dict, not by protocol&quot; </div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00090">dict.h:90</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2attrs_8h_html_aa5a26799b1edc0773d42133016b88d32"><div class="ttname"><a href="lib_2eap__aka__sim_2attrs_8h.html#aa5a26799b1edc0773d42133016b88d32">dict_eap_aka_sim</a></div><div class="ttdeci">fr_dict_t const  * dict_eap_aka_sim</div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2base_8c_source.html#l00047">base.c:47</a></div></div>
<div class="ttc" id="dbuff_8h_html_aaae109ead816d3ab29a6e36d49b29865"><div class="ttname"><a href="dbuff_8h.html#aaae109ead816d3ab29a6e36d49b29865">fr_dbuff_init_talloc</a></div><div class="ttdeci">static fr_dbuff_t * fr_dbuff_init_talloc(TALLOC_CTX *ctx, fr_dbuff_t *dbuff, fr_dbuff_uctx_talloc_t *tctx, size_t init, size_t max)</div><div class="ttdoc">Initialise a special dbuff which automatically extends as additional data is written. </div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l00347">dbuff.h:347</a></div></div>
<div class="ttc" id="dbuff_8h_html_ab9db39f44fd1b2c5b5711802ff4bd7a4"><div class="ttname"><a href="dbuff_8h.html#ab9db39f44fd1b2c5b5711802ff4bd7a4">FR_DBUFF_MAX_NO_ADVANCE</a></div><div class="ttdeci">#define FR_DBUFF_MAX_NO_ADVANCE(_dbuff, _max)</div><div class="ttdoc">Limit the maximum number of bytes available in the dbuff when passing it to another function...</div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l00277">dbuff.h:277</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_a38aceb5aba8d754c7db826d0bed4a941"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#a38aceb5aba8d754c7db826d0bed4a941">encode_tlv_internal</a></div><div class="ttdeci">static ssize_t encode_tlv_internal(fr_dbuff_t *dbuff, fr_da_stack_t *da_stack, unsigned int depth, fr_cursor_t *cursor, void *encoder_ctx)</div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l00658">encode.c:658</a></div></div>
<div class="ttc" id="dbuff_8h_html_a86c930ebbfebeaa6dda3d185f0565d4e"><div class="ttname"><a href="dbuff_8h.html#a86c930ebbfebeaa6dda3d185f0565d4e">FR_DBUFF_IN_BYTES_RETURN</a></div><div class="ttdeci">#define FR_DBUFF_IN_BYTES_RETURN(_dbuff,...)</div><div class="ttdoc">Copy a byte sequence into a dbuff returning if there&amp;#39;s insufficient space. </div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l01125">dbuff.h:1125</a></div></div>
<div class="ttc" id="test__point_8h_html_a6def3b7354f72355a6f03ea2a8bddb95"><div class="ttname"><a href="test__point_8h.html#a6def3b7354f72355a6f03ea2a8bddb95">fr_test_point_pair_encode_t::test_ctx</a></div><div class="ttdeci">fr_test_point_ctx_alloc_t test_ctx</div><div class="ttdoc">Allocate a test ctx for the encoder. </div><div class="ttdef"><b>Definition:</b> <a href="test__point_8h_source.html#l00092">test_point.h:92</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_a95262349e8b300e3cd5dd666cfac78e5"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#a95262349e8b300e3cd5dd666cfac78e5">encode_value</a></div><div class="ttdeci">static ssize_t encode_value(fr_dbuff_t *dbuff, fr_da_stack_t *da_stack, int depth, fr_cursor_t *cursor, void *encoder_ctx)</div><div class="ttdoc">Encodes the data portion of an attribute. </div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l00269">encode.c:269</a></div></div>
<div class="ttc" id="cursor_8c_html_af6c2090d1e00319075d6def5aa2666fd"><div class="ttname"><a href="cursor_8c.html#af6c2090d1e00319075d6def5aa2666fd">fr_cursor_next</a></div><div class="ttdeci">void * fr_cursor_next(fr_cursor_t *cursor)</div><div class="ttdoc">Advanced the cursor to the next item. </div><div class="ttdef"><b>Definition:</b> <a href="cursor_8c_source.html#l00183">cursor.c:183</a></div></div>
<div class="ttc" id="build_8h_html_aba1e18067becc3e4b5ac1038c3f192e9"><div class="ttname"><a href="build_8h.html#aba1e18067becc3e4b5ac1038c3f192e9">unlikely</a></div><div class="ttdeci">#define unlikely(_x)</div><div class="ttdef"><b>Definition:</b> <a href="build_8h_source.html#l00160">build.h:160</a></div></div>
<div class="ttc" id="dict_8h_html_af237debed232346007824b84427f2900"><div class="ttname"><a href="dict_8h.html#af237debed232346007824b84427f2900">fr_dict_attr_flags_t::length</a></div><div class="ttdeci">uint8_t length</div><div class="ttdoc">length of the attribute </div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00094">dict.h:94</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_a3e26126143ed6181e602d10062b0ec5f"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#a3e26126143ed6181e602d10062b0ec5f">fr_aka_sim_encode</a></div><div class="ttdeci">ssize_t fr_aka_sim_encode(request_t *request, fr_pair_t *to_encode, void *encode_ctx)</div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l00866">encode.c:866</a></div></div>
<div class="ttc" id="misc_8h_html_a2b8b1a3c768cdf96a12d059080337a18"><div class="ttname"><a href="misc_8h.html#a2b8b1a3c768cdf96a12d059080337a18">ROUND_UP_POW2</a></div><div class="ttdeci">#define ROUND_UP_POW2(_num, _mul)</div><div class="ttdoc">Round up - Only works if _mul is a power of 2 but avoids division. </div><div class="ttdef"><b>Definition:</b> <a href="misc_8h_source.html#l00060">misc.h:60</a></div></div>
<div class="ttc" id="dict_8h_html_af10f5512338ce5c5574aff77cc98da00"><div class="ttname"><a href="dict_8h.html#af10f5512338ce5c5574aff77cc98da00">fr_dict_attr_flags_t::subtype</a></div><div class="ttdeci">uint8_t subtype</div><div class="ttdoc">for FR_TYPE_STRING encoding </div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00092">dict.h:92</a></div></div>
<div class="ttc" id="dict_8h_html_a110793bbb562022ae388c79f72c4fde1"><div class="ttname"><a href="dict_8h.html#a110793bbb562022ae388c79f72c4fde1">dict_attr_s::flags</a></div><div class="ttdeci">fr_dict_attr_flags_t flags</div><div class="ttdoc">Flags. </div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00149">dict.h:149</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_aebc37f0ff41c37fcc125538cb293dc07"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#aebc37f0ff41c37fcc125538cb293dc07">encode_test_ctx_aka</a></div><div class="ttdeci">static int encode_test_ctx_aka(void **out, TALLOC_CTX *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l01031">encode.c:1031</a></div></div>
<div class="ttc" id="eap__aka__sim_2base_8h_html_ace54f2b51d1b34355e743e05d660aae4"><div class="ttname"><a href="eap__aka__sim_2base_8h.html#ace54f2b51d1b34355e743e05d660aae4">fr_aka_sim_keys_t::k_encr</a></div><div class="ttdeci">uint8_t k_encr[16]</div><div class="ttdoc">Derived encryption key. </div><div class="ttdef"><b>Definition:</b> <a href="eap__aka__sim_2base_8h_source.html#l00216">base.h:216</a></div></div>
<div class="ttc" id="pair_8c_html_acc50c595dbf119f3e709aa0e60520f61"><div class="ttname"><a href="pair_8c.html#acc50c595dbf119f3e709aa0e60520f61">fr_pair_list_sort</a></div><div class="ttdeci">void fr_pair_list_sort(fr_pair_list_t *vps, fr_cmp_t cmp)</div><div class="ttdoc">Sort a linked list of fr_pair_ts using merge sort. </div><div class="ttdef"><b>Definition:</b> <a href="pair_8c_source.html#l01006">pair.c:1006</a></div></div>
<div class="ttc" id="proto_8c_html_a1097e0481003e69568734523603d298a"><div class="ttname"><a href="proto_8c.html#a1097e0481003e69568734523603d298a">fr_proto_da_stack_build</a></div><div class="ttdeci">void fr_proto_da_stack_build(fr_da_stack_t *stack, fr_dict_attr_t const *da)</div><div class="ttdoc">Build a complete DA stack from the da back to the root. </div><div class="ttdef"><b>Definition:</b> <a href="proto_8c_source.html#l00124">proto.c:124</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_a3d7250c8c84799ac391ad0fb8e639124"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#a3d7250c8c84799ac391ad0fb8e639124">encode_rfc_hdr</a></div><div class="ttdeci">static ssize_t encode_rfc_hdr(fr_dbuff_t *dbuff, fr_da_stack_t *da_stack, unsigned int depth, fr_cursor_t *cursor, void *encoder_ctx)</div><div class="ttdoc">Encode an RFC format attribute header. </div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l00593">encode.c:593</a></div></div>
<div class="ttc" id="util_2types_8h_html_a372af96cb1f1bd71720f5b25c8acfd30a51d06b2fa62e862fcb34d7c1a122a68f"><div class="ttname"><a href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30a51d06b2fa62e862fcb34d7c1a122a68f">FR_TYPE_UINT16</a></div><div class="ttdoc">16 Bit unsigned integer. </div><div class="ttdef"><b>Definition:</b> <a href="util_2types_8h_source.html#l00053">types.h:53</a></div></div>
<div class="ttc" id="rand_8c_html_ae6966accae06dc7d65d4cc51b5782383"><div class="ttname"><a href="rand_8c.html#ae6966accae06dc7d65d4cc51b5782383">fr_rand</a></div><div class="ttdeci">uint32_t fr_rand(void)</div><div class="ttdoc">Return a 32-bit random number. </div><div class="ttdef"><b>Definition:</b> <a href="rand_8c_source.html#l00094">rand.c:94</a></div></div>
<div class="ttc" id="util_2pair_8h_html_ac283ca220bc7c8c819c33dadbb0def84"><div class="ttname"><a href="util_2pair_8h.html#ac283ca220bc7c8c819c33dadbb0def84">vp</a></div><div class="ttdeci">static size_t vp</div><div class="ttdef"><b>Definition:</b> <a href="util_2pair_8h_source.html#l00360">pair.h:360</a></div></div>
<div class="ttc" id="util_2types_8h_html_a372af96cb1f1bd71720f5b25c8acfd30a3277792336b6d6c1577f0cbb53f74381"><div class="ttname"><a href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30a3277792336b6d6c1577f0cbb53f74381">FR_TYPE_STRING</a></div><div class="ttdoc">String of printable characters. </div><div class="ttdef"><b>Definition:</b> <a href="util_2types_8h_source.html#l00038">types.h:38</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_a2ce856782647f3f95ddcb8db37fda149"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#a2ce856782647f3f95ddcb8db37fda149">sim_tp_encode</a></div><div class="ttdeci">fr_test_point_pair_encode_t sim_tp_encode</div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l01068">encode.c:1068</a></div></div>
<div class="ttc" id="dict_8h_html_a69bc6b5fc308d3de319e04fd998288a9"><div class="ttname"><a href="dict_8h.html#a69bc6b5fc308d3de319e04fd998288a9">fr_dict_attr_flags_t::array</a></div><div class="ttdeci">unsigned int array</div><div class="ttdoc">Pack multiples into 1 attr. </div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00085">dict.h:85</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_a8a7ead5b0e57ca0a5c4d6849476354eb"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#a8a7ead5b0e57ca0a5c4d6849476354eb">fr_aka_sim_encode_pair</a></div><div class="ttdeci">ssize_t fr_aka_sim_encode_pair(fr_dbuff_t *dbuff, fr_cursor_t *cursor, void *encoder_ctx)</div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l00783">encode.c:783</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2base_8c_html_a5abdceed1a7fa542e764bb938856f51d"><div class="ttname"><a href="lib_2eap__aka__sim_2base_8c.html#a5abdceed1a7fa542e764bb938856f51d">fr_aka_sim_octets_prefix_len</a></div><div class="ttdeci">size_t fr_aka_sim_octets_prefix_len(fr_dict_attr_t const *da)</div><div class="ttdoc">Return the number of bytes before the octets value. </div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2base_8c_source.html#l00224">base.c:224</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_a61b16acb898e33a446c742f784749801"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#a61b16acb898e33a446c742f784749801">_test_ctx_free</a></div><div class="ttdeci">static int _test_ctx_free(UNUSED fr_aka_sim_encode_ctx_t *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l00986">encode.c:986</a></div></div>
<div class="ttc" id="util_2proto_8h_html_structfr__da__stack__t"><div class="ttname"><a href="util_2proto_8h.html#structfr__da__stack__t">fr_da_stack_t</a></div><div class="ttdoc">Structure for holding the stack of dictionary attributes being encoded. </div><div class="ttdef"><b>Definition:</b> <a href="util_2proto_8h_source.html#l00054">proto.h:54</a></div></div>
<div class="ttc" id="dict_8h_html_structdict__attr__s"><div class="ttname"><a href="dict_8h.html#structdict__attr__s">dict_attr_s</a></div><div class="ttdoc">Dictionary attribute. </div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00134">dict.h:134</a></div></div>
<div class="ttc" id="dbuff_8h_html_a03ab727e4c61835ac6ee275f8140a9f6"><div class="ttname"><a href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a></div><div class="ttdeci">struct fr_dbuff_s fr_dbuff_t</div><div class="ttdoc">A dbuff. </div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l00043">dbuff.h:43</a></div></div>
<div class="ttc" id="eap__aka__sim_2base_8h_html_ab1fc029851a20190bd3f58d9e450b07c"><div class="ttname"><a href="eap__aka__sim_2base_8h.html#ab1fc029851a20190bd3f58d9e450b07c">fr_aka_sim_keys_t::k_aut_len</a></div><div class="ttdeci">size_t k_aut_len</div><div class="ttdoc">Length of k_aut. 16 for AKA/SIM, 32 for AKA&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="eap__aka__sim_2base_8h_source.html#l00215">base.h:215</a></div></div>
<div class="ttc" id="eap__aka__sim_2base_8h_html_ac6111e986cfcc674ed9317b9f77ea08e"><div class="ttname"><a href="eap__aka__sim_2base_8h.html#ac6111e986cfcc674ed9317b9f77ea08e">fr_aka_sim_encode_ctx_t::iv</a></div><div class="ttdeci">uint8_t iv[AKA_SIM_IV_SIZE]</div><div class="ttdoc">Generated by us using our PRNG. </div><div class="ttdef"><b>Definition:</b> <a href="eap__aka__sim_2base_8h_source.html#l00230">base.h:230</a></div></div>
<div class="ttc" id="util_2proto_8h_html_a6209506c43933c5b9b4cd3a718ae3a9c"><div class="ttname"><a href="util_2proto_8h.html#a6209506c43933c5b9b4cd3a718ae3a9c">FR_PROTO_HEX_DUMP</a></div><div class="ttdeci">#define FR_PROTO_HEX_DUMP(_data, _data_len, _fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="util_2proto_8h_source.html#l00041">proto.h:41</a></div></div>
<div class="ttc" id="value_8c_html_a07313a74940e698753a2b6af066892d2"><div class="ttname"><a href="value_8c.html#a07313a74940e698753a2b6af066892d2">fr_value_box_type_table</a></div><div class="ttdeci">fr_table_num_ordered_t const fr_value_box_type_table[]</div><div class="ttdoc">Sanity checks. </div><div class="ttdef"><b>Definition:</b> <a href="value_8c_source.html#l00104">value.c:104</a></div></div>
<div class="ttc" id="dict_8h_html_a4ed0e2dd07a0ef75f1fa32225ac4a762"><div class="ttname"><a href="dict_8h.html#a4ed0e2dd07a0ef75f1fa32225ac4a762">fr_dict_attr_common_parent</a></div><div class="ttdeci">fr_dict_attr_t const  * fr_dict_attr_common_parent(fr_dict_attr_t const *a, fr_dict_attr_t const *b, bool is_ancestor)</div><div class="ttdoc">Find a common ancestor that two TLV type attributes share. </div><div class="ttdef"><b>Definition:</b> <a href="dict__util_8c_source.html#l01440">dict_util.c:1440</a></div></div>
<div class="ttc" id="dbuff_8h_html_a69045029f34094a7c6802864c77d3dac"><div class="ttname"><a href="dbuff_8h.html#a69045029f34094a7c6802864c77d3dac">fr_dbuff_extend_lowat</a></div><div class="ttdeci">#define fr_dbuff_extend_lowat(_status, _dbuff_or_marker, _lowat)</div><div class="ttdoc">Extend if we&amp;#39;re below _lowat. </div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l00506">dbuff.h:506</a></div></div>
<div class="ttc" id="test__point_8h_html_structfr__test__point__pair__encode__t"><div class="ttname"><a href="test__point_8h.html#structfr__test__point__pair__encode__t">fr_test_point_pair_encode_t</a></div><div class="ttdoc">Entry point for pair encoders. </div><div class="ttdef"><b>Definition:</b> <a href="test__point_8h_source.html#l00091">test_point.h:91</a></div></div>
<div class="ttc" id="util_2types_8h_html_a372af96cb1f1bd71720f5b25c8acfd30a9f6ff75b35b1cad1456b5008158ddcb3"><div class="ttname"><a href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30a9f6ff75b35b1cad1456b5008158ddcb3">FR_TYPE_INT32</a></div><div class="ttdoc">32 Bit signed integer. </div><div class="ttdef"><b>Definition:</b> <a href="util_2types_8h_source.html#l00059">types.h:59</a></div></div>
<div class="ttc" id="compose_8h_html_a038c6e73669e577062e4ec74a224ad4a"><div class="ttname"><a href="compose_8h.html#a038c6e73669e577062e4ec74a224ad4a">eap_packet_t::type</a></div><div class="ttdeci">eap_type_data_t type</div><div class="ttdef"><b>Definition:</b> <a href="compose_8h_source.html#l00039">compose.h:39</a></div></div>
<div class="ttc" id="build_8h_html_a17c6430174bd106c2fa80061361f0f7b"><div class="ttname"><a href="build_8h.html#a17c6430174bd106c2fa80061361f0f7b">RCSID</a></div><div class="ttdeci">#define RCSID(id)</div><div class="ttdef"><b>Definition:</b> <a href="build_8h_source.html#l00218">build.h:218</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2base_8c_html_a580043357c97379fc072baec950ca6f4"><div class="ttname"><a href="lib_2eap__aka__sim_2base_8c.html#a580043357c97379fc072baec950ca6f4">fr_aka_sim_init</a></div><div class="ttdeci">int fr_aka_sim_init(void)</div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2base_8c_source.html#l00232">base.c:232</a></div></div>
<div class="ttc" id="eap__aka__sim_2base_8h_html_structfr__aka__sim__encode__ctx__t"><div class="ttname"><a href="eap__aka__sim_2base_8h.html#structfr__aka__sim__encode__ctx__t">fr_aka_sim_encode_ctx_t</a></div><div class="ttdef"><b>Definition:</b> <a href="eap__aka__sim_2base_8h_source.html#l00227">base.h:227</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_a6adf46712c7949ab2afd181e71091e6d"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#a6adf46712c7949ab2afd181e71091e6d">encode_encrypted_value</a></div><div class="ttdeci">static ssize_t encode_encrypted_value(fr_dbuff_t *dbuff, uint8_t const *in, size_t inlen, void *encoder_ctx)</div><div class="ttdoc">encrypt a value with AES-CBC-128 </div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l00152">encode.c:152</a></div></div>
<div class="ttc" id="eap__aka__sim_2base_8h_html_aa5aaa347c34279757bb0a22a1a537080"><div class="ttname"><a href="eap__aka__sim_2base_8h.html#aa5aaa347c34279757bb0a22a1a537080">fr_aka_sim_keys_t::k_aut</a></div><div class="ttdeci">uint8_t k_aut[32]</div><div class="ttdoc">Derived authentication key. </div><div class="ttdef"><b>Definition:</b> <a href="eap__aka__sim_2base_8h_source.html#l00214">base.h:214</a></div></div>
<div class="ttc" id="dict_8h_html_a7c79c676c03022a0e7404ae0232bd902"><div class="ttname"><a href="dict_8h.html#a7c79c676c03022a0e7404ae0232bd902">fr_dict_root</a></div><div class="ttdeci">fr_dict_attr_t const  * fr_dict_root(fr_dict_t const *dict)</div><div class="ttdoc">Return the root attribute of a dictionary. </div><div class="ttdef"><b>Definition:</b> <a href="dict__util_8c_source.html#l01620">dict_util.c:1620</a></div></div>
<div class="ttc" id="pair_8c_html_a5221bccb1c200e7ea7669e05bbb8dc17"><div class="ttname"><a href="pair_8c.html#a5221bccb1c200e7ea7669e05bbb8dc17">fr_pair_cmp_by_parent_num</a></div><div class="ttdeci">int8_t fr_pair_cmp_by_parent_num(void const *a, void const *b)</div><div class="ttdoc">Order attributes by their parent(s), attribute number, and tag. </div><div class="ttdef"><b>Definition:</b> <a href="pair_8c_source.html#l00775">pair.c:775</a></div></div>
<div class="ttc" id="util_2types_8h_html_a372af96cb1f1bd71720f5b25c8acfd30ad2b7a961b1fad6fd4498c4ed804fd262"><div class="ttname"><a href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30ad2b7a961b1fad6fd4498c4ed804fd262">FR_TYPE_BOOL</a></div><div class="ttdoc">A truth value. </div><div class="ttdef"><b>Definition:</b> <a href="util_2types_8h_source.html#l00050">types.h:50</a></div></div>
<div class="ttc" id="dict_8h_html_a6ee10539d2910058f6e5379d0d0c1994"><div class="ttname"><a href="dict_8h.html#a6ee10539d2910058f6e5379d0d0c1994">fr_dict_attr_flags_t::internal</a></div><div class="ttdeci">unsigned int internal</div><div class="ttdoc">Internal attribute, should not be received in protocol packets, should not be encoded. </div><div class="ttdef"><b>Definition:</b> <a href="dict_8h_source.html#l00083">dict.h:83</a></div></div>
<div class="ttc" id="util_2types_8h_html_a372af96cb1f1bd71720f5b25c8acfd30aee66e99bbe53ef358fe622bff40770f8"><div class="ttname"><a href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30aee66e99bbe53ef358fe622bff40770f8">FR_TYPE_OCTETS</a></div><div class="ttdoc">Raw octets. </div><div class="ttdef"><b>Definition:</b> <a href="util_2types_8h_source.html#l00039">types.h:39</a></div></div>
<div class="ttc" id="request_8h_html_structrequest__s"><div class="ttname"><a href="request_8h.html#structrequest__s">request_s</a></div><div class="ttdef"><b>Definition:</b> <a href="request_8h_source.html#l00083">request.h:83</a></div></div>
<div class="ttc" id="lib_2eap__aka__sim_2encode_8c_html_a21c8044cf3343fd4ae285166089bb857"><div class="ttname"><a href="lib_2eap__aka__sim_2encode_8c.html#a21c8044cf3343fd4ae285166089bb857">encode_iv</a></div><div class="ttdeci">static ssize_t encode_iv(fr_dbuff_t *dbuff, void *encoder_ctx)</div><div class="ttdoc">Add an IV to a packet. </div><div class="ttdef"><b>Definition:</b> <a href="lib_2eap__aka__sim_2encode_8c_source.html#l00101">encode.c:101</a></div></div>
<div class="ttc" id="misc_8h_html_a910bc75603224dd113ee07a9c527eee6"><div class="ttname"><a href="misc_8h.html#a910bc75603224dd113ee07a9c527eee6">ROUND_UP</a></div><div class="ttdeci">#define ROUND_UP(_num, _mul)</div><div class="ttdoc">Round up - Works in all cases, but is slower. </div><div class="ttdef"><b>Definition:</b> <a href="misc_8h_source.html#l00064">misc.h:64</a></div></div>
<div class="ttc" id="util_2proto_8h_html_aef787648fce674b4e977851d3f16b2e3"><div class="ttname"><a href="util_2proto_8h.html#aef787648fce674b4e977851d3f16b2e3">fr_da_stack_t::da</a></div><div class="ttdeci">fr_dict_attr_t const  * da[FR_DICT_MAX_TLV_STACK+1]</div><div class="ttdoc">The stack. </div><div class="ttdef"><b>Definition:</b> <a href="util_2proto_8h_source.html#l00056">proto.h:56</a></div></div>
<div class="ttc" id="dbuff_8h_html_a0a0a91bc998e927bfb71f573dd93bd38"><div class="ttname"><a href="dbuff_8h.html#a0a0a91bc998e927bfb71f573dd93bd38">fr_dbuff_advance</a></div><div class="ttdeci">#define fr_dbuff_advance(_dbuff_or_marker, _len)</div><div class="ttdoc">Advance &amp;#39;current&amp;#39; position in dbuff or marker by _len bytes. </div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l00851">dbuff.h:851</a></div></div>
<div class="ttc" id="value_8h_html_a47ef05ec8d75829006b7eba839c1b603"><div class="ttname"><a href="value_8h.html#a47ef05ec8d75829006b7eba839c1b603">in</a></div><div class="ttdeci">static size_t in</div><div class="ttdef"><b>Definition:</b> <a href="value_8h_source.html#l00578">value.h:578</a></div></div>
<div class="ttc" id="ipaccess_8h_html_a8aed22e2c7b283705ec82e0120515618"><div class="ttname"><a href="ipaccess_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a></div><div class="ttdeci">uint16_t len</div><div class="ttdef"><b>Definition:</b> <a href="ipaccess_8h_source.html#l00047">ipaccess.h:47</a></div></div>
<div class="ttc" id="dbuff_8h_html_a5cf0a1dbaf5c01a32e9e54b96acc5463"><div class="ttname"><a href="dbuff_8h.html#a5cf0a1dbaf5c01a32e9e54b96acc5463">FR_DBUFF_IN_RETURN</a></div><div class="ttdeci">#define FR_DBUFF_IN_RETURN(_out, _in)</div><div class="ttdoc">Copy data from a fixed sized C type into a dbuff returning if there is insufficient space...</div><div class="ttdef"><b>Definition:</b> <a href="dbuff_8h_source.html#l01237">dbuff.h:1237</a></div></div>
<div class="ttc" id="util_2types_8h_html_a372af96cb1f1bd71720f5b25c8acfd30aacc9d809a7a605775fff050eb108ff02"><div class="ttname"><a href="util_2types_8h.html#a372af96cb1f1bd71720f5b25c8acfd30aacc9d809a7a605775fff050eb108ff02">FR_TYPE_UINT64</a></div><div class="ttdoc">64 Bit unsigned integer. </div><div class="ttdef"><b>Definition:</b> <a href="util_2types_8h_source.html#l00055">types.h:55</a></div></div>
<div class="ttc" id="pair_8c_html_a49b539ca8f3606dcff10e26c1b52e9ab"><div class="ttname"><a href="pair_8c.html#a49b539ca8f3606dcff10e26c1b52e9ab">fr_pair_find_by_child_num</a></div><div class="ttdeci">fr_pair_t * fr_pair_find_by_child_num(fr_pair_list_t *head, fr_dict_attr_t const *parent, unsigned int attr)</div><div class="ttdoc">Find the pair with the matching attribute. </div><div class="ttdef"><b>Definition:</b> <a href="pair_8c_source.html#l00447">pair.c:447</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 12 2020 23:30:15 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
