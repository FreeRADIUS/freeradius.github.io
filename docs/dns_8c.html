<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>/home/runner/work/freeradius-server/freeradius-server/src/lib/util/dns.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="freeradius.png"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_c85d3e3c5052e9ad9ce18c6863244a25.html">lib</a></li><li class="navelem"><a class="el" href="dir_862598e893fc0f1bed46c00d00206efb.html">util</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">dns.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Functions to manipulate DNS labels.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;freeradius-devel/util/cursor.h&gt;</code><br />
<code>#include &lt;freeradius-devel/util/misc.h&gt;</code><br />
<code>#include &lt;freeradius-devel/util/strerror.h&gt;</code><br />
<code>#include &lt;freeradius-devel/util/talloc.h&gt;</code><br />
<code>#include &lt;freeradius-devel/util/value.h&gt;</code><br />
<code>#include &lt;freeradius-devel/util/dns.h&gt;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for dns.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dns_8c__incl.svg" width="100%" height="417"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</div>
<p><a href="dns_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a76d25e06e4a786ae6deb598c940aa084"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a76d25e06e4a786ae6deb598c940aa084">dns_label_compress</a> (uint8_t const *start, uint8_t const *end, uint8_t const **new_search, uint8_t *label, uint8_t **label_end)</td></tr>
<tr class="memdesc:a76d25e06e4a786ae6deb598c940aa084"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compress "label" by looking at it recursively.  <a href="#a76d25e06e4a786ae6deb598c940aa084">More...</a><br /></td></tr>
<tr class="separator:a76d25e06e4a786ae6deb598c940aa084"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40cee36ccab75fa6bc1b8e960d27fc0b"><td class="memItemLeft" align="right" valign="top">static ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a40cee36ccab75fa6bc1b8e960d27fc0b">dns_label_decode</a> (uint8_t const *buf, uint8_t const **start, uint8_t const **next)</td></tr>
<tr class="separator:a40cee36ccab75fa6bc1b8e960d27fc0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9577ee8b470f2fc2af46e13b06f28720"><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a9577ee8b470f2fc2af46e13b06f28720">fr_dns_label_from_value_box</a> (size_t *need, uint8_t *buf, size_t buf_len, uint8_t *where, bool compression, <a class="el" href="value_8h.html#a4a9e69e78ad1a81da0976e8f29a4e444">fr_value_box_t</a> const *value)</td></tr>
<tr class="memdesc:a9577ee8b470f2fc2af46e13b06f28720"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encode a single value box of type string, serializing its contents to a dns label.  <a href="#a9577ee8b470f2fc2af46e13b06f28720">More...</a><br /></td></tr>
<tr class="separator:a9577ee8b470f2fc2af46e13b06f28720"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d93f5ad0d2300c4d2927c4abbcd3f01"><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a0d93f5ad0d2300c4d2927c4abbcd3f01">fr_dns_label_from_value_box_dbuff</a> (<a class="el" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a> *dbuff, bool compression, <a class="el" href="value_8h.html#a4a9e69e78ad1a81da0976e8f29a4e444">fr_value_box_t</a> const *value)</td></tr>
<tr class="memdesc:a0d93f5ad0d2300c4d2927c4abbcd3f01"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encode a single value box of type string, serializing its contents to a dns label in a dbuff.  <a href="#a0d93f5ad0d2300c4d2927c4abbcd3f01">More...</a><br /></td></tr>
<tr class="separator:a0d93f5ad0d2300c4d2927c4abbcd3f01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00f1df43970120c903080239dde86e1e"><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a00f1df43970120c903080239dde86e1e">fr_dns_label_network_length</a> (uint8_t const *buf, size_t buf_len)</td></tr>
<tr class="memdesc:a00f1df43970120c903080239dde86e1e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the <em>network</em> length of a DNS label in a buffer i.e.  <a href="#a00f1df43970120c903080239dde86e1e">More...</a><br /></td></tr>
<tr class="separator:a00f1df43970120c903080239dde86e1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a465dbfeab7c459b70b9058e1f8d8fc64"><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a465dbfeab7c459b70b9058e1f8d8fc64">fr_dns_label_to_value_box</a> (TALLOC_CTX *ctx, <a class="el" href="value_8h.html#a4a9e69e78ad1a81da0976e8f29a4e444">fr_value_box_t</a> *dst, uint8_t const *src, size_t <a class="el" href="ipaccess_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>, uint8_t const *label, bool tainted)</td></tr>
<tr class="memdesc:a465dbfeab7c459b70b9058e1f8d8fc64"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decode a <a class="el" href="value_8h.html#a4a9e69e78ad1a81da0976e8f29a4e444">fr_value_box_t</a> from one DNS label.  <a href="#a465dbfeab7c459b70b9058e1f8d8fc64">More...</a><br /></td></tr>
<tr class="separator:a465dbfeab7c459b70b9058e1f8d8fc64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36fdabb51b2111e3a148c011f6a6a914"><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a36fdabb51b2111e3a148c011f6a6a914">fr_dns_label_uncompressed_length</a> (uint8_t const *buf, size_t buf_len, uint8_t const **next)</td></tr>
<tr class="memdesc:a36fdabb51b2111e3a148c011f6a6a914"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the <em>uncompressed</em> length of a DNS label in a network buffer.  <a href="#a36fdabb51b2111e3a148c011f6a6a914">More...</a><br /></td></tr>
<tr class="separator:a36fdabb51b2111e3a148c011f6a6a914"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d62b7c82e16c1d53f4638482533c525"><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#a1d62b7c82e16c1d53f4638482533c525">fr_dns_labels_network_verify</a> (uint8_t const *buf, size_t buf_len)</td></tr>
<tr class="memdesc:a1d62b7c82e16c1d53f4638482533c525"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verify that a network buffer contains valid DNS labels.  <a href="#a1d62b7c82e16c1d53f4638482533c525">More...</a><br /></td></tr>
<tr class="separator:a1d62b7c82e16c1d53f4638482533c525"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeea73d4bafd27a383ed88afba5effd5f"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dns_8c.html#aeea73d4bafd27a383ed88afba5effd5f">labelcmp</a> (uint8_t const *a, uint8_t const *b, size_t <a class="el" href="ipaccess_8h.html#a8aed22e2c7b283705ec82e0120515618">len</a>)</td></tr>
<tr class="memdesc:aeea73d4bafd27a383ed88afba5effd5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compare two labels in a case-insensitive fashion.  <a href="#aeea73d4bafd27a383ed88afba5effd5f">More...</a><br /></td></tr>
<tr class="separator:aeea73d4bafd27a383ed88afba5effd5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Functions to manipulate DNS labels. </p>
<dl class="section copyright"><dt>Copyright</dt><dd>2019 The FreeRADIUS server project </dd>
<dd>
2019 Network RADIUS SARL <a href="#" onclick="location.href='mai'+'lto:'+'leg'+'al'+'@ne'+'tw'+'ork'+'ra'+'diu'+'s.'+'com'; return false;">legal<span style="display: none;">.nosp@m.</span>@net<span style="display: none;">.nosp@m.</span>workr<span style="display: none;">.nosp@m.</span>adiu<span style="display: none;">.nosp@m.</span>s.com</a> </dd></dl>

<p class="definition">Definition in file <a class="el" href="dns_8c_source.html">dns.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a76d25e06e4a786ae6deb598c940aa084"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76d25e06e4a786ae6deb598c940aa084">&#9670;&nbsp;</a></span>dns_label_compress()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool dns_label_compress </td>
          <td>(</td>
          <td class="paramtype">uint8_t const *&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t const *&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t const **&#160;</td>
          <td class="paramname"><em>new_search</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t **&#160;</td>
          <td class="paramname"><em>label_end</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compress "label" by looking at it recursively. </p>
<p>For "ftp.example.com", it searches the input buffer for a matching "com". It only does string compares if it finds bytes "03 xx xx
 xx 00". This means that the scan is quick, because most bytes are skipped.</p>
<p>If a matching string is found, the label is updated to replace "com" with a 2-byte pointer P1. The process then proceeds recursively, with "exampleP1".</p>
<p>The input buffer is the scanned again for labels of matching length (7 here), AND which either end in the value of "P1", or end <em>at</em> P1. If we find a match, we replace "exampleP1" with "P2". The process then proceeds recursively with "ftpP2".</p>
<p>Since the algorithm replaces known suffixes with pointers, we <em>never</em> have to compare full names. Instead, we only ever compare one label to one other label. And then only if the labels have the same lengths AND the same suffixes (00 byte, or a pointer P).</p>
<p>As an extra optimization, we track the start of the label where we found the compressed pointer. e.g. "www.example.com" when compressing "com". We know that the "com" string CANNOT appear before this label. Because if it did, then the "www.example.com" name would have instead been compressed, as in "www.exampleP1".</p>
<p>This optimization ensures that we scan as little of the buffer as possible, by moving the search start ahead in the buffer. This optimization also means that in many cases, the suffix we're looking for (e.g. "example.com") is in the first label we search. Which means that we end up ignoring most of the buffer.</p>
<p>This algorithm is O(N * B), where N is the number of labels in a name (e.g. 3 for "ftp.example.com"), and "B" is the size of the buffer. It also does linear scans of the buffer, which are good for read-ahead. Each input label is compared to labels in the buffer only when very limited situations apply. And we never compare the full input name to full names in the buffer.</p>
<p>In the case where we are adding many names from the same zone to the input buffer, the input buffer will start with the zone name. So any searches will match that. The only reason to continue scanning the buffer is to see if the name prefix already exists. If we assume that the records do not contain duplicates, then we can likely skip that scan, too.</p>
<p>Adding that optimization, however, requires tracking the maximum size of a name across multiple invocations of the function. For example, if the maximum length name in the buffer is 3 labels, and we're adding a 3 label name, then we can stop scanning the buffer as soon as we compressed the 2 suffix labels. Since we are guaranteed that there are no duplicates, we are sure that there is no existing 3-label name which matches a 3-label name in the buffer.</p>
<p>A different and more straightforward approach is to loop over all labels in the name from longest to shortest, and comparing them to each name in the buffer in turn. That algorithm ends up being O(L1 * T * L2), where L1 is the length of the input name, T is the total number of names in the buffer, and L2 is the average length of names in the buffer. This algorithm can result in the buffer being scanned many, many, times. The scan is also done forwards (due to comparing names one after the other), but also backwards (due to following pointers). Which makes for poor locality of reference.</p>
<p>i.e. that approach <em>has</em> to scan the entire input buffer, because that's where all of the names are. Further, it has to scan it at least "N" times, because there are N labels in the input name. So O(N * B) is the <em>lower</em> bound for this algorithm.</p>
<p>It gets worse when the straightforward algorithm does pointer following instead of pointer comparisons. It ends up scanning portions of the input buffer many, many, times. i.e. it can compare an input "com" name to "org" once for every "org" name in the input buffer. In contrast, because our algorithm does not do pointer following, it only compares "com" to "org" once.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">start</td><td>input buffer holding one or more labels </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">end</td><td>end of the input buffer </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">new_search</td><td>Where the parent call to <a class="el" href="dns_8c.html#a76d25e06e4a786ae6deb598c940aa084" title="Compress &quot;label&quot; by looking at it recursively. ">dns_label_compress()</a> should start searching from, instead of from "start". </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">label</td><td>label to add to the buffer. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">label_end</td><td>updated end of the input label after compression. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>false, we didn't compress the input</li>
<li>true, we did compress the input. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="dns_8c_source.html#l00162">162</a> of file <a class="el" href="dns_8c_source.html">dns.c</a>.</p>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="dns_8c_a76d25e06e4a786ae6deb598c940aa084_cgraph.svg" width="275" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dns_8c_a76d25e06e4a786ae6deb598c940aa084_icgraph.svg" width="100%" height="404"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a40cee36ccab75fa6bc1b8e960d27fc0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40cee36ccab75fa6bc1b8e960d27fc0b">&#9670;&nbsp;</a></span>dns_label_decode()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static ssize_t dns_label_decode </td>
          <td>(</td>
          <td class="paramtype">uint8_t const *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t const **&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t const **&#160;</td>
          <td class="paramname"><em>next</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="dns_8c_source.html#l00896">896</a> of file <a class="el" href="dns_8c_source.html">dns.c</a>.</p>
<div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dns_8c_a40cee36ccab75fa6bc1b8e960d27fc0b_icgraph.svg" width="100%" height="530"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a9577ee8b470f2fc2af46e13b06f28720"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9577ee8b470f2fc2af46e13b06f28720">&#9670;&nbsp;</a></span>fr_dns_label_from_value_box()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t fr_dns_label_from_value_box </td>
          <td>(</td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>need</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>buf_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>where</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>compression</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="value_8h.html#a4a9e69e78ad1a81da0976e8f29a4e444">fr_value_box_t</a> const *&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Encode a single value box of type string, serializing its contents to a dns label. </p>
<p>This functions takes a large buffer and encodes the label in part of the buffer. This API is necessary in order to allow DNS label compression.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">need</td><td>if not NULL, how long "buf_len" should be to serialize the rest of the data. Note: Only variable length types will be partially encoded. Fixed length types will not be partially encoded. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">buf</td><td>Buffer where labels are stored </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buf_len</td><td>The length of the output buffer </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">where</td><td>Where to write this label </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">compression</td><td>Whether or not to do DNS label compression. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">value</td><td>to encode. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 no bytes were written, see need value to determine</li>
<li>&gt;0 the number of bytes written to "where", NOT "buf + where + outlen"</li>
<li>&lt;0 on error. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="dns_8c_source.html#l00531">531</a> of file <a class="el" href="dns_8c_source.html">dns.c</a>.</p>
<div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dns_8c_a9577ee8b470f2fc2af46e13b06f28720_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dns_8c_a9577ee8b470f2fc2af46e13b06f28720_icgraph.svg" width="100%" height="404"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a0d93f5ad0d2300c4d2927c4abbcd3f01"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d93f5ad0d2300c4d2927c4abbcd3f01">&#9670;&nbsp;</a></span>fr_dns_label_from_value_box_dbuff()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t fr_dns_label_from_value_box_dbuff </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="dbuff_8h.html#a03ab727e4c61835ac6ee275f8140a9f6">fr_dbuff_t</a> *&#160;</td>
          <td class="paramname"><em>dbuff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>compression</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="value_8h.html#a4a9e69e78ad1a81da0976e8f29a4e444">fr_value_box_t</a> const *&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Encode a single value box of type string, serializing its contents to a dns label in a dbuff. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">dbuff</td><td>Buffer where labels are written </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">compression</td><td>Whether or not to do DNS label compression. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">value</td><td>to encode. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>&gt;0 the number of bytes written to the dbuff</li>
<li>0 could not encode anything, an error has occurred.</li>
<li>&lt;0 the number of bytes the dbuff should have had, instead of "remaining". </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="dns_8c_source.html#l00497">497</a> of file <a class="el" href="dns_8c_source.html">dns.c</a>.</p>
<div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dns_8c_a0d93f5ad0d2300c4d2927c4abbcd3f01_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dns_8c_a0d93f5ad0d2300c4d2927c4abbcd3f01_icgraph.svg" width="100%" height="437"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a00f1df43970120c903080239dde86e1e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00f1df43970120c903080239dde86e1e">&#9670;&nbsp;</a></span>fr_dns_label_network_length()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t fr_dns_label_network_length </td>
          <td>(</td>
          <td class="paramtype">uint8_t const *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>buf_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the <em>network</em> length of a DNS label in a buffer i.e. </p>
<p>the number of bytes in the encoded representation of the dns label.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">buf</td><td>buffer holding one or more DNS labels </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buf_len</td><td>total length of the buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>&lt;=0 on error, offset from buf where the invalid label is located.</li>
<li>&gt; 0 network length of this particular DNS label </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="dns_8c_source.html#l01052">1052</a> of file <a class="el" href="dns_8c_source.html">dns.c</a>.</p>

</div>
</div>
<a id="a465dbfeab7c459b70b9058e1f8d8fc64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a465dbfeab7c459b70b9058e1f8d8fc64">&#9670;&nbsp;</a></span>fr_dns_label_to_value_box()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t fr_dns_label_to_value_box </td>
          <td>(</td>
          <td class="paramtype">TALLOC_CTX *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="value_8h.html#a4a9e69e78ad1a81da0976e8f29a4e444">fr_value_box_t</a> *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t const *&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t const *&#160;</td>
          <td class="paramname"><em>label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>tainted</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Decode a <a class="el" href="value_8h.html#a4a9e69e78ad1a81da0976e8f29a4e444">fr_value_box_t</a> from one DNS label. </p>
<p>The output type is always FR_TYPE_STRING</p>
<p>Note that the caller MUST call fr_dns_labels_network_verify(src, len) before calling this function. Otherwise bad things will happen.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>Where to allocate any talloc buffers required. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">dst</td><td>value_box to write the result to. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">src</td><td>Start of the buffer containing DNS labels </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">len</td><td>Length of the buffer to decode </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">label</td><td>This particular label </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tainted</td><td>Whether the value came from a trusted source. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>&gt;= 0 The number of network bytes consumed.</li>
<li>&lt;0 on error. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="dns_8c_source.html#l00946">946</a> of file <a class="el" href="dns_8c_source.html">dns.c</a>.</p>
<div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dns_8c_a465dbfeab7c459b70b9058e1f8d8fc64_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dns_8c_a465dbfeab7c459b70b9058e1f8d8fc64_icgraph.svg" width="100%" height="530"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a36fdabb51b2111e3a148c011f6a6a914"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36fdabb51b2111e3a148c011f6a6a914">&#9670;&nbsp;</a></span>fr_dns_label_uncompressed_length()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t fr_dns_label_uncompressed_length </td>
          <td>(</td>
          <td class="paramtype">uint8_t const *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>buf_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t const **&#160;</td>
          <td class="paramname"><em>next</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the <em>uncompressed</em> length of a DNS label in a network buffer. </p>
<p>i.e. how bytes are required to store the uncompressed version of the label.</p>
<p>Note that a bare 0x00 byte has length 1, to account for '.'</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">buf</td><td>buffer holding one or more DNS labels </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buf_len</td><td>total length of the buffer </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">next</td><td>the DNS label to check, updated to point to the next label </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>&lt;=0 on error, offset from buf where the invalid label is located.</li>
<li>&gt; 0 decoded size of this particular DNS label </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="dns_8c_source.html#l00704">704</a> of file <a class="el" href="dns_8c_source.html">dns.c</a>.</p>
<div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dns_8c_a36fdabb51b2111e3a148c011f6a6a914_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-11" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dns_8c_a36fdabb51b2111e3a148c011f6a6a914_icgraph.svg" width="100%" height="530"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a1d62b7c82e16c1d53f4638482533c525"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d62b7c82e16c1d53f4638482533c525">&#9670;&nbsp;</a></span>fr_dns_labels_network_verify()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t fr_dns_labels_network_verify </td>
          <td>(</td>
          <td class="paramtype">uint8_t const *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>buf_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Verify that a network buffer contains valid DNS labels. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">buf</td><td>buffer holding one or more DNS labels </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buf_len</td><td>total length of the buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>&lt;=0 on error, where in the buffer the invalid label is located.</li>
<li>&gt; 0 total size of the labels. SHOULD be buf_len </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="dns_8c_source.html#l00882">882</a> of file <a class="el" href="dns_8c_source.html">dns.c</a>.</p>
<div id="dynsection-12" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dns_8c_a1d62b7c82e16c1d53f4638482533c525_cgraph.svg" width="100%" height="560"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-13" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dns_8c_a1d62b7c82e16c1d53f4638482533c525_icgraph.svg" width="100%" height="530"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="aeea73d4bafd27a383ed88afba5effd5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeea73d4bafd27a383ed88afba5effd5f">&#9670;&nbsp;</a></span>labelcmp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool labelcmp </td>
          <td>(</td>
          <td class="paramtype">uint8_t const *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t const *&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compare two labels in a case-insensitive fashion. </p>
<p>This function requires that the input is valid, i.e. all characters are within [-0-9A-Za-z]. If any other input is given, it will break. </p>

<p class="definition">Definition at line <a class="el" href="dns_8c_source.html#l00039">39</a> of file <a class="el" href="dns_8c_source.html">dns.c</a>.</p>
<div id="dynsection-14" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dns_8c_aeea73d4bafd27a383ed88afba5effd5f_icgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Nov 13 2020 18:13:06 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
