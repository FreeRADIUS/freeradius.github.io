<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>/home/runner/work/freeradius-server/freeradius-server/src/lib/redis/cluster.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="freeradius.png"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_c85d3e3c5052e9ad9ce18c6863244a25.html">lib</a></li><li class="navelem"><a class="el" href="dir_efa02c211b4bb5072e90e61ec8101341.html">redis</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">cluster.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;freeradius-devel/util/debug.h&gt;</code><br />
<code>#include &lt;freeradius-devel/server/cf_parse.h&gt;</code><br />
<code>#include &lt;freeradius-devel/util/fifo.h&gt;</code><br />
<code>#include &lt;freeradius-devel/util/misc.h&gt;</code><br />
<code>#include &lt;freeradius-devel/util/rand.h&gt;</code><br />
<code>#include &quot;<a class="el" href="redis_2base_8h_source.html">base.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="cluster_8h_source.html">cluster.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="crc16_8h_source.html">crc16.h</a>&quot;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for cluster.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c__incl.svg" width="100%" height="484"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</div>
<p><a href="cluster_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:structaddr__by__role__ctx__t"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#structaddr__by__role__ctx__t">addr_by_role_ctx_t</a></td></tr>
<tr class="memdesc:structaddr__by__role__ctx__t"><td class="mdescLeft">&#160;</td><td class="mdescRight">Private ctx structure to pass to _cluster_role_walk.  <a href="cluster_8c.html#structaddr__by__role__ctx__t">More...</a><br /></td></tr>
<tr class="separator:structaddr__by__role__ctx__t"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structcluster__nodes__live__t"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#structcluster__nodes__live__t">cluster_nodes_live_t</a></td></tr>
<tr class="memdesc:structcluster__nodes__live__t"><td class="mdescLeft">&#160;</td><td class="mdescRight">Live nodes data, used to perform weighted random selection of alternative nodes.  <a href="cluster_8c.html#structcluster__nodes__live__t">More...</a><br /></td></tr>
<tr class="separator:structcluster__nodes__live__t"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structcluster__nodes__live__t_8node"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#structcluster__nodes__live__t_8node">cluster_nodes_live_t.node</a></td></tr>
<tr class="separator:structcluster__nodes__live__t_8node"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structfr__redis__cluster"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#structfr__redis__cluster">fr_redis_cluster</a></td></tr>
<tr class="memdesc:structfr__redis__cluster"><td class="mdescLeft">&#160;</td><td class="mdescRight">A redis cluster.  <a href="cluster_8c.html#structfr__redis__cluster">More...</a><br /></td></tr>
<tr class="separator:structfr__redis__cluster"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structfr__redis__cluster__key__slot__s"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#structfr__redis__cluster__key__slot__s">fr_redis_cluster_key_slot_s</a></td></tr>
<tr class="memdesc:structfr__redis__cluster__key__slot__s"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indexes in the fr_redis_cluster_node_t array for a single key slot.  <a href="cluster_8c.html#structfr__redis__cluster__key__slot__s">More...</a><br /></td></tr>
<tr class="separator:structfr__redis__cluster__key__slot__s"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structfr__redis__cluster__node__s"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#structfr__redis__cluster__node__s">fr_redis_cluster_node_s</a></td></tr>
<tr class="memdesc:structfr__redis__cluster__node__s"><td class="mdescLeft">&#160;</td><td class="mdescRight">A Redis cluster node.  <a href="cluster_8c.html#structfr__redis__cluster__node__s">More...</a><br /></td></tr>
<tr class="separator:structfr__redis__cluster__node__s"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a499f02134e8db6561098379b98e39aec"><td class="memItemLeft" align="right" valign="top">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a499f02134e8db6561098379b98e39aec">CLOSED_PERIOD</a>&#160;&#160;&#160;10000</td></tr>
<tr class="memdesc:a499f02134e8db6561098379b98e39aec"><td class="mdescLeft">&#160;</td><td class="mdescRight">How recently must the closed have.  <a href="#a499f02134e8db6561098379b98e39aec">More...</a><br /></td></tr>
<tr class="separator:a499f02134e8db6561098379b98e39aec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fef6f34098c2c35620d95b87051db15"><td class="memItemLeft" align="right" valign="top">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a1fef6f34098c2c35620d95b87051db15">CLOSED_WEIGHT</a>&#160;&#160;&#160;1</td></tr>
<tr class="memdesc:a1fef6f34098c2c35620d95b87051db15"><td class="mdescLeft">&#160;</td><td class="mdescRight">What weight to give to nodes that.  <a href="#a1fef6f34098c2c35620d95b87051db15">More...</a><br /></td></tr>
<tr class="separator:a1fef6f34098c2c35620d95b87051db15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae582e68a84a2fe181402bccea7bd9642"><td class="memItemLeft" align="right" valign="top">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#ae582e68a84a2fe181402bccea7bd9642">FAILED_PERIOD</a>&#160;&#160;&#160;10000</td></tr>
<tr class="memdesc:ae582e68a84a2fe181402bccea7bd9642"><td class="mdescLeft">&#160;</td><td class="mdescRight">How recently must the spawn failure.  <a href="#ae582e68a84a2fe181402bccea7bd9642">More...</a><br /></td></tr>
<tr class="separator:ae582e68a84a2fe181402bccea7bd9642"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99beff4acf01c0e434e0e7cd6e802d2a"><td class="memItemLeft" align="right" valign="top">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a99beff4acf01c0e434e0e7cd6e802d2a">FAILED_WEIGHT</a>&#160;&#160;&#160;1</td></tr>
<tr class="memdesc:a99beff4acf01c0e434e0e7cd6e802d2a"><td class="mdescLeft">&#160;</td><td class="mdescRight">What weight to give to nodes that.  <a href="#a99beff4acf01c0e434e0e7cd6e802d2a">More...</a><br /></td></tr>
<tr class="separator:a99beff4acf01c0e434e0e7cd6e802d2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e80ab62f62c981f7c0d8bef06f7fda1"><td class="memItemLeft" align="right" valign="top">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a5e80ab62f62c981f7c0d8bef06f7fda1">KEY_SLOTS</a>&#160;&#160;&#160;16384</td></tr>
<tr class="memdesc:a5e80ab62f62c981f7c0d8bef06f7fda1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum number of keyslots (should not change).  <a href="#a5e80ab62f62c981f7c0d8bef06f7fda1">More...</a><br /></td></tr>
<tr class="separator:a5e80ab62f62c981f7c0d8bef06f7fda1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a3c5190bdbe2a4780a460383970aa92"><td class="memItemLeft" align="right" valign="top">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a2a3c5190bdbe2a4780a460383970aa92">MAX_SLAVES</a>&#160;&#160;&#160;5</td></tr>
<tr class="memdesc:a2a3c5190bdbe2a4780a460383970aa92"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum number of slaves associated.  <a href="#a2a3c5190bdbe2a4780a460383970aa92">More...</a><br /></td></tr>
<tr class="separator:a2a3c5190bdbe2a4780a460383970aa92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab24f7ec000923e6905d2784e4f2d7ec8"><td class="memItemLeft" align="right" valign="top">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#ab24f7ec000923e6905d2784e4f2d7ec8">RELEASED_MIN_WEIGHT</a>&#160;&#160;&#160;1000</td></tr>
<tr class="memdesc:ab24f7ec000923e6905d2784e4f2d7ec8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Minimum weight to assign to node.  <a href="#ab24f7ec000923e6905d2784e4f2d7ec8">More...</a><br /></td></tr>
<tr class="separator:ab24f7ec000923e6905d2784e4f2d7ec8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea82648a9b32b96cdfe54b7d8af99ad1"><td class="memItemLeft" align="right" valign="top">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#aea82648a9b32b96cdfe54b7d8af99ad1">RELEASED_PERIOD</a>&#160;&#160;&#160;10000</td></tr>
<tr class="memdesc:aea82648a9b32b96cdfe54b7d8af99ad1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Period after which we don't care.  <a href="#aea82648a9b32b96cdfe54b7d8af99ad1">More...</a><br /></td></tr>
<tr class="separator:aea82648a9b32b96cdfe54b7d8af99ad1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a140def72dc1a62af24e8491b633cd7fa"><td class="memItemLeft" align="right" valign="top">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a140def72dc1a62af24e8491b633cd7fa">SET_ACTIVE</a>(_node)</td></tr>
<tr class="separator:a140def72dc1a62af24e8491b633cd7fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39b4c8703a6d4c5985e30a284bcae1bc"><td class="memItemLeft" align="right" valign="top">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a39b4c8703a6d4c5985e30a284bcae1bc">SET_ADDR</a>(_addr,  _map)</td></tr>
<tr class="separator:a39b4c8703a6d4c5985e30a284bcae1bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e112e3fac086d7b1d3abf4d20bc50ba"><td class="memItemLeft" align="right" valign="top">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a7e112e3fac086d7b1d3abf4d20bc50ba">SET_INACTIVE</a>(_node)</td></tr>
<tr class="separator:a7e112e3fac086d7b1d3abf4d20bc50ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad42c4142ea660edb9c9c59919db42c3c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#ad42c4142ea660edb9c9c59919db42c3c">_cluster_conn_free</a> (<a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> *conn)</td></tr>
<tr class="memdesc:ad42c4142ea660edb9c9c59919db42c3c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for freeing a Redis connection.  <a href="#ad42c4142ea660edb9c9c59919db42c3c">More...</a><br /></td></tr>
<tr class="separator:ad42c4142ea660edb9c9c59919db42c3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d10baf4738fb89915995b74f91c4657"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a0d10baf4738fb89915995b74f91c4657">_cluster_node_cmp</a> (void const *a, void const *b)</td></tr>
<tr class="memdesc:a0d10baf4738fb89915995b74f91c4657"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compare two redis nodes to check equality.  <a href="#a0d10baf4738fb89915995b74f91c4657">More...</a><br /></td></tr>
<tr class="separator:a0d10baf4738fb89915995b74f91c4657"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e311d208f7ff97416b2b4d4f172e859"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a8e311d208f7ff97416b2b4d4f172e859">_cluster_node_conf_apply</a> (<a class="el" href="pool_8h.html#aba3234b79613f1a29d858b2b87ef8e38">fr_pool_t</a> *pool, void *opaque)</td></tr>
<tr class="memdesc:a8e311d208f7ff97416b2b4d4f172e859"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reconnect callback to apply new pool config.  <a href="#a8e311d208f7ff97416b2b4d4f172e859">More...</a><br /></td></tr>
<tr class="separator:a8e311d208f7ff97416b2b4d4f172e859"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24277898be92e15d2a83609333f0ba8b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a24277898be92e15d2a83609333f0ba8b">_cluster_pool_walk</a> (void *<a class="el" href="ring__buffer__test_8c.html#a4b83b6e2cf0af27630a64dce8dd7717a">data</a>, void *uctx)</td></tr>
<tr class="memdesc:a24277898be92e15d2a83609333f0ba8b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Walk all used pools adding them to the live node list.  <a href="#a24277898be92e15d2a83609333f0ba8b">More...</a><br /></td></tr>
<tr class="separator:a24277898be92e15d2a83609333f0ba8b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc7986d095a8628f07ec1898e09c15dc"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#adc7986d095a8628f07ec1898e09c15dc">_cluster_role_walk</a> (void *<a class="el" href="ring__buffer__test_8c.html#a4b83b6e2cf0af27630a64dce8dd7717a">data</a>, void *uctx)</td></tr>
<tr class="memdesc:adc7986d095a8628f07ec1898e09c15dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Walk all used pools, recording the IP addresses of ones matching the filter.  <a href="#adc7986d095a8628f07ec1898e09c15dc">More...</a><br /></td></tr>
<tr class="separator:adc7986d095a8628f07ec1898e09c15dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f95874edd88b0727e16ba84243a63f6"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a6f95874edd88b0727e16ba84243a63f6">_cluster_version_walk</a> (void *<a class="el" href="ring__buffer__test_8c.html#a4b83b6e2cf0af27630a64dce8dd7717a">data</a>, void *uctx)</td></tr>
<tr class="memdesc:a6f95874edd88b0727e16ba84243a63f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Walk all used pools checking their versions.  <a href="#a6f95874edd88b0727e16ba84243a63f6">More...</a><br /></td></tr>
<tr class="separator:a6f95874edd88b0727e16ba84243a63f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98955e703d5c04fe6aae3f256e8a9e97"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a98955e703d5c04fe6aae3f256e8a9e97">_fr_redis_cluster_free</a> (<a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *cluster)</td></tr>
<tr class="memdesc:a98955e703d5c04fe6aae3f256e8a9e97"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroy mutex associated with cluster slots structure.  <a href="#a98955e703d5c04fe6aae3f256e8a9e97">More...</a><br /></td></tr>
<tr class="separator:a98955e703d5c04fe6aae3f256e8a9e97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c0d451a4e820f097ddcda88d8613aac"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a3c0d451a4e820f097ddcda88d8613aac">cluster_key_hash</a> (uint8_t const *key, size_t key_len)</td></tr>
<tr class="memdesc:a3c0d451a4e820f097ddcda88d8613aac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resolve key to key slot.  <a href="#a3c0d451a4e820f097ddcda88d8613aac">More...</a><br /></td></tr>
<tr class="separator:a3c0d451a4e820f097ddcda88d8613aac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab434868c42486ab9876b2043c26439f2"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eb">fr_redis_cluster_rcode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#ab434868c42486ab9876b2043c26439f2">cluster_map_apply</a> (<a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *cluster, redisReply *reply)</td></tr>
<tr class="memdesc:ab434868c42486ab9876b2043c26439f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply a cluster map received from a cluster node.  <a href="#ab434868c42486ab9876b2043c26439f2">More...</a><br /></td></tr>
<tr class="separator:ab434868c42486ab9876b2043c26439f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a010b9b97335d882b7becb494a6c9b0cc"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eb">fr_redis_cluster_rcode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a010b9b97335d882b7becb494a6c9b0cc">cluster_map_get</a> (redisReply **<a class="el" href="value_8h.html#af17d2d4e72bd60de680d3f4a29a1275f">out</a>, <a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> *conn)</td></tr>
<tr class="memdesc:a010b9b97335d882b7becb494a6c9b0cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Learn a new cluster layout by querying the node that issued the -MOVE.  <a href="#a010b9b97335d882b7becb494a6c9b0cc">More...</a><br /></td></tr>
<tr class="separator:a010b9b97335d882b7becb494a6c9b0cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3138560083c65262afc5b8a682195a23"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a3138560083c65262afc5b8a682195a23">cluster_map_node_validate</a> (redisReply *<a class="el" href="xlat_8h.html#a8deb835975545524d2ba27f3dca61e29">node</a>, int map_idx, int node_idx)</td></tr>
<tr class="memdesc:a3138560083c65262afc5b8a682195a23"><td class="mdescLeft">&#160;</td><td class="mdescRight">Validate a cluster map node entry.  <a href="#a3138560083c65262afc5b8a682195a23">More...</a><br /></td></tr>
<tr class="separator:a3138560083c65262afc5b8a682195a23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41047732e0ed1cb4b556eee169110e76"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eb">fr_redis_cluster_rcode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a41047732e0ed1cb4b556eee169110e76">cluster_node_conf_from_redirect</a> (uint16_t *key_slot, <a class="el" href="util_2socket_8h.html#structfr__socket__t">fr_socket_t</a> *node_addr, redisReply *redirect)</td></tr>
<tr class="memdesc:a41047732e0ed1cb4b556eee169110e76"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse a -MOVED or -ASK redirect.  <a href="#a41047732e0ed1cb4b556eee169110e76">More...</a><br /></td></tr>
<tr class="separator:a41047732e0ed1cb4b556eee169110e76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c73b18c41ba2a09719df3a9b7d66c2e"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eb">fr_redis_cluster_rcode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a2c73b18c41ba2a09719df3a9b7d66c2e">cluster_node_connect</a> (<a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *cluster, <a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> *<a class="el" href="xlat_8h.html#a8deb835975545524d2ba27f3dca61e29">node</a>)</td></tr>
<tr class="memdesc:a2c73b18c41ba2a09719df3a9b7d66c2e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Establish a connection to a cluster node.  <a href="#a2c73b18c41ba2a09719df3a9b7d66c2e">More...</a><br /></td></tr>
<tr class="separator:a2c73b18c41ba2a09719df3a9b7d66c2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41749370374d5c9bb23aebced0817386"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a41749370374d5c9bb23aebced0817386">cluster_node_find_live</a> (<a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> **live_node, <a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> **live_conn, <a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, <a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *cluster, <a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> *skip)</td></tr>
<tr class="memdesc:a41749370374d5c9bb23aebced0817386"><td class="mdescLeft">&#160;</td><td class="mdescRight">Attempt to find a live pool in the cluster.  <a href="#a41749370374d5c9bb23aebced0817386">More...</a><br /></td></tr>
<tr class="separator:a41749370374d5c9bb23aebced0817386"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2e3907f33250de6cc7e66adad0f4377"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eb">fr_redis_cluster_rcode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#aa2e3907f33250de6cc7e66adad0f4377">cluster_node_ping</a> (<a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, <a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> *<a class="el" href="xlat_8h.html#a8deb835975545524d2ba27f3dca61e29">node</a>, <a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> *conn)</td></tr>
<tr class="memdesc:aa2e3907f33250de6cc7e66adad0f4377"><td class="mdescLeft">&#160;</td><td class="mdescRight">Issue a ping request against a cluster node.  <a href="#aa2e3907f33250de6cc7e66adad0f4377">More...</a><br /></td></tr>
<tr class="separator:aa2e3907f33250de6cc7e66adad0f4377"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0b0090317c51ebde20847dd293c2db4"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#aa0b0090317c51ebde20847dd293c2db4">cluster_node_pool_health</a> (<a class="el" href="time_8h.html#ae3bbe82b46d7b09dbfc1caa6765ddbde">fr_time_t</a> now, <a class="el" href="pool_8h.html#a63674e9f90d86b0dd6d290f3b90723e5">fr_pool_state_t</a> const *state)</td></tr>
<tr class="memdesc:aa0b0090317c51ebde20847dd293c2db4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Try to determine the health of a cluster node passively by examining its pool state.  <a href="#aa0b0090317c51ebde20847dd293c2db4">More...</a><br /></td></tr>
<tr class="separator:aa0b0090317c51ebde20847dd293c2db4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4030e10e7438e81a42623a42beb18e42"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eb">fr_redis_cluster_rcode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a4030e10e7438e81a42623a42beb18e42">cluster_redirect</a> (<a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> **<a class="el" href="value_8h.html#af17d2d4e72bd60de680d3f4a29a1275f">out</a>, <a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *cluster, redisReply *reply)</td></tr>
<tr class="memdesc:a4030e10e7438e81a42623a42beb18e42"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve or associate a node with the server indicated in the redirect.  <a href="#a4030e10e7438e81a42623a42beb18e42">More...</a><br /></td></tr>
<tr class="separator:a4030e10e7438e81a42623a42beb18e42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cfe9143eeda529e5a7f2a2e9920e1a2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a4cfe9143eeda529e5a7f2a2e9920e1a2">fr_redis_cluster_alloc</a> (TALLOC_CTX *ctx, <a class="el" href="cf__util_8h.html#a0f39d8043920472ea4c687c97f7173b3">CONF_SECTION</a> *module, <a class="el" href="redis_2base_8h.html#structfr__redis__conf__t">fr_redis_conf_t</a> *<a class="el" href="radsniff_8c.html#ae9b08c8e16b52f7ab0e5c13fb7775156">conf</a>, bool triggers_enabled, char const *log_prefix, char const *trigger_prefix, <a class="el" href="util_2pair_8h.html#a9ab81fd13d950dc8af802107f161d222">fr_pair_t</a> *trigger_args)</td></tr>
<tr class="memdesc:a4cfe9143eeda529e5a7f2a2e9920e1a2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate and initialise a new cluster structure.  <a href="#a4cfe9143eeda529e5a7f2a2e9920e1a2">More...</a><br /></td></tr>
<tr class="separator:a4cfe9143eeda529e5a7f2a2e9920e1a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e404a7e34498f81c83423409b7b8431"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a9e404a7e34498f81c83423409b7b8431">fr_redis_cluster_conn_create</a> (TALLOC_CTX *ctx, void *instance, <a class="el" href="time_8h.html#a107fc1fa0fdf50e580c17fe543d2eeb5">fr_time_delta_t</a> <a class="el" href="dhcpclient_8c.html#ae73d456a0605d7523a3a5de0533681f7">timeout</a>)</td></tr>
<tr class="memdesc:a9e404a7e34498f81c83423409b7b8431"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new connection to a Redis node.  <a href="#a9e404a7e34498f81c83423409b7b8431">More...</a><br /></td></tr>
<tr class="separator:a9e404a7e34498f81c83423409b7b8431"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeedf2e38865249fdff93e0a898742b35"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#aeedf2e38865249fdff93e0a898742b35">fr_redis_cluster_ipaddr</a> (<a class="el" href="inet_8h.html#structfr__ipaddr__t">fr_ipaddr_t</a> *<a class="el" href="value_8h.html#af17d2d4e72bd60de680d3f4a29a1275f">out</a>, <a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> const *<a class="el" href="xlat_8h.html#a8deb835975545524d2ba27f3dca61e29">node</a>)</td></tr>
<tr class="memdesc:aeedf2e38865249fdff93e0a898742b35"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the ipaddr of a particular node.  <a href="#aeedf2e38865249fdff93e0a898742b35">More...</a><br /></td></tr>
<tr class="separator:aeedf2e38865249fdff93e0a898742b35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb4c67a77b88e9886d889eb8192b2df7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> const  *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#acb4c67a77b88e9886d889eb8192b2df7">fr_redis_cluster_master</a> (<a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *cluster, <a class="el" href="cluster_8h.html#a7daa2ec0fc27ec191190b81e5011a8f0">fr_redis_cluster_key_slot_t</a> const *key_slot)</td></tr>
<tr class="memdesc:acb4c67a77b88e9886d889eb8192b2df7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the master node that would be used for a particular key.  <a href="#acb4c67a77b88e9886d889eb8192b2df7">More...</a><br /></td></tr>
<tr class="separator:acb4c67a77b88e9886d889eb8192b2df7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8c5c4a9b4dc3226e00bdb9f4fb10b69"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#af8c5c4a9b4dc3226e00bdb9f4fb10b69">fr_redis_cluster_min_version</a> (<a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *cluster, char const *min_version)</td></tr>
<tr class="memdesc:af8c5c4a9b4dc3226e00bdb9f4fb10b69"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if members of the cluster are above a certain version.  <a href="#af8c5c4a9b4dc3226e00bdb9f4fb10b69">More...</a><br /></td></tr>
<tr class="separator:af8c5c4a9b4dc3226e00bdb9f4fb10b69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a872442e42a59159dd9af849d8716d290"><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a872442e42a59159dd9af849d8716d290">fr_redis_cluster_node_addr_by_role</a> (TALLOC_CTX *ctx, <a class="el" href="util_2socket_8h.html#structfr__socket__t">fr_socket_t</a> *<a class="el" href="value_8h.html#af17d2d4e72bd60de680d3f4a29a1275f">out</a>[], <a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *cluster, bool is_master, bool is_slave)</td></tr>
<tr class="memdesc:a872442e42a59159dd9af849d8716d290"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return an array of IP addresses belonging to masters or slaves.  <a href="#a872442e42a59159dd9af849d8716d290">More...</a><br /></td></tr>
<tr class="separator:a872442e42a59159dd9af849d8716d290"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7eb8f6d14fe9d19bc3caae6c17cd3b21"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a7eb8f6d14fe9d19bc3caae6c17cd3b21">fr_redis_cluster_pool_by_node_addr</a> (<a class="el" href="pool_8h.html#aba3234b79613f1a29d858b2b87ef8e38">fr_pool_t</a> **pool, <a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *cluster, <a class="el" href="util_2socket_8h.html#structfr__socket__t">fr_socket_t</a> *node_addr, bool create)</td></tr>
<tr class="memdesc:a7eb8f6d14fe9d19bc3caae6c17cd3b21"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the pool associated with a node in the cluster.  <a href="#a7eb8f6d14fe9d19bc3caae6c17cd3b21">More...</a><br /></td></tr>
<tr class="separator:a7eb8f6d14fe9d19bc3caae6c17cd3b21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94d038e46a3e83f191ad84151b98c256"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a94d038e46a3e83f191ad84151b98c256">fr_redis_cluster_port</a> (uint16_t *<a class="el" href="value_8h.html#af17d2d4e72bd60de680d3f4a29a1275f">out</a>, <a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> const *<a class="el" href="xlat_8h.html#a8deb835975545524d2ba27f3dca61e29">node</a>)</td></tr>
<tr class="memdesc:a94d038e46a3e83f191ad84151b98c256"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the port of a particular node.  <a href="#a94d038e46a3e83f191ad84151b98c256">More...</a><br /></td></tr>
<tr class="separator:a94d038e46a3e83f191ad84151b98c256"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab17f60095577fae39f1d708d92536594"><td class="memItemLeft" align="right" valign="top"><a class="el" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eb">fr_redis_cluster_rcode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#ab17f60095577fae39f1d708d92536594">fr_redis_cluster_remap</a> (<a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, <a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *cluster, <a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> *conn)</td></tr>
<tr class="memdesc:ab17f60095577fae39f1d708d92536594"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform a runtime remap of the cluster.  <a href="#ab17f60095577fae39f1d708d92536594">More...</a><br /></td></tr>
<tr class="separator:ab17f60095577fae39f1d708d92536594"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8f0983a06fb5e19bf1e34b60f68aada"><td class="memItemLeft" align="right" valign="top"><a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> const  *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#ab8f0983a06fb5e19bf1e34b60f68aada">fr_redis_cluster_slave</a> (<a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *cluster, <a class="el" href="cluster_8h.html#a7daa2ec0fc27ec191190b81e5011a8f0">fr_redis_cluster_key_slot_t</a> const *key_slot, uint8_t slave_num)</td></tr>
<tr class="memdesc:ab8f0983a06fb5e19bf1e34b60f68aada"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the slave node that would be used for a particular key.  <a href="#ab8f0983a06fb5e19bf1e34b60f68aada">More...</a><br /></td></tr>
<tr class="separator:ab8f0983a06fb5e19bf1e34b60f68aada"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42089316968a1f9599a92ae67dd79ee5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="cluster_8h.html#a7daa2ec0fc27ec191190b81e5011a8f0">fr_redis_cluster_key_slot_t</a> const  *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a42089316968a1f9599a92ae67dd79ee5">fr_redis_cluster_slot_by_key</a> (<a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *cluster, <a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, uint8_t const *key, size_t key_len)</td></tr>
<tr class="memdesc:a42089316968a1f9599a92ae67dd79ee5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implements the key slot selection scheme used by freeradius.  <a href="#a42089316968a1f9599a92ae67dd79ee5">More...</a><br /></td></tr>
<tr class="separator:a42089316968a1f9599a92ae67dd79ee5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac292207b4d5816986eb8e4457791b491"><td class="memItemLeft" align="right" valign="top"><a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feb">fr_redis_rcode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#ac292207b4d5816986eb8e4457791b491">fr_redis_cluster_state_init</a> (<a class="el" href="cluster_8h.html#structfr__redis__cluster__state__t">fr_redis_cluster_state_t</a> *state, <a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> **conn, <a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *cluster, <a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, uint8_t const *key, size_t key_len, bool read_only)</td></tr>
<tr class="memdesc:ac292207b4d5816986eb8e4457791b491"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resolve a key to a pool, and reserve a connection in that pool.  <a href="#ac292207b4d5816986eb8e4457791b491">More...</a><br /></td></tr>
<tr class="separator:ac292207b4d5816986eb8e4457791b491"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02e48068a3e77ab228e414708b5543ee"><td class="memItemLeft" align="right" valign="top"><a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feb">fr_redis_rcode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a02e48068a3e77ab228e414708b5543ee">fr_redis_cluster_state_next</a> (<a class="el" href="cluster_8h.html#structfr__redis__cluster__state__t">fr_redis_cluster_state_t</a> *state, <a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> **conn, <a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *cluster, <a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *request, <a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feb">fr_redis_rcode_t</a> status, redisReply **reply)</td></tr>
<tr class="memdesc:a02e48068a3e77ab228e414708b5543ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the next connection to attempt a command against.  <a href="#a02e48068a3e77ab228e414708b5543ee">More...</a><br /></td></tr>
<tr class="separator:a02e48068a3e77ab228e414708b5543ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ae22455c185445898e1c4140ee6cfaa74"><td class="memItemLeft" align="right" valign="top"><a class="el" href="table_8h.html#structfr__table__num__sorted__t">fr_table_num_sorted_t</a> const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#ae22455c185445898e1c4140ee6cfaa74">fr_redis_cluster_rcodes_table</a> []</td></tr>
<tr class="separator:ae22455c185445898e1c4140ee6cfaa74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8db82bbe86710d10b015b9f9164fea00"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cluster_8c.html#a8db82bbe86710d10b015b9f9164fea00">fr_redis_cluster_rcodes_table_len</a> = <a class="el" href="build_8h.html#ae0bb64e73aeef0ab6772433f210e9d57">NUM_ELEMENTS</a>(<a class="el" href="cluster_8h.html#ae22455c185445898e1c4140ee6cfaa74">fr_redis_cluster_rcodes_table</a>)</td></tr>
<tr class="separator:a8db82bbe86710d10b015b9f9164fea00"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="structaddr__by__role__ctx__t" id="structaddr__by__role__ctx__t"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structaddr__by__role__ctx__t">&#9670;&nbsp;</a></span>addr_by_role_ctx_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct addr_by_role_ctx_t</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Private ctx structure to pass to _cluster_role_walk. </p>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l02082">2082</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
</div><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Collaboration diagram for addr_by_role_ctx_t:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="structaddr__by__role__ctx__t__coll__graph.svg" width="143" height="127"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="aa816f5e33557c43bde27a3e3f0ecb4fb"></a>uint8_t</td>
<td class="fieldname">
count</td>
<td class="fielddoc">
</td></tr>
<tr><td class="fieldtype">
<a id="a87628d11ecd303ceaa4dc4141058deb8"></a><a class="el" href="util_2socket_8h.html#structfr__socket__t">fr_socket_t</a> *</td>
<td class="fieldname">
found</td>
<td class="fielddoc">
</td></tr>
<tr><td class="fieldtype">
<a id="aabae06d3de4295e9c51c04fb6ab3a987"></a>bool</td>
<td class="fieldname">
is_master</td>
<td class="fielddoc">
</td></tr>
<tr><td class="fieldtype">
<a id="af6bfaf56a15401ff0e3c2a88f28aec3c"></a>bool</td>
<td class="fieldname">
is_slave</td>
<td class="fielddoc">
</td></tr>
</table>

</div>
</div>
<a name="structcluster__nodes__live__t" id="structcluster__nodes__live__t"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structcluster__nodes__live__t">&#9670;&nbsp;</a></span>cluster_nodes_live_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct cluster_nodes_live_t</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Live nodes data, used to perform weighted random selection of alternative nodes. </p>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00188">188</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="a8d12f6669aca449311ff475e1efe7101"></a>uint8_t</td>
<td class="fieldname">
next</td>
<td class="fielddoc">
Next index in live. </td></tr>
<tr><td class="fieldtype">
<a id="a73879eaee0cb6abc19e5d2ededbdb90a"></a>struct <a class="el" href="cluster_8c.html#structcluster__nodes__live__t_8node">cluster_nodes_live_t</a></td>
<td class="fieldname">
node[UINT8_MAX - 1]</td>
<td class="fielddoc">
Array of live node IDs (and weights). </td></tr>
<tr><td class="fieldtype">
<a id="a24d2bfda64f2641894b3ab25d7b46646"></a>uint8_t</td>
<td class="fieldname">
skip</td>
<td class="fielddoc">
</td></tr>
</table>

</div>
</div>
<a name="structcluster__nodes__live__t_8node" id="structcluster__nodes__live__t_8node"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structcluster__nodes__live__t_8node">&#9670;&nbsp;</a></span>cluster_nodes_live_t.node</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct cluster_nodes_live_t.node</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00189">189</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="add259fe1898bfef8be8771aca900f7ea"></a>unsigned int</td>
<td class="fieldname">
cumulative</td>
<td class="fielddoc">
Cumulative weight. </td></tr>
<tr><td class="fieldtype">
<a id="ab80bb7740288fda1f201890375a60c8f"></a>uint8_t</td>
<td class="fieldname">
id</td>
<td class="fielddoc">
Node ID. </td></tr>
<tr><td class="fieldtype">
<a id="ad467954bbc800e180b400efdf7ba97c3"></a><a class="el" href="pool_8h.html#a63674e9f90d86b0dd6d290f3b90723e5">fr_pool_state_t</a> const *</td>
<td class="fieldname">
pool_state</td>
<td class="fielddoc">
Connection pool stats. </td></tr>
</table>

</div>
</div>
<a name="structfr__redis__cluster" id="structfr__redis__cluster"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structfr__redis__cluster">&#9670;&nbsp;</a></span>fr_redis_cluster</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct fr_redis_cluster</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>A redis cluster. </p>
<p>Holds all the structures and collections of nodes, to represent a Redis cluster. </p>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00238">238</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
</div><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Collaboration diagram for fr_redis_cluster:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="structfr__redis__cluster__coll__graph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="a69f8860bd9b335cac42194719d88dcd3"></a><a class="el" href="redis_2base_8h.html#structfr__redis__conf__t">fr_redis_conf_t</a> *</td>
<td class="fieldname">
conf</td>
<td class="fielddoc">
Base configuration data such as the database number and passwords. </td></tr>
<tr><td class="fieldtype">
<a id="ae78a65c94a5fbc000b737bd702abe7b1"></a><a class="el" href="fifo_8h.html#a6f80b6c73f33bb497fb50bfc8392875f">fr_fifo_t</a> *</td>
<td class="fieldname">
free_nodes</td>
<td class="fielddoc">
Queue of free nodes (or nodes waiting to be reused). </td></tr>
<tr><td class="fieldtype">
<a id="a5c9f9ff25b39dcc1239316f93f37b741"></a><a class="el" href="cluster_8h.html#a7daa2ec0fc27ec191190b81e5011a8f0">fr_redis_cluster_key_slot_t</a></td>
<td class="fieldname">
key_slot[<a class="el" href="cluster_8c.html#a5e80ab62f62c981f7c0d8bef06f7fda1">KEY_SLOTS</a>]</td>
<td class="fielddoc">
Lookup table of slots to pools. </td></tr>
<tr><td class="fieldtype">
<a id="a57180c5d19dd374014d3ddc195a8580c"></a><a class="el" href="cluster_8h.html#a7daa2ec0fc27ec191190b81e5011a8f0">fr_redis_cluster_key_slot_t</a></td>
<td class="fieldname">
key_slot_pending[<a class="el" href="cluster_8c.html#a5e80ab62f62c981f7c0d8bef06f7fda1">KEY_SLOTS</a>]</td>
<td class="fielddoc">
Pending key slot table. </td></tr>
<tr><td class="fieldtype">
<a id="ae0bf3f854f4820188922edd0d87b4369"></a>time_t</td>
<td class="fieldname">
last_updated</td>
<td class="fielddoc">
Last time the cluster mappings were updated. </td></tr>
<tr><td class="fieldtype">
<a id="a0f2837a068f0ab07e6b9665b702bc674"></a>char const  *</td>
<td class="fieldname">
log_prefix</td>
<td class="fielddoc">
What to prepend to log messages. </td></tr>
<tr><td class="fieldtype">
<a id="a9e14aec994090bdd2017f286bb54e20e"></a><a class="el" href="cf__util_8h.html#a0f39d8043920472ea4c687c97f7173b3">CONF_SECTION</a> *</td>
<td class="fieldname">
module</td>
<td class="fielddoc">
Module configuration. </td></tr>
<tr><td class="fieldtype">
<a id="af3845d2b3a25c40bc7e0a212f91566a4"></a>pthread_mutex_t</td>
<td class="fieldname">
mutex</td>
<td class="fielddoc">
Mutex to synchronise cluster operations. </td></tr>
<tr><td class="fieldtype">
<a id="af484f6e7009b3d77d551a43233e6a8f2"></a><a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> *</td>
<td class="fieldname">
node</td>
<td class="fielddoc">
Structure containing a node id, its address and a pool of its connections. </td></tr>
<tr><td class="fieldtype">
<a id="a7975a3a65c3f11fa2ac6ae3235d93573"></a>bool</td>
<td class="fieldname">
remap_needed</td>
<td class="fielddoc">
Set true if at least one cluster node is definitely unreachable. <p>Set false on successful remap. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a00af5845cfd53165b7a03ac206c4b15c"></a>bool</td>
<td class="fieldname">
remapping</td>
<td class="fielddoc">
True when cluster is being remapped. </td></tr>
<tr><td class="fieldtype">
<a id="a1d2ceeff8c94b293f3eb3870e7ce077b"></a><a class="el" href="util_2pair_8h.html#a9ab81fd13d950dc8af802107f161d222">fr_pair_t</a> *</td>
<td class="fieldname">
trigger_args</td>
<td class="fielddoc">
Arguments to pass to triggers. </td></tr>
<tr><td class="fieldtype">
<a id="a675bd07577288e89e3f21e373d472331"></a>char const  *</td>
<td class="fieldname">
trigger_prefix</td>
<td class="fielddoc">
Trigger path. </td></tr>
<tr><td class="fieldtype">
<a id="abea388c7916696629e58d60d6aaf8dc0"></a>bool</td>
<td class="fieldname">
triggers_enabled</td>
<td class="fielddoc">
Whether triggers are enabled. </td></tr>
<tr><td class="fieldtype">
<a id="aa4f6aa2e2c8e2880b0c94e3defcc40cb"></a><a class="el" href="rbtree_8h.html#a8cd95efc535063a7e3189c83294d9056">rbtree_t</a> *</td>
<td class="fieldname">
used_nodes</td>
<td class="fielddoc">
Tree of used nodes. </td></tr>
</table>

</div>
</div>
<a name="structfr__redis__cluster__key__slot__s" id="structfr__redis__cluster__key__slot__s"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structfr__redis__cluster__key__slot__s">&#9670;&nbsp;</a></span>fr_redis_cluster_key_slot_s</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct fr_redis_cluster_key_slot_s</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Indexes in the fr_redis_cluster_node_t array for a single key slot. </p>
<p>When dealing with 16K entries, space is a concern. It's significantly more memory efficient to use 8bit indexes than 64bit pointers for each of the key slot to node mappings. </p>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00228">228</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="a9a6e85468c0ec8c7f3e99115fa9ca5ae"></a>uint8_t</td>
<td class="fieldname">
master</td>
<td class="fielddoc">
R/W node (master) for this key slot. </td></tr>
<tr><td class="fieldtype">
<a id="a91509ea9f4d1d7b3303473b90ecdc26e"></a>uint8_t</td>
<td class="fieldname">
slave[<a class="el" href="cluster_8c.html#a2a3c5190bdbe2a4780a460383970aa92">MAX_SLAVES</a>]</td>
<td class="fielddoc">
R/O node (slave) for this key slot. </td></tr>
<tr><td class="fieldtype">
<a id="af47ced0174b3d3df5db62fabaf925a49"></a>uint8_t</td>
<td class="fieldname">
slave_num</td>
<td class="fielddoc">
Number of slaves associated with this key slot. </td></tr>
</table>

</div>
</div>
<a name="structfr__redis__cluster__node__s" id="structfr__redis__cluster__node__s"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structfr__redis__cluster__node__s">&#9670;&nbsp;</a></span>fr_redis_cluster_node_s</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct fr_redis_cluster_node_s</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>A Redis cluster node. </p>
<p>Passed as opaque data to pools which open connection to nodes. </p>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00202">202</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
</div><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Collaboration diagram for fr_redis_cluster_node_s:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="structfr__redis__cluster__node__s__coll__graph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="adbc01ddcae0786e2c04e1bd439aecbfd"></a><a class="el" href="util_2socket_8h.html#structfr__socket__t">fr_socket_t</a></td>
<td class="fieldname">
addr</td>
<td class="fielddoc">
Current node address. </td></tr>
<tr><td class="fieldtype">
<a id="a63ebb8e0ea2527ddcbb5ce735dcecfe4"></a><a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *</td>
<td class="fieldname">
cluster</td>
<td class="fielddoc">
Commmon configuration (database number, password, etc..). </td></tr>
<tr><td class="fieldtype">
<a id="ab47673011e70da6d272c8c29ec517fe7"></a>uint8_t</td>
<td class="fieldname">
id</td>
<td class="fielddoc">
Node ID (index in node array). </td></tr>
<tr><td class="fieldtype">
<a id="a1f345c0d704131985175fc962552072b"></a>bool</td>
<td class="fieldname">
is_active</td>
<td class="fielddoc">
Whether this node is in the active node set. </td></tr>
<tr><td class="fieldtype">
<a id="ae462fcfe2094a3a63c2e9b76bb143f8c"></a>bool</td>
<td class="fieldname">
is_master</td>
<td class="fielddoc">
Whether this node is a master. <p>This is needed for commands like 'KEYS', which we need to issue to every master in the cluster. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a122759589ccb14268d2bb0c917228b2f"></a>char</td>
<td class="fieldname">
name[INET6_ADDRSTRLEN]</td>
<td class="fielddoc">
Buffer to hold IP string. <p>text for debug messages. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a891fa2afc2a979f06c89c2048e2fc1ad"></a><a class="el" href="util_2socket_8h.html#structfr__socket__t">fr_socket_t</a></td>
<td class="fieldname">
pending_addr</td>
<td class="fielddoc">
New node address to be applied when the pool is reconnected. </td></tr>
<tr><td class="fieldtype">
<a id="a110f65913026da99c87d4334118fb72e"></a><a class="el" href="pool_8h.html#aba3234b79613f1a29d858b2b87ef8e38">fr_pool_t</a> *</td>
<td class="fieldname">
pool</td>
<td class="fielddoc">
Pool associated with this node. </td></tr>
<tr><td class="fieldtype">
<a id="afc7f8bdec3f4c7f971d1a7e07e85889f"></a><a class="el" href="cf__util_8h.html#a0f39d8043920472ea4c687c97f7173b3">CONF_SECTION</a> *</td>
<td class="fieldname">
pool_cs</td>
<td class="fielddoc">
Pool configuration section associated with node. </td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a499f02134e8db6561098379b98e39aec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a499f02134e8db6561098379b98e39aec">&#9670;&nbsp;</a></span>CLOSED_PERIOD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a> CLOSED_PERIOD&#160;&#160;&#160;10000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>How recently must the closed have. </p>
<p>occurred for us to care. </p>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00168">168</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>

</div>
</div>
<a id="a1fef6f34098c2c35620d95b87051db15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fef6f34098c2c35620d95b87051db15">&#9670;&nbsp;</a></span>CLOSED_WEIGHT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a> CLOSED_WEIGHT&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>What weight to give to nodes that. </p>
<p>had a connection closed recently. </p>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00171">171</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>

</div>
</div>
<a id="ae582e68a84a2fe181402bccea7bd9642"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae582e68a84a2fe181402bccea7bd9642">&#9670;&nbsp;</a></span>FAILED_PERIOD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a> FAILED_PERIOD&#160;&#160;&#160;10000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>How recently must the spawn failure. </p>
<p>occurred for us to care. </p>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00174">174</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>

</div>
</div>
<a id="a99beff4acf01c0e434e0e7cd6e802d2a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99beff4acf01c0e434e0e7cd6e802d2a">&#9670;&nbsp;</a></span>FAILED_WEIGHT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a> FAILED_WEIGHT&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>What weight to give to nodes that. </p>
<p>had a spawn failure recently. </p>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00177">177</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>

</div>
</div>
<a id="a5e80ab62f62c981f7c0d8bef06f7fda1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e80ab62f62c981f7c0d8bef06f7fda1">&#9670;&nbsp;</a></span>KEY_SLOTS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a> KEY_SLOTS&#160;&#160;&#160;16384</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maximum number of keyslots (should not change). </p>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00160">160</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>

</div>
</div>
<a id="a2a3c5190bdbe2a4780a460383970aa92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a3c5190bdbe2a4780a460383970aa92">&#9670;&nbsp;</a></span>MAX_SLAVES</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a> MAX_SLAVES&#160;&#160;&#160;5</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maximum number of slaves associated. </p>
<p>with a keyslot. </p>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00162">162</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>

</div>
</div>
<a id="ab24f7ec000923e6905d2784e4f2d7ec8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab24f7ec000923e6905d2784e4f2d7ec8">&#9670;&nbsp;</a></span>RELEASED_MIN_WEIGHT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a> RELEASED_MIN_WEIGHT&#160;&#160;&#160;1000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Minimum weight to assign to node. </p>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00184">184</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>

</div>
</div>
<a id="aea82648a9b32b96cdfe54b7d8af99ad1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea82648a9b32b96cdfe54b7d8af99ad1">&#9670;&nbsp;</a></span>RELEASED_PERIOD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a> RELEASED_PERIOD&#160;&#160;&#160;10000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Period after which we don't care. </p>
<p>about when the last connection was released. </p>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00180">180</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>

</div>
</div>
<a id="a140def72dc1a62af24e8491b633cd7fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a140def72dc1a62af24e8491b633cd7fa">&#9670;&nbsp;</a></span>SET_ACTIVE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a> SET_ACTIVE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_node</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> { \</div><div class="line">        (_node)-&gt;is_active = <span class="keyword">true</span>; \</div><div class="line">        rbtree_insert(cluster-&gt;used_nodes, _node); \</div><div class="line">        fr_fifo_pop(cluster-&gt;free_nodes); \</div><div class="line">        active[(_node)-&gt;<span class="keywordtype">id</span>] = <span class="keyword">true</span>; \</div><div class="line">        rollback[r++] = (_node)-&gt;<span class="keywordtype">id</span>; \</div><div class="line">} <span class="keywordflow">while</span> (0)</div></div><!-- fragment -->
</div>
</div>
<a id="a39b4c8703a6d4c5985e30a284bcae1bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39b4c8703a6d4c5985e30a284bcae1bc">&#9670;&nbsp;</a></span>SET_ADDR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a> SET_ADDR</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_addr, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_map&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> { \</div><div class="line">        int _ret; \</div><div class="line">        _ret = <a class="code" href="inet_8c.html#a692de3948a6ce6349acb797b86a3fb29">fr_inet_pton</a>(&amp;_addr.inet.dst_ipaddr, _map-&gt;element[0]-&gt;str, _map-&gt;element[0]-&gt;len, AF_UNSPEC, <span class="keyword">false</span>, <span class="keyword">true</span>);\</div><div class="line">        fr_assert(_ret == 0);\</div><div class="line">        _addr.inet.dst_port = _map-&gt;element[1]-&gt;integer; \</div><div class="line">} <span class="keywordflow">while</span> (0)</div><div class="ttc" id="inet_8c_html_a692de3948a6ce6349acb797b86a3fb29"><div class="ttname"><a href="inet_8c.html#a692de3948a6ce6349acb797b86a3fb29">fr_inet_pton</a></div><div class="ttdeci">int fr_inet_pton(fr_ipaddr_t *out, char const *value, ssize_t inlen, int af, bool resolve, bool mask)</div><div class="ttdoc">Simple wrapper to decide whether an IP value is v4 or v6 and call the appropriate parser...</div><div class="ttdef"><b>Definition:</b> <a href="inet_8c_source.html#l00724">inet.c:724</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7e112e3fac086d7b1d3abf4d20bc50ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e112e3fac086d7b1d3abf4d20bc50ba">&#9670;&nbsp;</a></span>SET_INACTIVE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#<a class="el" href="build_8h.html#a0ec3f1f76900803ac4f041eb90b84a34">define</a> SET_INACTIVE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_node</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> { \</div><div class="line">        (_node)-&gt;is_active = <span class="keyword">false</span>; \</div><div class="line">        (_node)-&gt;is_master = <span class="keyword">false</span>; \</div><div class="line">        rbtree_deletebydata(cluster-&gt;used_nodes, _node); \</div><div class="line">        fr_fifo_push(cluster-&gt;free_nodes, _node); \</div><div class="line">} <span class="keywordflow">while</span> (0)</div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ad42c4142ea660edb9c9c59919db42c3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad42c4142ea660edb9c9c59919db42c3c">&#9670;&nbsp;</a></span>_cluster_conn_free()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int _cluster_conn_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Callback for freeing a Redis connection. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">conn</td><td>to free. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0. </dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l01446">1446</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_ad42c4142ea660edb9c9c59919db42c3c_icgraph.svg" width="100%" height="483"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a0d10baf4738fb89915995b74f91c4657"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d10baf4738fb89915995b74f91c4657">&#9670;&nbsp;</a></span>_cluster_node_cmp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int _cluster_node_cmp </td>
          <td>(</td>
          <td class="paramtype">void const *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void const *&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compare two redis nodes to check equality. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">a</td><td>first node. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">b</td><td>second node. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 if nodes are equal.</li>
<li>+1 if nodes are unequal.</li>
<li>-1 if nodes are unequal. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00310">310</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="cluster_8c_a0d10baf4738fb89915995b74f91c4657_cgraph.svg" width="298" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="cluster_8c_a0d10baf4738fb89915995b74f91c4657_icgraph.svg" width="600" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a8e311d208f7ff97416b2b4d4f172e859"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e311d208f7ff97416b2b4d4f172e859">&#9670;&nbsp;</a></span>_cluster_node_conf_apply()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void _cluster_node_conf_apply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pool_8h.html#aba3234b79613f1a29d858b2b87ef8e38">fr_pool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>opaque</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reconnect callback to apply new pool config. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pool</td><td>to apply new configuration to. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">opaque</td><td>data passed to the connection pool. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00326">326</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a8e311d208f7ff97416b2b4d4f172e859_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a8e311d208f7ff97416b2b4d4f172e859_icgraph.svg" width="100%" height="556"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a24277898be92e15d2a83609333f0ba8b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24277898be92e15d2a83609333f0ba8b">&#9670;&nbsp;</a></span>_cluster_pool_walk()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int _cluster_pool_walk </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>uctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Walk all used pools adding them to the live node list. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">uctx</td><td>Where to write the node we found. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>node to check. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 continue walking.</li>
<li>-1 found suitable node. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l01182">1182</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="cluster_8c_a24277898be92e15d2a83609333f0ba8b_cgraph.svg" width="290" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a24277898be92e15d2a83609333f0ba8b_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="adc7986d095a8628f07ec1898e09c15dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc7986d095a8628f07ec1898e09c15dc">&#9670;&nbsp;</a></span>_cluster_role_walk()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int _cluster_role_walk </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>uctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Walk all used pools, recording the IP addresses of ones matching the filter. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">uctx</td><td>Where to write the node we found. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>node to check. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 continue walking.</li>
<li>-1 found suitable node. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l02097">2097</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-11" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="cluster_8c_adc7986d095a8628f07ec1898e09c15dc_icgraph.svg" width="600" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a6f95874edd88b0727e16ba84243a63f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f95874edd88b0727e16ba84243a63f6">&#9670;&nbsp;</a></span>_cluster_version_walk()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int _cluster_version_walk </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>uctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Walk all used pools checking their versions. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">uctx</td><td>Where to write the node we found. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>node to check. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 continue walking.</li>
<li>-1 found suitable node. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l02176">2176</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-12" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a6f95874edd88b0727e16ba84243a63f6_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-13" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="cluster_8c_a6f95874edd88b0727e16ba84243a63f6_icgraph.svg" width="511" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a98955e703d5c04fe6aae3f256e8a9e97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98955e703d5c04fe6aae3f256e8a9e97">&#9670;&nbsp;</a></span>_fr_redis_cluster_free()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int _fr_redis_cluster_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *&#160;</td>
          <td class="paramname"><em>cluster</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destroy mutex associated with cluster slots structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cluster</td><td>being freed. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l02161">2161</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-14" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="cluster_8c_a98955e703d5c04fe6aae3f256e8a9e97_icgraph.svg" width="612" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a3c0d451a4e820f097ddcda88d8613aac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c0d451a4e820f097ddcda88d8613aac">&#9670;&nbsp;</a></span>cluster_key_hash()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint16_t cluster_key_hash </td>
          <td>(</td>
          <td class="paramtype">uint8_t const *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>key_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Resolve key to key slot. </p>
<p>Identical to the example implementation, except it uses memchr which will be faster, and isn't so needlessly complex.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">key</td><td>to resolve. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">key_len</td><td>length of key. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>key slot index for the key. </dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00283">283</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-15" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-15-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-15-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-15-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="cluster_8c_a3c0d451a4e820f097ddcda88d8613aac_cgraph.svg" width="310" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-16" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-16-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-16-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-16-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a3c0d451a4e820f097ddcda88d8613aac_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ab434868c42486ab9876b2043c26439f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab434868c42486ab9876b2043c26439f2">&#9670;&nbsp;</a></span>cluster_map_apply()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eb">fr_redis_cluster_rcode_t</a> cluster_map_apply </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">redisReply *&#160;</td>
          <td class="paramname"><em>reply</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Apply a cluster map received from a cluster node. </p>
<dl class="section note"><dt>Note</dt><dd>Errors may be retrieved with <a class="el" href="strerror_8c.html#a83ee876ee41b1ae672dc4dcda4f02a2e" title="Get the last library error. ">fr_strerror()</a>. </dd>
<dd>
Must be called with the cluster mutex held.</dd></dl>
<p>Key slot range structure </p><pre class="fragment">  [0] -&gt; key slot range 0
      [0] -&gt; key_slot_start
      [1] -&gt; key_slot_end
      [2] -&gt; master_node
          [0] -&gt; master 0 ip (string)
          [1] -&gt; master 0 port (number)
      [3..n] -&gt; slave_node(s)
  [1] -&gt; key slot range 1)
      [0]  -&gt; key_slot_start
      [1] -&gt; key_slot_end
      [2] -&gt; master_node
          [0] -&gt; master 1 ip (string)
          [1] -&gt; master 1 port (number)
      [3..n] -&gt; slave_node(s)
  [n] -&gt; key slot range n
      [0] -&gt; key_slot_start
      [1] -&gt; key_slot_end
      [2] -&gt; master_node
          [0] -&gt; master n ip (string)
          [1] -&gt; master n port (number)
      [3..n] -&gt; slave_node(s)
</pre><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cluster</td><td>to apply map to. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">reply</td><td>from <a class="el" href="cluster_8c.html#a010b9b97335d882b7becb494a6c9b0cc" title="Learn a new cluster layout by querying the node that issued the -MOVE. ">cluster_map_get</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>FR_REDIS_CLUSTER_RCODE_SUCCESS on success.</li>
<li>FR_REDIS_CLUSTER_RCODE_FAILED on failure.</li>
<li>FR_REDIS_CLUSTER_RCODE_NO_CONNECTION connection failure.</li>
<li>FR_REDIS_CLUSTER_RCODE_BAD_INPUT if the map didn't provide nodes for all keyslots. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00522">522</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-17" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-17-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-17-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-17-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_ab434868c42486ab9876b2043c26439f2_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-18" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-18-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-18-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-18-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_ab434868c42486ab9876b2043c26439f2_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a010b9b97335d882b7becb494a6c9b0cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a010b9b97335d882b7becb494a6c9b0cc">&#9670;&nbsp;</a></span>cluster_map_get()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eb">fr_redis_cluster_rcode_t</a> cluster_map_get </td>
          <td>(</td>
          <td class="paramtype">redisReply **&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Learn a new cluster layout by querying the node that issued the -MOVE. </p>
<p>Also validates the response from the Redis cluster, so we can be sure that it's well formed, before doing more expensive operations.</p>
<dl class="section note"><dt>Note</dt><dd>Errors may be retrieved with <a class="el" href="strerror_8c.html#a83ee876ee41b1ae672dc4dcda4f02a2e" title="Get the last library error. ">fr_strerror()</a>.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">out</td><td>Where to write cluster map. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">conn</td><td>to use for learning the new cluster map. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>FR_REDIS_CLUSTER_RCODE_IGNORED if 'cluster slots' returned an error (indicating clustering not supported).</li>
<li>FR_REDIS_CLUSTER_RCODE_SUCCESS on success.</li>
<li>FR_REDIS_CLUSTER_RCODE_FAILED if issuing the command resulted in an error.</li>
<li>FR_REDIS_CLUSTER_RCODE_NO_CONNECTION connection failure.</li>
<li>FR_REDIS_CLUSTER_RCODE_BAD_INPUT on validation failure (bad data returned from Redis). </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00848">848</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-19" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-19-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-19-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-19-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a010b9b97335d882b7becb494a6c9b0cc_cgraph.svg" width="100%" height="560"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-20" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-20-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-20-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-20-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a010b9b97335d882b7becb494a6c9b0cc_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a3138560083c65262afc5b8a682195a23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3138560083c65262afc5b8a682195a23">&#9670;&nbsp;</a></span>cluster_map_node_validate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int cluster_map_node_validate </td>
          <td>(</td>
          <td class="paramtype">redisReply *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>map_idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>node_idx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Validate a cluster map node entry. </p>
<dl class="section note"><dt>Note</dt><dd>Errors may be retrieved with <a class="el" href="strerror_8c.html#a83ee876ee41b1ae672dc4dcda4f02a2e" title="Get the last library error. ">fr_strerror()</a>. </dd>
<dd>
In a separate function, as it's called for both master and slave nodes.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">node</td><td>we're validating. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">map_idx</td><td>we're processing. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">node_idx</td><td>we're processing. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>FR_REDIS_CLUSTER_RCODE_SUCCESS on success.</li>
<li>FR_REDIS_CLUSTER_RCODE_BAD_INPUT on validation failure (bad data returned from Redis). </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00770">770</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-21" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-21-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-21-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-21-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a3138560083c65262afc5b8a682195a23_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-22" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-22-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-22-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-22-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a3138560083c65262afc5b8a682195a23_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a41047732e0ed1cb4b556eee169110e76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41047732e0ed1cb4b556eee169110e76">&#9670;&nbsp;</a></span>cluster_node_conf_from_redirect()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eb">fr_redis_cluster_rcode_t</a> cluster_node_conf_from_redirect </td>
          <td>(</td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>key_slot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="util_2socket_8h.html#structfr__socket__t">fr_socket_t</a> *&#160;</td>
          <td class="paramname"><em>node_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">redisReply *&#160;</td>
          <td class="paramname"><em>redirect</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse a -MOVED or -ASK redirect. </p>
<p>Converts the body of the -MOVED or -ASK error into an IPv4/6 address and port.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">key_slot</td><td>value extracted from redirect string (may be NULL). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">node_addr</td><td>Redis node ipaddr and port extracted from redirect string. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">redirect</td><td>to process. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>FR_REDIS_CLUSTER_RCODE_SUCCESS on success.</li>
<li>FR_REDIS_CLUSTER_RCODE_BAD_INPUT if the server returned an invalid redirect. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00431">431</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-23" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-23-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-23-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-23-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a41047732e0ed1cb4b556eee169110e76_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-24" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-24-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-24-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-24-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a41047732e0ed1cb4b556eee169110e76_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a2c73b18c41ba2a09719df3a9b7d66c2e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c73b18c41ba2a09719df3a9b7d66c2e">&#9670;&nbsp;</a></span>cluster_node_connect()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eb">fr_redis_cluster_rcode_t</a> cluster_node_connect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> *&#160;</td>
          <td class="paramname"><em>node</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Establish a connection to a cluster node. </p>
<dl class="section note"><dt>Note</dt><dd>Must be called with the cluster mutex locked. </dd>
<dd>
Configuration to use for the connection must be set in node-&gt;pending_addr, not node-&gt;cluster-&gt;conf.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cluster</td><td>to search in. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">node</td><td>config. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>FR_REDIS_CLUSTER_RCODE_SUCCESS on success.</li>
<li>FR_REDIS_CLUSTER_RCODE_FAILED if the operation failed. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00357">357</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-25" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-25-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-25-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-25-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a2c73b18c41ba2a09719df3a9b7d66c2e_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-26" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-26-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-26-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-26-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a2c73b18c41ba2a09719df3a9b7d66c2e_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a41749370374d5c9bb23aebced0817386"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41749370374d5c9bb23aebced0817386">&#9670;&nbsp;</a></span>cluster_node_find_live()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int cluster_node_find_live </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> **&#160;</td>
          <td class="paramname"><em>live_node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> **&#160;</td>
          <td class="paramname"><em>live_conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> *&#160;</td>
          <td class="paramname"><em>skip</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Attempt to find a live pool in the cluster. </p>
<p>The intent here is to find pools/nodes where a connection was released the shortest time ago. Having a connection be released (vs closed) indicates that the pool is live.</p>
<p>We don't want to have all workers try and grab a connection to this node however, as it may still be dead (we don't know).</p>
<p>So we use an inverse transform sample, to weight the nodes, based on time between now and when the connection was released. Connections released closest to the current time are given a higher weighting.</p>
<p>Weight range is between 1 - 11,000.</p>
<ul>
<li>If released &gt; 10.0 seconds ago,information is not valid, weight 500.</li>
<li>If closed &lt; 10.0 seconds ago, it's a bad pool, weight 1.</li>
<li>If spawn failed &lt; 10.0 seconds ago, it's a bad pool, weight 1.</li>
<li>If a connection was released 0.0 seconds ago, weight 11,000.</li>
<li>If a connection was released 10.0 seconds ago, weight 1000.</li>
</ul>
<p>Using the above algorithm we use the experience of other workers using the cluster to inform our alternative node selection.</p>
<p>Suggestions on improving live node selection appreciated.</p>
<p>Inverse transform sampling based roughly on the solution from this post: <a href="http://stackoverflow.com/questions/17250568/randomly-choosing-from-a-list-with-weighted-probabilities">http://stackoverflow.com/questions/17250568/randomly-choosing-from-a-list-with-weighted-probabilities</a></p>
<p>Wikipedia page here: <a href="https://en.wikipedia.org/wiki/Inverse_transform_sampling">https://en.wikipedia.org/wiki/Inverse_transform_sampling</a></p>
<dl class="section note"><dt>Note</dt><dd>Must be called with the cluster mutex free.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">live_node</td><td>we found. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">live_conn</td><td>to that node. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>The current request (used for logging). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cluster</td><td>to search for live pools in. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">skip</td><td>this node (it's bad). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 (iterates over the whole tree). </dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l01314">1314</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-27" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-27-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-27-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-27-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a41749370374d5c9bb23aebced0817386_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-28" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-28-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-28-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-28-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a41749370374d5c9bb23aebced0817386_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="aa2e3907f33250de6cc7e66adad0f4377"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2e3907f33250de6cc7e66adad0f4377">&#9670;&nbsp;</a></span>cluster_node_ping()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eb">fr_redis_cluster_rcode_t</a> cluster_node_ping </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Issue a ping request against a cluster node. </p>
<p>Establishes whether the connection to the node we have is live.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">request</td><td>The current request. </td></tr>
    <tr><td class="paramname">node</td><td>to ping. </td></tr>
    <tr><td class="paramname">conn</td><td>the connection to ping on. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>FR_REDIS_CLUSTER_RCODE_BAD_INPUT if we got a bad response.</li>
<li>FR_REDIS_CLUSTER_RCODE_SUCCESS on success.</li>
<li>FR_REDIS_CLUSTER_RCODE_NO_CONNECTION on connection down. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l01247">1247</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-29" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-29-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-29-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-29-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_aa2e3907f33250de6cc7e66adad0f4377_cgraph.svg" width="100%" height="560"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-30" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-30-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-30-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-30-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_aa2e3907f33250de6cc7e66adad0f4377_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="aa0b0090317c51ebde20847dd293c2db4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0b0090317c51ebde20847dd293c2db4">&#9670;&nbsp;</a></span>cluster_node_pool_health()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int cluster_node_pool_health </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="time_8h.html#ae3bbe82b46d7b09dbfc1caa6765ddbde">fr_time_t</a>&#160;</td>
          <td class="paramname"><em>now</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pool_8h.html#a63674e9f90d86b0dd6d290f3b90723e5">fr_pool_state_t</a> const *&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Try to determine the health of a cluster node passively by examining its pool state. </p>
<p>Returns an integer value representing the likelihood that the pool is live. Range is between 1 and 11,000.</p>
<p>If a weight of 1 is returned, connections from the pool should be checked (by pinging) before use.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">now</td><td>The current time. </td></tr>
    <tr><td class="paramname">state</td><td>of the connection pool. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>1 the pool is very likely to be bad.</li>
<li>2-11000 the pool is likely to be good, with a higher number indicating higher probability of liveness. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l01212">1212</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-31" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-31-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-31-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-31-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="cluster_8c_aa0b0090317c51ebde20847dd293c2db4_cgraph.svg" width="383" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-32" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-32-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-32-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-32-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_aa0b0090317c51ebde20847dd293c2db4_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a4030e10e7438e81a42623a42beb18e42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4030e10e7438e81a42623a42beb18e42">&#9670;&nbsp;</a></span>cluster_redirect()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eb">fr_redis_cluster_rcode_t</a> cluster_redirect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> **&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">redisReply *&#160;</td>
          <td class="paramname"><em>reply</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieve or associate a node with the server indicated in the redirect. </p>
<dl class="section note"><dt>Note</dt><dd>Errors may be retrieved with <a class="el" href="strerror_8c.html#a83ee876ee41b1ae672dc4dcda4f02a2e" title="Get the last library error. ">fr_strerror()</a>.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">out</td><td>Where to write the node representing the redirect server. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cluster</td><td>to draw node from. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">reply</td><td>Redis reply containing the redirect information. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>FR_REDIS_CLUSTER_RCODE_SUCCESS on success.</li>
<li>FR_REDIS_CLUSTER_RCODE_FAILED no more nodes available.</li>
<li>FR_REDIS_CLUSTER_RCODE_NO_CONNECTION connection failure.</li>
<li>FR_REDIS_CLUSTER_RCODE_BAD_INPUT on validation failure (bad data returned from Redis). </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l01100">1100</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-33" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-33-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-33-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-33-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a4030e10e7438e81a42623a42beb18e42_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-34" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-34-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-34-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-34-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a4030e10e7438e81a42623a42beb18e42_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a4cfe9143eeda529e5a7f2a2e9920e1a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4cfe9143eeda529e5a7f2a2e9920e1a2">&#9670;&nbsp;</a></span>fr_redis_cluster_alloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a>* fr_redis_cluster_alloc </td>
          <td>(</td>
          <td class="paramtype">TALLOC_CTX *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cf__util_8h.html#a0f39d8043920472ea4c687c97f7173b3">CONF_SECTION</a> *&#160;</td>
          <td class="paramname"><em>module</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="redis_2base_8h.html#structfr__redis__conf__t">fr_redis_conf_t</a> *&#160;</td>
          <td class="paramname"><em>conf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>triggers_enabled</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char const *&#160;</td>
          <td class="paramname"><em>log_prefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char const *&#160;</td>
          <td class="paramname"><em>trigger_prefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="util_2pair_8h.html#a9ab81fd13d950dc8af802107f161d222">fr_pair_t</a> *&#160;</td>
          <td class="paramname"><em>trigger_args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate and initialise a new cluster structure. </p>
<p>This holds all the data necessary to manage a pool of pools for a specific redis cluster.</p>
<dl class="section note"><dt>Note</dt><dd>Will not error out unless cs.pool.start &gt; 0. This is consistent with other pool based modules/code.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>to link the lifetime of the cluster structure to. </td></tr>
    <tr><td class="paramname">module</td><td>Configuration section to search for 'server' conf pairs in. </td></tr>
    <tr><td class="paramname">conf</td><td>Base redis server configuration. Cluster nodes share database number and password. </td></tr>
    <tr><td class="paramname">triggers_enabled</td><td>Whether triggers should be enabled. </td></tr>
    <tr><td class="paramname">log_prefix</td><td>Custom log prefix. Defaults to<pre class="fragment">rlm_&lt;module&gt; (&lt;instance&gt;) </pre>. </td></tr>
    <tr><td class="paramname">trigger_prefix</td><td>Custom trigger prefix. Defaults to<pre class="fragment">modules.&lt;module&gt;.pool </pre>. </td></tr>
    <tr><td class="paramname">trigger_args</td><td>Argument pairs to pass to the trigger in addition to Connection-Pool-Server, and Connection-Pool-Port (which are always set by the cluster code). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>New <a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> on success.</li>
<li>NULL on error. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l02249">2249</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-35" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-35-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-35-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-35-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a4cfe9143eeda529e5a7f2a2e9920e1a2_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-36" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-36-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-36-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-36-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="cluster_8c_a4cfe9143eeda529e5a7f2a2e9920e1a2_icgraph.svg" width="418" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a9e404a7e34498f81c83423409b7b8431"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e404a7e34498f81c83423409b7b8431">&#9670;&nbsp;</a></span>fr_redis_cluster_conn_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* fr_redis_cluster_conn_create </td>
          <td>(</td>
          <td class="paramtype">TALLOC_CTX *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>instance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="time_8h.html#a107fc1fa0fdf50e580c17fe543d2eeb5">fr_time_delta_t</a>&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a new connection to a Redis node. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>to allocate connection structure in. Will be freed at the same time as the pool. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instance</td><td>data of type <a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a>. Holds parameters for establishing new connection. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">timeout</td><td>The maximum time allowed to complete the connection. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>New <a class="el" href="redis_2base_8h.html#structfr__redis__conn__t" title="Connection handle, holding a redis context. ">fr_redis_conn_t</a> on success.</li>
<li>NULL on failure. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l01462">1462</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-37" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-37-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-37-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-37-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="cluster_8c_a9e404a7e34498f81c83423409b7b8431_cgraph.svg" width="338" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-38" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-38-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-38-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-38-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a9e404a7e34498f81c83423409b7b8431_icgraph.svg" width="100%" height="556"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="aeedf2e38865249fdff93e0a898742b35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeedf2e38865249fdff93e0a898742b35">&#9670;&nbsp;</a></span>fr_redis_cluster_ipaddr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fr_redis_cluster_ipaddr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="inet_8h.html#structfr__ipaddr__t">fr_ipaddr_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> const *&#160;</td>
          <td class="paramname"><em>node</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the ipaddr of a particular node. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">out</td><td>Ipaddr of the node. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">node</td><td>to get ip address from. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 on success.</li>
<li>-1 on failure (node is NULL). </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l01635">1635</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-39" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-39-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-39-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-39-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="cluster_8c_aeedf2e38865249fdff93e0a898742b35_icgraph.svg" width="482" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="acb4c67a77b88e9886d889eb8192b2df7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb4c67a77b88e9886d889eb8192b2df7">&#9670;&nbsp;</a></span>fr_redis_cluster_master()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> const* fr_redis_cluster_master </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#a7daa2ec0fc27ec191190b81e5011a8f0">fr_redis_cluster_key_slot_t</a> const *&#160;</td>
          <td class="paramname"><em>key_slot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the master node that would be used for a particular key. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cluster</td><td>To resolve key in. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">key_slot</td><td>to resolve to node. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>The current master node.</li>
<li>NULL if no master node is currently assigned to a particular key slot. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l01602">1602</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-40" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-40-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-40-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-40-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="cluster_8c_acb4c67a77b88e9886d889eb8192b2df7_icgraph.svg" width="487" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="af8c5c4a9b4dc3226e00bdb9f4fb10b69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8c5c4a9b4dc3226e00bdb9f4fb10b69">&#9670;&nbsp;</a></span>fr_redis_cluster_min_version()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool fr_redis_cluster_min_version </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char const *&#160;</td>
          <td class="paramname"><em>min_version</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if members of the cluster are above a certain version. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cluster</td><td>to perform check on. </td></tr>
    <tr><td class="paramname">min_version</td><td>that must be found on each node for the check to succeed. Must be in the format<pre class="fragment">&lt;major&gt;.&lt;minor&gt;.&lt;release&gt; </pre>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>true if all contactable members are above min_version.</li>
<li>false if at least one member if not above minimum version (use <a class="el" href="strerror_8h.html#a83ee876ee41b1ae672dc4dcda4f02a2e" title="Get the last library error. ">fr_strerror</a> to retrieve node information). </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l02215">2215</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-41" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-41-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-41-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-41-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_af8c5c4a9b4dc3226e00bdb9f4fb10b69_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-42" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-42-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-42-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-42-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="cluster_8c_af8c5c4a9b4dc3226e00bdb9f4fb10b69_icgraph.svg" width="312" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a872442e42a59159dd9af849d8716d290"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a872442e42a59159dd9af849d8716d290">&#9670;&nbsp;</a></span>fr_redis_cluster_node_addr_by_role()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t fr_redis_cluster_node_addr_by_role </td>
          <td>(</td>
          <td class="paramtype">TALLOC_CTX *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="util_2socket_8h.html#structfr__socket__t">fr_socket_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>is_master</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>is_slave</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return an array of IP addresses belonging to masters or slaves. </p>
<dl class="section note"><dt>Note</dt><dd>We return IP addresses as they're safe to use across cluster remaps. </dd>
<dd>
Result array must be freed (talloc_free()) after use.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>to allocate array of IP addresses in. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out</td><td>Where to write the addresses of the nodes. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cluster</td><td>to search for nodes in. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">is_master</td><td>If true, include the addresses of all the master nodes. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">is_slave</td><td>If true, include the addresses of all the slaves nodes. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the number of ip addresses written to out. </dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l02120">2120</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-43" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-43-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-43-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-43-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a872442e42a59159dd9af849d8716d290_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-44" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-44-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-44-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-44-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="cluster_8c_a872442e42a59159dd9af849d8716d290_icgraph.svg" width="422" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a7eb8f6d14fe9d19bc3caae6c17cd3b21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7eb8f6d14fe9d19bc3caae6c17cd3b21">&#9670;&nbsp;</a></span>fr_redis_cluster_pool_by_node_addr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fr_redis_cluster_pool_by_node_addr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pool_8h.html#aba3234b79613f1a29d858b2b87ef8e38">fr_pool_t</a> **&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="util_2socket_8h.html#structfr__socket__t">fr_socket_t</a> *&#160;</td>
          <td class="paramname"><em>node_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>create</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the pool associated with a node in the cluster. </p>
<dl class="section note"><dt>Note</dt><dd>This is used for testing only. It's not ifdef'd out because tests need to run against production builds too.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">pool</td><td>associated with the node. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cluster</td><td>to search for node in. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">node_addr</td><td>to retrieve pool for. Specifies IP and port of node. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">create</td><td>Establish a connection to the specified node if it was previously unknown to the cluster client. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 on success.</li>
<li>-1 if no such node exists. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l02027">2027</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-45" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-45-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-45-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-45-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a7eb8f6d14fe9d19bc3caae6c17cd3b21_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-46" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-46-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-46-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-46-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="cluster_8c_a7eb8f6d14fe9d19bc3caae6c17cd3b21_icgraph.svg" width="479" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a94d038e46a3e83f191ad84151b98c256"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94d038e46a3e83f191ad84151b98c256">&#9670;&nbsp;</a></span>fr_redis_cluster_port()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fr_redis_cluster_port </td>
          <td>(</td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> const *&#160;</td>
          <td class="paramname"><em>node</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the port of a particular node. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">out</td><td>Port of the node. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">node</td><td>to get ip address from. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 on success.</li>
<li>-1 on failure (node is NULL). </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l01652">1652</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-47" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-47-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-47-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-47-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="cluster_8c_a94d038e46a3e83f191ad84151b98c256_icgraph.svg" width="468" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ab17f60095577fae39f1d708d92536594"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab17f60095577fae39f1d708d92536594">&#9670;&nbsp;</a></span>fr_redis_cluster_remap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eb">fr_redis_cluster_rcode_t</a> fr_redis_cluster_remap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> *&#160;</td>
          <td class="paramname"><em>conn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Perform a runtime remap of the cluster. </p>
<dl class="section note"><dt>Note</dt><dd>Errors may be retrieved with <a class="el" href="strerror_8c.html#a83ee876ee41b1ae672dc4dcda4f02a2e" title="Get the last library error. ">fr_strerror()</a>. </dd>
<dd>
Must be called with the cluster mutex free.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>The current request. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cluster</td><td>to remap. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">conn</td><td>to use to query the cluster. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>FR_REDIS_CLUSTER_RCODE_IGNORED if 'cluster slots' returned an error (indicating clustering not supported).</li>
<li>FR_REDIS_CLUSTER_RCODE_SUCCESS on success.</li>
<li>FR_REDIS_CLUSTER_RCODE_FAILED if issuing the 'cluster slots' command resulted in a protocol error.</li>
<li>FR_REDIS_CLUSTER_RCODE_NO_CONNECTION connection failure.</li>
<li>FR_REDIS_CLUSTER_RCODE_BAD_INPUT on validation failure (bad data returned from Redis). </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00993">993</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-48" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-48-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-48-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-48-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_ab17f60095577fae39f1d708d92536594_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-49" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-49-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-49-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-49-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_ab17f60095577fae39f1d708d92536594_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ab8f0983a06fb5e19bf1e34b60f68aada"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8f0983a06fb5e19bf1e34b60f68aada">&#9670;&nbsp;</a></span>fr_redis_cluster_slave()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="cluster_8h.html#afa295141a98a145058945943353354b5">fr_redis_cluster_node_t</a> const* fr_redis_cluster_slave </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#a7daa2ec0fc27ec191190b81e5011a8f0">fr_redis_cluster_key_slot_t</a> const *&#160;</td>
          <td class="paramname"><em>key_slot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>slave_num</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the slave node that would be used for a particular key. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cluster</td><td>To resolve key in. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">key_slot</td><td>To resolve to node. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slave_num</td><td>0..n. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>A slave node.</li>
<li>NULL if no slave node is assigned, or is at the specific key slot. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l01618">1618</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-50" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-50-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-50-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-50-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="cluster_8c_ab8f0983a06fb5e19bf1e34b60f68aada_icgraph.svg" width="478" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a42089316968a1f9599a92ae67dd79ee5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42089316968a1f9599a92ae67dd79ee5">&#9670;&nbsp;</a></span>fr_redis_cluster_slot_by_key()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="cluster_8h.html#a7daa2ec0fc27ec191190b81e5011a8f0">fr_redis_cluster_key_slot_t</a> const* fr_redis_cluster_slot_by_key </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t const *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>key_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Implements the key slot selection scheme used by freeradius. </p>
<p>Like the scheme in the clustering specification but with some differences if the key is NULL or zero length, then a random keyslot is chosen.</p>
<p>If there's only a single node in the cluster, then we avoid the CRC16 and just use key slot 0.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cluster</td><td>to determine key slot for. </td></tr>
    <tr><td class="paramname">request</td><td>The current request. </td></tr>
    <tr><td class="paramname">key</td><td>the key to resolve. </td></tr>
    <tr><td class="paramname">key_len</td><td>the length of the key. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to key slot key resolves to. </dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l01566">1566</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-51" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-51-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-51-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-51-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a42089316968a1f9599a92ae67dd79ee5_cgraph.svg" width="100%" height="479"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-52" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-52-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-52-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-52-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a42089316968a1f9599a92ae67dd79ee5_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ac292207b4d5816986eb8e4457791b491"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac292207b4d5816986eb8e4457791b491">&#9670;&nbsp;</a></span>fr_redis_cluster_state_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feb">fr_redis_rcode_t</a> fr_redis_cluster_state_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#structfr__redis__cluster__state__t">fr_redis_cluster_state_t</a> *&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> **&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t const *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>key_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>read_only</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resolve a key to a pool, and reserve a connection in that pool. </p>
<p>This should be used with <a class="el" href="cluster_8c.html#a02e48068a3e77ab228e414708b5543ee" title="Get the next connection to attempt a command against. ">fr_redis_cluster_state_next</a>, and <a class="el" href="redis_8c.html#a8d50cc44bc2c01ee467592f85fa79c5e" title="Check the reply for errors. ">fr_redis_command_status</a>, to transparently locate the cluster node we need to perform the operation on.</p>
<p>Example code below shows how this function is used in conjunction with <a class="el" href="cluster_8c.html#a02e48068a3e77ab228e414708b5543ee" title="Get the next connection to attempt a command against. ">fr_redis_cluster_state_next</a> to follow redirects, and reconnect handles.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span>                 s_ret;</div><div class="line">redis_conn_state     state;</div><div class="line"><a class="code" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a>      *conn;</div><div class="line">redisReply           *reply;</div><div class="line"><a class="code" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feb">fr_redis_rcode_t</a>     status;</div><div class="line"></div><div class="line"><span class="keywordflow">for</span> (s_ret = <a class="code" href="cluster_8c.html#ac292207b4d5816986eb8e4457791b491">fr_redis_cluster_state_init</a>(&amp;state, &amp;conn, cluster, key, key_len, <span class="keyword">false</span>);</div><div class="line">     s_ret == <a class="code" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387febad1e50fa0ac16f1267e6bf0347dfd392a">REDIS_RCODE_TRY_AGAIN</a>,</div><div class="line">     s_ret = <a class="code" href="cluster_8c.html#a02e48068a3e77ab228e414708b5543ee">fr_redis_cluster_state_next</a>(&amp;state, &amp;conn, cluster, request, status, &amp;reply)) {</div><div class="line">        reply = redisCommand(conn-&gt;<a class="code" href="redis_2base_8h.html#a22e976b79bf62024592d5eb1163b2ce2">handle</a>, <span class="stringliteral">&quot;SET foo bar&quot;</span>);</div><div class="line">        status = <a class="code" href="redis_2base_8h.html#a8d50cc44bc2c01ee467592f85fa79c5e">fr_redis_command_status</a>(conn, reply);</div><div class="line">}</div><div class="line"><span class="comment">// Reply is freed if ret == REDIS_RCODE_TRY_AGAIN, but left in all other cases to allow error</span></div><div class="line"><span class="comment">// processing, or extraction of results.</span></div><div class="line"><a class="code" href="redis_2base_8h.html#a782179a40a4afcd30de56e7f803f9ae6">fr_redis_reply_free</a>(&amp;reply);</div><div class="line"><span class="keywordflow">if</span> (s_ret != <a class="code" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feba2eb70a0603aecb095503701aa390b4e9">REDIS_RCODE_SUCCESS</a>) {</div><div class="line">     <span class="comment">// Error</span></div><div class="line">}</div><div class="line"><span class="comment">// Success</span></div></div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">state</td><td>to track current pool and various counters, will be initialised. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">conn</td><td>Where to write the reserved connection to. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cluster</td><td>of pools. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>The current request. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">key</td><td>to resolve to a cluster node/pool. If no key is NULL or key_len is 0 a random slot will be chosen. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">key_len</td><td>Length of the key. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">read_only</td><td>If true, will use random slave pool in preference to the master, falling back to the master if no slaves are available. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>REDIS_RCODE_TRY_AGAIN - try your command with this connection (provided via command).</li>
<li>REDIS_RCODE_RECONNECT - when no additional connections available. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l01704">1704</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-53" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-53-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-53-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-53-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_ac292207b4d5816986eb8e4457791b491_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-54" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-54-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-54-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-54-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_ac292207b4d5816986eb8e4457791b491_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a02e48068a3e77ab228e414708b5543ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02e48068a3e77ab228e414708b5543ee">&#9670;&nbsp;</a></span>fr_redis_cluster_state_next()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feb">fr_redis_rcode_t</a> fr_redis_cluster_state_next </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#structfr__redis__cluster__state__t">fr_redis_cluster_state_t</a> *&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="redis_2base_8h.html#structfr__redis__conn__t">fr_redis_conn_t</a> **&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cluster_8h.html#ae21a6044c2ba492d3326f6c9e647df7f">fr_redis_cluster_t</a> *&#160;</td>
          <td class="paramname"><em>cluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="radclient_8c.html#a2fc1b64f51f8225195d32592e6fe8fc5">request_t</a> *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feb">fr_redis_rcode_t</a>&#160;</td>
          <td class="paramname"><em>status</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">redisReply **&#160;</td>
          <td class="paramname"><em>reply</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the next connection to attempt a command against. </p>
<p>Will process reconnect and redirect states performing the actions necessary.</p>
<ul>
<li>May trigger a cluster remap on receiving a <a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387febac861b3123c9b1c8d8a8eeb33b6f97f79" title="Attempt operation on an alternative node with remap. ">REDIS_RCODE_MOVE</a> status.</li>
<li>May perform a temporary redirect on receiving a <a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387febaf0c7f93c2a2c912e44d099b1ed3ac291" title="Attempt operation on an alternative node. ">REDIS_RCODE_ASK</a> status.</li>
<li>May reserve a new connection on receiving a <a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387feba06a816f21162d61b65e967649e181584" title="Transitory error, caller should retry the operation with a new connection. ">REDIS_RCODE_RECONNECT</a> status.</li>
</ul>
<p>If a remap is in progress, has ocurred within the last second, has recently failed, or fails, the '-MOVE' will be treated as a temporary redirect (-ASK).</p>
<p>This allows the server to be more responsive during remaps, as unless the worker has been redirected to a node we don't currently have a pool for, it can grab a connection for the node it was redirected to, and continue.</p>
<dl class="section note"><dt>Note</dt><dd>Irrespective of return code, the connection passed via conn will be released, A new connection to attempt command on will be provided via conn.</dd>
<dd>
reply will be automatically freed and set to NULL if a new connection is provided in all other cases, the caller is responsible for freeing the reply.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state</td><td>containing the current pool, and various counters which control retries, and limit redirects. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">conn</td><td>we received the '-ASK' or '-MOVE' redirect on. Will be replaced with a connection in the new pool the key points to. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">request</td><td>The current request. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cluster</td><td>of pools. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">status</td><td>of the last command, must be <a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387febac861b3123c9b1c8d8a8eeb33b6f97f79" title="Attempt operation on an alternative node with remap. ">REDIS_RCODE_MOVE</a> or <a class="el" href="redis_2base_8h.html#ac84a2cc3e43abbd5dd776db799387febaf0c7f93c2a2c912e44d099b1ed3ac291" title="Attempt operation on an alternative node. ">REDIS_RCODE_ASK</a>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">reply</td><td>from last command. Freed if 0 is returned, else caller must free. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>REDIS_RCODE_SUCCESS - on success.</li>
<li>REDIS_RCODE_TRY_AGAIN - try new connection (provided via conn). Will free reply.</li>
<li>REDIS_RCODE_ERROR - on failure or command error.</li>
<li>REDIS_RCODE_RECONNECT - when no additional connections available. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l01824">1824</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>
<div id="dynsection-55" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-55-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-55-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-55-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a02e48068a3e77ab228e414708b5543ee_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div id="dynsection-56" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-56-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-56-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-56-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="cluster_8c_a02e48068a3e77ab228e414708b5543ee_icgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ae22455c185445898e1c4140ee6cfaa74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae22455c185445898e1c4140ee6cfaa74">&#9670;&nbsp;</a></span>fr_redis_cluster_rcodes_table</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="table_8h.html#structfr__table__num__sorted__t">fr_table_num_sorted_t</a> const fr_redis_cluster_rcodes_table[]</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;bad-input&quot;</span>),       <a class="code" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eba813c87c179db7abbad3cc4db52d8598f">FR_REDIS_CLUSTER_RCODE_BAD_INPUT</a>        },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;failed&quot;</span>),          <a class="code" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eba5583bc0b53ed17467c56fee49d992c80">FR_REDIS_CLUSTER_RCODE_FAILED</a>           },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;ignored&quot;</span>),         <a class="code" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eba2205a9c6ebc0e59e1a0c2f6e957be010">FR_REDIS_CLUSTER_RCODE_IGNORED</a>          },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;no-connection&quot;</span>),   <a class="code" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122ebaba9f04bc0f99fb6d4fdf8c2bcc7a31c8">FR_REDIS_CLUSTER_RCODE_NO_CONNECTION</a>    },</div><div class="line">        { <a class="code" href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a>(<span class="stringliteral">&quot;success&quot;</span>),         <a class="code" href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eba7812de47321be8b46d7261ff719cf3e4">FR_REDIS_CLUSTER_RCODE_SUCCESS</a>          }</div><div class="line">}</div><div class="ttc" id="cluster_8h_html_abc854f24023918fe25ff5f7c57a122ebaba9f04bc0f99fb6d4fdf8c2bcc7a31c8"><div class="ttname"><a href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122ebaba9f04bc0f99fb6d4fdf8c2bcc7a31c8">FR_REDIS_CLUSTER_RCODE_NO_CONNECTION</a></div><div class="ttdoc">Operation failed because we couldn&amp;#39;t find a live connection. </div><div class="ttdef"><b>Definition:</b> <a href="cluster_8h_source.html#l00071">cluster.h:71</a></div></div>
<div class="ttc" id="cluster_8h_html_abc854f24023918fe25ff5f7c57a122eba5583bc0b53ed17467c56fee49d992c80"><div class="ttname"><a href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eba5583bc0b53ed17467c56fee49d992c80">FR_REDIS_CLUSTER_RCODE_FAILED</a></div><div class="ttdoc">Operation failed. </div><div class="ttdef"><b>Definition:</b> <a href="cluster_8h_source.html#l00070">cluster.h:70</a></div></div>
<div class="ttc" id="cluster_8h_html_abc854f24023918fe25ff5f7c57a122eba7812de47321be8b46d7261ff719cf3e4"><div class="ttname"><a href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eba7812de47321be8b46d7261ff719cf3e4">FR_REDIS_CLUSTER_RCODE_SUCCESS</a></div><div class="ttdoc">Operation completed successfully. </div><div class="ttdef"><b>Definition:</b> <a href="cluster_8h_source.html#l00069">cluster.h:69</a></div></div>
<div class="ttc" id="cluster_8h_html_abc854f24023918fe25ff5f7c57a122eba2205a9c6ebc0e59e1a0c2f6e957be010"><div class="ttname"><a href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eba2205a9c6ebc0e59e1a0c2f6e957be010">FR_REDIS_CLUSTER_RCODE_IGNORED</a></div><div class="ttdoc">Operation ignored. </div><div class="ttdef"><b>Definition:</b> <a href="cluster_8h_source.html#l00068">cluster.h:68</a></div></div>
<div class="ttc" id="cluster_8h_html_abc854f24023918fe25ff5f7c57a122eba813c87c179db7abbad3cc4db52d8598f"><div class="ttname"><a href="cluster_8h.html#abc854f24023918fe25ff5f7c57a122eba813c87c179db7abbad3cc4db52d8598f">FR_REDIS_CLUSTER_RCODE_BAD_INPUT</a></div><div class="ttdoc">Validation error. </div><div class="ttdef"><b>Definition:</b> <a href="cluster_8h_source.html#l00073">cluster.h:73</a></div></div>
<div class="ttc" id="build_8h_html_a2c7b7cca6314b99cc417bde2ce3542a4"><div class="ttname"><a href="build_8h.html#a2c7b7cca6314b99cc417bde2ce3542a4">L</a></div><div class="ttdeci">#define L(_str)</div><div class="ttdef"><b>Definition:</b> <a href="build_8h_source.html#l00078">build.h:78</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00265">265</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>

</div>
</div>
<a id="a8db82bbe86710d10b015b9f9164fea00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8db82bbe86710d10b015b9f9164fea00">&#9670;&nbsp;</a></span>fr_redis_cluster_rcodes_table_len</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t fr_redis_cluster_rcodes_table_len = <a class="el" href="build_8h.html#ae0bb64e73aeef0ab6772433f210e9d57">NUM_ELEMENTS</a>(<a class="el" href="cluster_8h.html#ae22455c185445898e1c4140ee6cfaa74">fr_redis_cluster_rcodes_table</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cluster_8c_source.html#l00272">272</a> of file <a class="el" href="cluster_8c_source.html">cluster.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Nov 13 2020 23:01:05 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
